<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continent Admin Dashboard - A3 Health Card</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-red: #c62828;
            --primary-dark: #8e0000;
            --primary-light: #ff5f52;
            --bg-light: #f8f9fa;
            --sidebar-width: 260px;
        }
        
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-light);
            margin: 0; padding: 0;
            display: flex; min-height: 100vh;
        }
        
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary-red) 0%, var(--primary-dark) 100%);
            height: 100vh;
            position: fixed;
            left: 0; top: 0;
            display: flex;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }
        
        .brand-logo {
            color: white;
            text-decoration: none;
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .brand-logo i { font-size: 1.5rem; }
        
        .nav-menu {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
            min-height: 0;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1.5rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: white;
        }
        
        .nav-link i { width: 20px; text-align: center; }
        
        .user-info {
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        
        .user-avatar {
            width: 40px; height: 40px;
            background: white;
            color: var(--primary-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 1.5rem;
        }
        
        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .content-page { display: none; }
        .content-page.active { display: block; }
        
        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        
        .kpi-card:hover { transform: translateY(-2px); }
        
        .kpi-icon {
            width: 50px; height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }
        
        .kpi-value { font-size: 2rem; font-weight: 700; color: #333; }
        .kpi-label { font-size: 0.875rem; color: #666; }
        
        .card { border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px; }
        .table th { font-weight: 600; color: #666; font-size: 0.875rem; }
        .badge { font-weight: 500; padding: 0.4em 0.8em; }
        
        .welcome-banner {
            background: linear-gradient(135deg, var(--primary-red), var(--primary-dark));
            color: white;
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
        }
        
        .welcome-banner h2 { margin: 0; font-size: 1.75rem; }
        .welcome-banner p { margin: 0.5rem 0 0; opacity: 0.9; }
        
        .coming-soon {
            text-align: center;
            padding: 4rem 2rem;
            color: #888;
        }
        
        .coming-soon i { font-size: 4rem; color: #ddd; margin-bottom: 1rem; }
        .empty-state { text-align: center; padding: 3rem; color: #888; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <a href="#" class="brand-logo"><i class="fas fa-globe"></i> Continent Admin</a>
        </div>
        <div class="nav-menu py-3" style="overflow-y: auto; flex: 1;">
            <a href="#" class="nav-link active" onclick="showPage('dashboard')"><i class="fas fa-th-large"></i> Dashboard</a>
            <a href="#" class="nav-link" onclick="showPage('regionalAdmins')"><i class="fas fa-user-tie"></i> Regional Admins</a>
            <a href="#" class="nav-link" onclick="showPage('nationalAdmins')"><i class="fas fa-flag"></i> National Admins</a>
            <a href="#" class="nav-link" onclick="showPage('stateAdmins')"><i class="fas fa-building"></i> State Admins</a>
            <a href="#" class="nav-link" onclick="showPage('districtAdmins')"><i class="fas fa-map-marker-alt"></i> District Admins</a>
            <a href="#" class="nav-link" onclick="showPage('blockAdmins')"><i class="fas fa-cubes"></i> Block Admins</a>
            <a href="#" class="nav-link" onclick="showPage('regions')"><i class="fas fa-globe-americas"></i> Regions</a>
            <a href="#" class="nav-link" onclick="showPage('countries')"><i class="fas fa-map"></i> Countries</a>
            <a href="#" class="nav-link" onclick="showPage('states')"><i class="fas fa-city"></i> States</a>
            <a href="#" class="nav-link" onclick="showPage('districts')"><i class="fas fa-map-signs"></i> Districts</a>
            <a href="#" class="nav-link" onclick="showPage('allUsers')"><i class="fas fa-users"></i> All Users</a>
            <a href="#" class="nav-link" onclick="showPage('healthPrograms')"><i class="fas fa-heartbeat"></i> Health Programs</a>
            <a href="#" class="nav-link" onclick="showPage('vaccinations')"><i class="fas fa-syringe"></i> Vaccinations</a>
            <a href="#" class="nav-link" onclick="showPage('facilities')"><i class="fas fa-hospital"></i> Facilities</a>
            <a href="#" class="nav-link" onclick="showPage('healthWorkers')"><i class="fas fa-user-md"></i> Health Workers</a>
            <a href="#" class="nav-link" onclick="showPage('resources')"><i class="fas fa-boxes"></i> Resources</a>
            <a href="#" class="nav-link" onclick="showPage('alertsCenter')"><i class="fas fa-bell"></i> Alerts Center</a>
            <a href="#" class="nav-link" onclick="showPage('aiPredictions')"><i class="fas fa-brain"></i> AI Predictions</a>
            <a href="#" class="nav-link" onclick="showPage('reports')"><i class="fas fa-file-alt"></i> Reports</a>
            <a href="#" class="nav-link" onclick="showPage('settings')"><i class="fas fa-cog"></i> Settings</a>
        </div>
        <div class="user-info">
            <div class="d-flex align-items-center gap-3">
                <div class="user-avatar">{{ current_user.full_name[0] if current_user.full_name else 'C' }}</div>
                <div class="text-white">
                    <div class="fw-semibold">{{ current_user.full_name or 'Continent Admin' }}</div>
                    <small class="opacity-75">{{ current_user.continent_name or 'Your Continent' }}</small>
                </div>
            </div>
            <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm w-100 mt-3">
                <i class="fas fa-sign-out-alt me-2"></i>Logout
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-header">
            <h4 class="mb-0 fw-bold" id="pageTitle"><i class="fas fa-th-large me-2"></i>Dashboard</h4>
            <div class="d-flex align-items-center gap-3">
                <span class="text-muted" id="currentDate"></span>
                <button class="btn btn-outline-secondary btn-sm" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </header>

        <!-- Dashboard Page -->
        <div id="dashboardPage" class="content-page active">
            <div class="welcome-banner">
                <h2><i class="fas fa-globe me-2"></i>Welcome, {{ current_user.full_name or 'Continent Admin' }}!</h2>
                <p>Continental Health Management System - {{ current_user.continent_name or 'Your Continent' }}</p>
            </div>
            
            <!-- KPI Cards -->
            <div class="row g-4 mb-4">
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="kpi-value" id="totalRegions">0</div>
                                <div class="kpi-label">Regions</div>
                            </div>
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #2196F3, #1565C0);"><i class="fas fa-globe-americas"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="kpi-value" id="totalRegionalAdmins">0</div>
                                <div class="kpi-label">Regional Admins</div>
                            </div>
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #4CAF50, #2E7D32);"><i class="fas fa-user-tie"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="kpi-value" id="totalNationalAdmins">0</div>
                                <div class="kpi-label">National Admins</div>
                            </div>
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #9C27B0, #6A1B9A);"><i class="fas fa-flag"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="kpi-value" id="totalCountries">0</div>
                                <div class="kpi-label">Countries</div>
                            </div>
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #FF9800, #F57C00);"><i class="fas fa-map"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="kpi-value" id="totalStateAdmins">0</div>
                                <div class="kpi-label">State Admins</div>
                            </div>
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #00BCD4, #0097A7);"><i class="fas fa-user-shield"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="kpi-value" id="totalUsers">0</div>
                                <div class="kpi-label">Total Users</div>
                            </div>
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #E91E63, #C2185B);"><i class="fas fa-users"></i></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Regional Admins Table -->
            <div class="card">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-user-tie me-2 text-primary"></i>Regional Admins</h6>
                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#addRegionalAdminModal">
                        <i class="fas fa-plus me-1"></i>Add Regional Admin
                    </button>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Region</th>
                                    <th>National Admins</th>
                                    <th>Created</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardAdminsTable">
                                <tr><td colspan="6" class="text-center py-4 text-muted">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Regional Admins Management Page -->
        <div id="regionalAdminsPage" class="content-page">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="mb-0">Manage Regional Admins</h5>
                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#addRegionalAdminModal">
                    <i class="fas fa-plus me-2"></i>Add Regional Admin
                </button>
            </div>
            
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-user-tie me-2"></i>Regional Admins <span class="badge bg-secondary ms-2" id="regionalAdminsCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>UID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Mobile</th>
                                    <th>Region</th>
                                    <th>National Admins</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="regionalAdminsTableBody">
                                <tr><td colspan="9" class="text-center py-4 text-muted">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- National Admins Page -->
        <div id="nationalAdminsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-flag me-2"></i>National Admins <span class="badge bg-secondary ms-2" id="nationalAdminsCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>UID</th><th>Name</th><th>Email</th><th>Country</th><th>Region</th><th>Status</th><th>Created</th></tr>
                            </thead>
                            <tbody id="nationalAdminsTableBody"><tr><td colspan="7" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- State Admins Page -->
        <div id="stateAdminsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-building me-2"></i>State Admins <span class="badge bg-secondary ms-2" id="stateAdminsCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>UID</th><th>Name</th><th>Email</th><th>State</th><th>Country</th><th>Status</th><th>Created</th></tr>
                            </thead>
                            <tbody id="stateAdminsTableBody"><tr><td colspan="7" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- District Admins Page -->
        <div id="districtAdminsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-map-marker-alt me-2"></i>District Admins <span class="badge bg-secondary ms-2" id="districtAdminsCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>UID</th><th>Name</th><th>Email</th><th>District</th><th>State</th><th>Status</th><th>Created</th></tr>
                            </thead>
                            <tbody id="districtAdminsTableBody"><tr><td colspan="7" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Block Admins Page -->
        <div id="blockAdminsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-cubes me-2"></i>Block Admins <span class="badge bg-secondary ms-2" id="blockAdminsCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>UID</th><th>Name</th><th>Email</th><th>Block</th><th>District</th><th>Status</th><th>Created</th></tr>
                            </thead>
                            <tbody id="blockAdminsTableBody"><tr><td colspan="7" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Regions Page -->
        <div id="regionsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-globe-americas me-2"></i>Regions in {{ current_user.continent_name or 'Your Continent' }}</h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Region ID</th>
                                    <th>Region Name</th>
                                </tr>
                            </thead>
                            <tbody id="regionsTableBody">
                                <tr><td colspan="2" class="text-center py-4 text-muted">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Countries Page -->
        <div id="countriesPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-map me-2"></i>Countries <span class="badge bg-secondary ms-2" id="countriesCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>Country ID</th><th>Country Name</th><th>Region</th></tr>
                            </thead>
                            <tbody id="countriesTableBody"><tr><td colspan="3" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- States Page -->
        <div id="statesPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-city me-2"></i>States <span class="badge bg-secondary ms-2" id="statesCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>State ID</th><th>State Name</th><th>Country</th></tr>
                            </thead>
                            <tbody id="statesTableBody"><tr><td colspan="3" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Districts Page -->
        <div id="districtsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-map-signs me-2"></i>Districts <span class="badge bg-secondary ms-2" id="districtsCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>District ID</th><th>District Name</th><th>State</th></tr>
                            </thead>
                            <tbody id="districtsTableBody"><tr><td colspan="3" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- All Users Page -->
        <div id="allUsersPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-users me-2"></i>All Users <span class="badge bg-secondary ms-2" id="allUsersCount">0</span></h6>
                    <div class="d-flex gap-2">
                        <select class="form-select form-select-sm" id="userTypeFilter" style="width: 150px;">
                            <option value="">All Types</option>
                            <option value="client">Clients</option>
                            <option value="doctor">Doctors</option>
                            <option value="hospital">Hospitals</option>
                            <option value="health_worker">Health Workers</option>
                        </select>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>UID</th><th>Name</th><th>Email</th><th>Type</th><th>Country</th><th>State</th><th>Status</th></tr>
                            </thead>
                            <tbody id="allUsersTableBody"><tr><td colspan="7" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white d-flex justify-content-between align-items-center" id="allUsersPagination">
                    <span class="text-muted small" id="allUsersPaginationInfo">Showing 0-0 of 0</span>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary" id="prevPageBtn" onclick="loadAllUsers(currentPage - 1)">« Prev</button>
                        <button class="btn btn-outline-secondary" id="nextPageBtn" onclick="loadAllUsers(currentPage + 1)">Next »</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Programs Page -->
        <div id="healthProgramsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-heartbeat me-2"></i>Health Programs <span class="badge bg-secondary ms-2" id="healthProgramsCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>Program ID</th><th>Program Name</th><th>Status</th><th>Coverage</th></tr>
                            </thead>
                            <tbody id="healthProgramsTableBody"><tr><td colspan="4" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vaccinations Page -->
        <div id="vaccinationsPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-syringe me-2"></i>Vaccination Statistics</h6>
                </div>
                <div class="card-body">
                    <div class="row g-3" id="vaccinationStats">
                        <div class="col-md-4">
                            <div class="p-3 bg-light rounded text-center">
                                <h3 class="mb-1" id="totalVaccinations">0</h3>
                                <small class="text-muted">Total Vaccinations</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3 bg-light rounded text-center">
                                <h3 class="mb-1" id="vaccinationRegions">0</h3>
                                <small class="text-muted">Regions Covered</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3 bg-light rounded text-center">
                                <h3 class="mb-1" id="vaccinationPrograms">5</h3>
                                <small class="text-muted">Vaccine Types</small>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <h6>Available Vaccines:</h6>
                        <div id="vaccineTypes" class="d-flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Facilities Page -->
        <div id="facilitiesPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-hospital me-2"></i>Healthcare Facilities <span class="badge bg-secondary ms-2" id="facilitiesCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>UID</th><th>Facility Name</th><th>Type</th><th>Country</th><th>State</th><th>Status</th></tr>
                            </thead>
                            <tbody id="facilitiesTableBody"><tr><td colspan="6" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Workers Page -->
        <div id="healthWorkersPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-user-md me-2"></i>Health Workers <span class="badge bg-secondary ms-2" id="healthWorkersCount">0</span></h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr><th>UID</th><th>Name</th><th>Email</th><th>Facility</th><th>Country</th><th>Status</th></tr>
                            </thead>
                            <tbody id="healthWorkersTableBody"><tr><td colspan="6" class="text-center py-4 text-muted">Loading...</td></tr></tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white d-flex justify-content-between align-items-center">
                    <span class="text-muted small" id="healthWorkersPaginationInfo">Showing 0-0 of 0</span>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary" id="hwPrevBtn" onclick="loadHealthWorkers(hwCurrentPage - 1)">« Prev</button>
                        <button class="btn btn-outline-secondary" id="hwNextBtn" onclick="loadHealthWorkers(hwCurrentPage + 1)">Next »</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources Page -->
        <div id="resourcesPage" class="content-page">
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-user-md fa-3x text-primary mb-3"></i>
                            <h3 id="resHealthWorkers">0</h3>
                            <p class="text-muted mb-0">Health Workers</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-hospital fa-3x text-success mb-3"></i>
                            <h3 id="resFacilities">0</h3>
                            <p class="text-muted mb-0">Facilities</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-stethoscope fa-3x text-info mb-3"></i>
                            <h3 id="resDoctors">0</h3>
                            <p class="text-muted mb-0">Doctors</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-globe-americas fa-3x text-warning mb-3"></i>
                            <h3 id="resRegions">0</h3>
                            <p class="text-muted mb-0">Regions</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-tools fa-3x text-secondary mb-3"></i>
                            <h3 id="resEquipment">0</h3>
                            <p class="text-muted mb-0">Equipment Units</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-syringe fa-3x text-danger mb-3"></i>
                            <h3 id="resVaccines">0</h3>
                            <p class="text-muted mb-0">Vaccines in Stock</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Center Page -->
        <div id="alertsCenterPage" class="content-page">
            <div class="card">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-bell me-2"></i>Alerts Center <span class="badge bg-danger ms-2" id="alertsCount">0</span></h6>
                    <button class="btn btn-sm btn-outline-secondary" onclick="loadAlerts()"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>
                <div class="card-body p-0">
                    <div id="alertsList" class="p-3">
                        <div class="text-center text-muted py-4">Loading alerts...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Predictions Page -->
        <div id="aiPredictionsPage" class="content-page">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-brain fa-5x text-primary mb-4" style="opacity: 0.5;"></i>
                    <h3 class="mb-3">AI-Powered Health Predictions</h3>
                    <p class="text-muted mb-4" id="aiMessage">Loading...</p>
                    <span class="badge bg-warning fs-6"><i class="fas fa-clock me-2"></i>Coming Soon</span>
                </div>
            </div>
        </div>

        <!-- Reports Page -->
        <div id="reportsPage" class="content-page">
            <div class="card mb-4">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-file-alt me-2"></i>Continental Summary Report</h6>
                    <button class="btn btn-success btn-sm" onclick="exportReport()"><i class="fas fa-download me-2"></i>Export CSV</button>
                </div>
                <div class="card-body">
                    <div class="text-center text-muted mb-4">
                        <small id="reportGeneratedAt">Generated at: -</small>
                    </div>
                    <div class="row g-3" id="reportSummary">
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptRegions">0</h4>
                                <small class="text-muted">Regions</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptRegionalAdmins">0</h4>
                                <small class="text-muted">Regional Admins</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptNationalAdmins">0</h4>
                                <small class="text-muted">National Admins</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptStateAdmins">0</h4>
                                <small class="text-muted">State Admins</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptHealthWorkers">0</h4>
                                <small class="text-muted">Health Workers</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptFacilities">0</h4>
                                <small class="text-muted">Facilities</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptDoctors">0</h4>
                                <small class="text-muted">Doctors</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded text-center">
                                <h4 class="mb-1" id="rptClients">0</h4>
                                <small class="text-muted">Clients</small>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-primary text-white rounded text-center">
                        <h3 class="mb-0" id="rptTotalUsers">0</h3>
                        <small>Total Users in Continent</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="content-page">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-white py-3">
                            <h6 class="mb-0 fw-bold"><i class="fas fa-user me-2"></i>Profile Settings</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-success d-none" id="settingsSuccess"></div>
                            <div class="alert alert-danger d-none" id="settingsError"></div>
                            <form id="settingsForm">
                                <div class="mb-3">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="settingsFullName">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email (Read Only)</label>
                                    <input type="email" class="form-control" id="settingsEmail" readonly disabled>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Mobile</label>
                                    <input type="text" class="form-control" id="settingsMobile">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Continent (Read Only)</label>
                                    <input type="text" class="form-control" id="settingsContinent" readonly disabled>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save me-2"></i>Save Changes
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-white py-3">
                            <h6 class="mb-0 fw-bold"><i class="fas fa-info-circle me-2"></i>Account Information</h6>
                        </div>
                        <div class="card-body">
                            <p><strong>Role:</strong> <span class="badge bg-primary">Continent Admin</span></p>
                            <p><strong>Continent ID:</strong> <code id="settingsContinentId">-</code></p>
                            <p><strong>Account Status:</strong> <span class="badge bg-success">Active</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Regional Admin Modal -->
    <div class="modal fade" id="addRegionalAdminModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Add Regional Admin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addRegionalAdminForm">
                    <div class="modal-body">
                        <div class="alert alert-danger d-none" id="formError"></div>
                        <div class="alert alert-success d-none" id="formSuccess"></div>
                        
                        <div class="mb-3">
                            <label class="form-label">Full Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="fullName" name="full_name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mobile <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="mobile" name="mobile" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="password" name="password" required minlength="6">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Region <span class="text-danger">*</span></label>
                            <select class="form-select" id="regionSelect" name="region_id" required>
                                <option value="">Select Region</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger" id="submitBtn">
                            <span class="spinner-border spinner-border-sm d-none" id="submitSpinner"></span>
                            Create Regional Admin
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Regional Admin Modal -->
    <div class="modal fade" id="editRegionalAdminModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Regional Admin</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="editRegionalAdminForm">
                    <div class="modal-body">
                        <div class="alert alert-danger d-none" id="editFormError"></div>
                        <div class="alert alert-success d-none" id="editFormSuccess"></div>
                        <input type="hidden" id="editAdminId">
                        <div class="mb-3">
                            <label class="form-label">Full Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editFullName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="editEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mobile</label>
                            <input type="text" class="form-control" id="editMobile">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="editSubmitBtn">
                            <span class="spinner-border spinner-border-sm d-none" id="editSubmitSpinner"></span>
                            Update Admin
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteAdminModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Confirm Deactivation</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <i class="fas fa-user-slash fa-3x text-danger mb-3"></i>
                    <p class="mb-0">Are you sure you want to deactivate <strong id="deleteAdminName"></strong>?</p>
                    <p class="text-muted small">This admin will not be able to log in anymore.</p>
                    <input type="hidden" id="deleteAdminId">
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="confirmDeleteAdmin()">
                        <span id="deleteSpinner" class="spinner-border spinner-border-sm d-none"></span>
                        Deactivate Admin
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Page Navigation
        function showPage(pageId) {
            document.querySelectorAll('.content-page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.getElementById(pageId + 'Page').classList.add('active');
            event.target.closest('.nav-link').classList.add('active');
            
            const pageTitles = {
                'dashboard': '<i class="fas fa-th-large me-2"></i>Dashboard',
                'regionalAdmins': '<i class="fas fa-user-tie me-2"></i>Regional Admins',
                'nationalAdmins': '<i class="fas fa-flag me-2"></i>National Admins',
                'stateAdmins': '<i class="fas fa-building me-2"></i>State Admins',
                'districtAdmins': '<i class="fas fa-map-marker-alt me-2"></i>District Admins',
                'blockAdmins': '<i class="fas fa-cubes me-2"></i>Block Admins',
                'regions': '<i class="fas fa-globe-americas me-2"></i>Regions',
                'countries': '<i class="fas fa-map me-2"></i>Countries',
                'states': '<i class="fas fa-city me-2"></i>States',
                'districts': '<i class="fas fa-map-signs me-2"></i>Districts',
                'allUsers': '<i class="fas fa-users me-2"></i>All Users',
                'healthPrograms': '<i class="fas fa-heartbeat me-2"></i>Health Programs',
                'vaccinations': '<i class="fas fa-syringe me-2"></i>Vaccinations',
                'facilities': '<i class="fas fa-hospital me-2"></i>Facilities',
                'healthWorkers': '<i class="fas fa-user-md me-2"></i>Health Workers',
                'resources': '<i class="fas fa-boxes me-2"></i>Resources',
                'alertsCenter': '<i class="fas fa-bell me-2"></i>Alerts Center',
                'aiPredictions': '<i class="fas fa-brain me-2"></i>AI Predictions',
                'reports': '<i class="fas fa-file-alt me-2"></i>Reports',
                'settings': '<i class="fas fa-cog me-2"></i>Settings'
            };
            document.getElementById('pageTitle').innerHTML = pageTitles[pageId] || pageId;
            
            // Load page-specific data
            if (pageId === 'regionalAdmins') loadRegionalAdmins();
            if (pageId === 'nationalAdmins') loadNationalAdmins();
            if (pageId === 'stateAdmins') loadStateAdmins();
            if (pageId === 'districtAdmins') loadDistrictAdmins();
            if (pageId === 'blockAdmins') loadBlockAdmins();
            if (pageId === 'regions') loadRegions();
            if (pageId === 'countries') loadCountries();
            if (pageId === 'states') loadStates();
            if (pageId === 'districts') loadDistricts();
            if (pageId === 'allUsers') loadAllUsers(1);
            if (pageId === 'healthPrograms') loadHealthPrograms();
            if (pageId === 'vaccinations') loadVaccinations();
            if (pageId === 'facilities') loadFacilities();
            if (pageId === 'healthWorkers') loadHealthWorkers(1);
            if (pageId === 'resources') loadResources();
            if (pageId === 'alertsCenter') loadAlerts();
            if (pageId === 'aiPredictions') loadAIPredictions();
            if (pageId === 'reports') loadReports();
            if (pageId === 'settings') loadSettings();
        }
        
        // Set current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });

        // Load Regional Admins
        async function loadRegionalAdmins() {
            try {
                const response = await fetch('/api/continent-admin/regional-admins');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('regionalAdminsCount').textContent = data.total;
                    document.getElementById('totalRegionalAdmins').textContent = data.total;
                    
                    const tableBody = document.getElementById('regionalAdminsTableBody');
                    const dashboardTable = document.getElementById('dashboardAdminsTable');
                    
                    if (data.admins.length === 0) {
                        const emptyRow = '<tr><td colspan="9" class="empty-state">No Regional Admins found. Click "Add Regional Admin" to create one.</td></tr>';
                        tableBody.innerHTML = emptyRow;
                        dashboardTable.innerHTML = '<tr><td colspan="6" class="empty-state">No Regional Admins yet.</td></tr>';
                        return;
                    }
                    
                    // Full table with action buttons
                    tableBody.innerHTML = data.admins.map(admin => `
                        <tr>
                            <td><code>${admin.uid}</code></td>
                            <td><strong>${admin.full_name}</strong></td>
                            <td>${admin.email}</td>
                            <td>${admin.mobile || '-'}</td>
                            <td><span class="badge bg-info">${admin.region_name}</span></td>
                            <td>${admin.national_admins_count}</td>
                            <td><span class="badge ${admin.is_verified ? 'bg-success' : 'bg-warning'}">
                                ${admin.is_verified ? 'Active' : 'Pending'}
                            </span></td>
                            <td>${admin.created_at ? new Date(admin.created_at).toLocaleDateString() : '-'}</td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="openEditAdmin(${admin.id}, '${admin.full_name}', '${admin.email}', '${admin.mobile || ''}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="openDeleteAdmin(${admin.id}, '${admin.full_name}')" title="Deactivate">
                                    <i class="fas fa-user-slash"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                    
                    // Dashboard summary table with action buttons
                    dashboardTable.innerHTML = data.admins.slice(0, 5).map(admin => `
                        <tr>
                            <td><strong>${admin.full_name}</strong></td>
                            <td>${admin.email}</td>
                            <td><span class="badge bg-info">${admin.region_name}</span></td>
                            <td>${admin.national_admins_count}</td>
                            <td>${admin.created_at ? new Date(admin.created_at).toLocaleDateString() : '-'}</td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="openEditAdmin(${admin.id}, '${admin.full_name}', '${admin.email}', '${admin.mobile || ''}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="openDeleteAdmin(${admin.id}, '${admin.full_name}')" title="Deactivate">
                                    <i class="fas fa-user-slash"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading regional admins:', error);
            }
        }

        // Load Regions for dropdown and table
        async function loadRegions() {
            try {
                const response = await fetch('/api/continent-admin/regions');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalRegions').textContent = data.regions.length;
                    
                    // Populate dropdown
                    const select = document.getElementById('regionSelect');
                    select.innerHTML = '<option value="">Select Region</option>' + 
                        data.regions.map(r => `<option value="${r.id}">${r.name}</option>`).join('');
                    
                    // Populate regions table
                    const tableBody = document.getElementById('regionsTableBody');
                    if (data.regions.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="2" class="empty-state">No regions available for your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.regions.map(r => `
                            <tr>
                                <td><code>${r.id}</code></td>
                                <td><strong>${r.name}</strong></td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading regions:', error);
            }
        }

        // Load National Admins
        async function loadNationalAdmins() {
            try {
                const response = await fetch('/api/continent-admin/national-admins');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('nationalAdminsCount').textContent = data.total;
                    const tableBody = document.getElementById('nationalAdminsTableBody');
                    
                    if (data.admins.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-muted">No National Admins found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.admins.map(a => `
                            <tr>
                                <td><code>${a.uid}</code></td>
                                <td><strong>${a.full_name}</strong></td>
                                <td>${a.email}</td>
                                <td><span class="badge bg-info">${a.country_name}</span></td>
                                <td>${a.region_name}</td>
                                <td><span class="badge ${a.is_verified ? 'bg-success' : 'bg-warning'}">${a.is_verified ? 'Active' : 'Pending'}</span></td>
                                <td>${a.created_at ? new Date(a.created_at).toLocaleDateString() : '-'}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading national admins:', error);
            }
        }

        // Load State Admins
        async function loadStateAdmins() {
            try {
                const response = await fetch('/api/continent-admin/state-admins');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('stateAdminsCount').textContent = data.total;
                    const tableBody = document.getElementById('stateAdminsTableBody');
                    
                    if (data.admins.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-muted">No State Admins found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.admins.map(a => `
                            <tr>
                                <td><code>${a.uid}</code></td>
                                <td><strong>${a.full_name}</strong></td>
                                <td>${a.email}</td>
                                <td><span class="badge bg-primary">${a.state_name}</span></td>
                                <td>${a.country_name}</td>
                                <td><span class="badge ${a.is_verified ? 'bg-success' : 'bg-warning'}">${a.is_verified ? 'Active' : 'Pending'}</span></td>
                                <td>${a.created_at ? new Date(a.created_at).toLocaleDateString() : '-'}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading state admins:', error);
            }
        }

        // Load District Admins
        async function loadDistrictAdmins() {
            try {
                const response = await fetch('/api/continent-admin/district-admins');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('districtAdminsCount').textContent = data.total;
                    const tableBody = document.getElementById('districtAdminsTableBody');
                    
                    if (data.admins.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-muted">No District Admins found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.admins.map(a => `
                            <tr>
                                <td><code>${a.uid}</code></td>
                                <td><strong>${a.full_name}</strong></td>
                                <td>${a.email}</td>
                                <td><span class="badge bg-secondary">${a.district_name}</span></td>
                                <td>${a.state_name}</td>
                                <td><span class="badge ${a.is_verified ? 'bg-success' : 'bg-warning'}">${a.is_verified ? 'Active' : 'Pending'}</span></td>
                                <td>${a.created_at ? new Date(a.created_at).toLocaleDateString() : '-'}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading district admins:', error);
            }
        }

        // Load Block Admins
        async function loadBlockAdmins() {
            try {
                const response = await fetch('/api/continent-admin/block-admins');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('blockAdminsCount').textContent = data.total;
                    const tableBody = document.getElementById('blockAdminsTableBody');
                    
                    if (data.admins.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-muted">No Block Admins found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.admins.map(a => `
                            <tr>
                                <td><code>${a.uid}</code></td>
                                <td><strong>${a.full_name}</strong></td>
                                <td>${a.email}</td>
                                <td><span class="badge bg-dark">${a.block}</span></td>
                                <td>${a.district_name}</td>
                                <td><span class="badge ${a.is_verified ? 'bg-success' : 'bg-warning'}">${a.is_verified ? 'Active' : 'Pending'}</span></td>
                                <td>${a.created_at ? new Date(a.created_at).toLocaleDateString() : '-'}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading block admins:', error);
            }
        }

        // Load Countries
        async function loadCountries() {
            try {
                const response = await fetch('/api/continent-admin/countries');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('countriesCount').textContent = data.total;
                    const tableBody = document.getElementById('countriesTableBody');
                    
                    if (data.countries.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="3" class="text-center py-4 text-muted">No countries found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.countries.map(c => `
                            <tr>
                                <td><code>${c.id}</code></td>
                                <td><strong>${c.name}</strong></td>
                                <td>${c.region_name}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }

        // Load States
        async function loadStates() {
            try {
                const response = await fetch('/api/continent-admin/states');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('statesCount').textContent = data.total;
                    const tableBody = document.getElementById('statesTableBody');
                    
                    if (data.states.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="3" class="text-center py-4 text-muted">No states found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.states.map(s => `
                            <tr>
                                <td><code>${s.id}</code></td>
                                <td><strong>${s.name}</strong></td>
                                <td>${s.country_name}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading states:', error);
            }
        }

        // Load Districts
        async function loadDistricts() {
            try {
                const response = await fetch('/api/continent-admin/districts');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('districtsCount').textContent = data.total;
                    const tableBody = document.getElementById('districtsTableBody');
                    
                    if (data.districts.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="3" class="text-center py-4 text-muted">No districts found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.districts.map(d => `
                            <tr>
                                <td><code>${d.id}</code></td>
                                <td><strong>${d.name}</strong></td>
                                <td>${d.state_name}</td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading districts:', error);
            }
        }

        // Load All Users with pagination
        let currentPage = 1;
        let totalPages = 1;
        
        async function loadAllUsers(page = 1) {
            try {
                const userType = document.getElementById('userTypeFilter').value;
                const response = await fetch(`/api/continent-admin/all-users?page=${page}&per_page=20&user_type=${userType}`);
                const data = await response.json();
                
                if (data.success) {
                    currentPage = data.page;
                    totalPages = data.total_pages;
                    
                    document.getElementById('allUsersCount').textContent = data.total;
                    const tableBody = document.getElementById('allUsersTableBody');
                    
                    // Update pagination info
                    const start = (data.page - 1) * data.per_page + 1;
                    const end = Math.min(data.page * data.per_page, data.total);
                    document.getElementById('allUsersPaginationInfo').textContent = `Showing ${start}-${end} of ${data.total}`;
                    
                    // Update buttons
                    document.getElementById('prevPageBtn').disabled = data.page <= 1;
                    document.getElementById('nextPageBtn').disabled = data.page >= data.total_pages;
                    
                    if (data.users.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-muted">No users found.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.users.map(u => `
                            <tr>
                                <td><code>${u.uid || '-'}</code></td>
                                <td><strong>${u.full_name || '-'}</strong></td>
                                <td>${u.email}</td>
                                <td><span class="badge bg-info">${u.user_type}</span></td>
                                <td>${u.country_name}</td>
                                <td>${u.state_name}</td>
                                <td><span class="badge ${u.is_verified ? 'bg-success' : 'bg-warning'}">${u.is_verified ? 'Active' : 'Pending'}</span></td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        // User type filter change
        document.getElementById('userTypeFilter').addEventListener('change', () => loadAllUsers(1));

        // Load Health Programs
        async function loadHealthPrograms() {
            try {
                const response = await fetch('/api/continent-admin/health-programs');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('healthProgramsCount').textContent = data.total;
                    const tableBody = document.getElementById('healthProgramsTableBody');
                    
                    if (data.programs.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-muted">No health programs found.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.programs.map(p => `
                            <tr>
                                <td><code>${p.id}</code></td>
                                <td><strong>${p.name}</strong></td>
                                <td><span class="badge bg-success">${p.status}</span></td>
                                <td><strong>${p.coverage}</strong></td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading health programs:', error);
            }
        }

        // Load Vaccinations
        async function loadVaccinations() {
            try {
                const response = await fetch('/api/continent-admin/vaccinations');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalVaccinations').textContent = data.stats.total_vaccinations.toLocaleString();
                    document.getElementById('vaccinationRegions').textContent = data.stats.regions_covered;
                    document.getElementById('vaccinationPrograms').textContent = data.stats.programs.length;
                    
                    // Show vaccine types
                    const vaccinesDiv = document.getElementById('vaccineTypes');
                    vaccinesDiv.innerHTML = data.stats.programs.map(v => 
                        `<span class="badge bg-primary">${v}</span>`
                    ).join('');
                }
            } catch (error) {
                console.error('Error loading vaccinations:', error);
            }
        }

        // Load Facilities
        async function loadFacilities() {
            try {
                const response = await fetch('/api/continent-admin/facilities');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('facilitiesCount').textContent = data.total;
                    const tableBody = document.getElementById('facilitiesTableBody');
                    
                    if (data.facilities.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-muted">No facilities found in your continent.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.facilities.map(f => `
                            <tr>
                                <td><code>${f.uid || '-'}</code></td>
                                <td><strong>${f.name}</strong></td>
                                <td><span class="badge bg-info">${f.type}</span></td>
                                <td>${f.country}</td>
                                <td>${f.state}</td>
                                <td><span class="badge ${f.is_verified ? 'bg-success' : 'bg-warning'}">${f.is_verified ? 'Verified' : 'Pending'}</span></td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading facilities:', error);
            }
        }

        // Load Health Workers with pagination
        let hwCurrentPage = 1;
        
        async function loadHealthWorkers(page = 1) {
            try {
                const response = await fetch(`/api/continent-admin/health-workers?page=${page}&per_page=20`);
                const data = await response.json();
                
                if (data.success) {
                    hwCurrentPage = data.page;
                    document.getElementById('healthWorkersCount').textContent = data.total;
                    const tableBody = document.getElementById('healthWorkersTableBody');
                    
                    // Update pagination info
                    const start = (data.page - 1) * data.per_page + 1;
                    const end = Math.min(data.page * data.per_page, data.total);
                    document.getElementById('healthWorkersPaginationInfo').textContent = `Showing ${start}-${end} of ${data.total}`;
                    
                    // Update buttons
                    document.getElementById('hwPrevBtn').disabled = data.page <= 1;
                    document.getElementById('hwNextBtn').disabled = data.page >= data.total_pages;
                    
                    if (data.workers.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-muted">No health workers found.</td></tr>';
                    } else {
                        tableBody.innerHTML = data.workers.map(w => `
                            <tr>
                                <td><code>${w.uid || '-'}</code></td>
                                <td><strong>${w.full_name || '-'}</strong></td>
                                <td>${w.email}</td>
                                <td>${w.facility}</td>
                                <td>${w.country}</td>
                                <td><span class="badge ${w.is_verified ? 'bg-success' : 'bg-warning'}">${w.is_verified ? 'Active' : 'Pending'}</span></td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading health workers:', error);
            }
        }

        // Load Resources
        async function loadResources() {
            try {
                const response = await fetch('/api/continent-admin/resources');
                const data = await response.json();
                
                if (data.success) {
                    const r = data.resources;
                    document.getElementById('resHealthWorkers').textContent = r.health_workers?.toLocaleString() || '0';
                    document.getElementById('resFacilities').textContent = r.facilities?.toLocaleString() || '0';
                    document.getElementById('resDoctors').textContent = r.doctors?.toLocaleString() || '0';
                    document.getElementById('resRegions').textContent = r.regions?.toLocaleString() || '0';
                    document.getElementById('resEquipment').textContent = r.equipment?.toLocaleString() || '0';
                    document.getElementById('resVaccines').textContent = r.vaccines_in_stock?.toLocaleString() || '0';
                }
            } catch (error) {
                console.error('Error loading resources:', error);
            }
        }

        // Load Alerts
        async function loadAlerts() {
            try {
                const response = await fetch('/api/continent-admin/alerts');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('alertsCount').textContent = data.total;
                    const alertsList = document.getElementById('alertsList');
                    
                    if (data.alerts.length === 0) {
                        alertsList.innerHTML = '<div class="text-center py-4"><i class="fas fa-check-circle text-success fa-3x mb-3"></i><p class="text-muted">No alerts at this time. Everything looks good!</p></div>';
                    } else {
                        alertsList.innerHTML = data.alerts.map(a => {
                            const typeClasses = {
                                'critical': 'danger',
                                'warning': 'warning',
                                'info': 'info'
                            };
                            const bgClass = typeClasses[a.type] || 'secondary';
                            return `
                                <div class="alert alert-${bgClass} d-flex align-items-start mb-2">
                                    <i class="fas fa-${a.type === 'critical' ? 'exclamation-circle' : a.type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-3 mt-1"></i>
                                    <div>
                                        <strong>${a.title}</strong>
                                        <p class="mb-0 small">${a.message}</p>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading alerts:', error);
            }
        }

        // Load AI Predictions
        async function loadAIPredictions() {
            try {
                const response = await fetch('/api/continent-admin/ai-predictions');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('aiMessage').textContent = data.message;
                }
            } catch (error) {
                console.error('Error loading AI predictions:', error);
            }
        }

        // Load Reports
        let reportData = null;
        async function loadReports() {
            try {
                const response = await fetch('/api/continent-admin/reports-summary');
                const data = await response.json();
                
                if (data.success && data.report) {
                    reportData = data.report;
                    const s = data.report.summary;
                    
                    document.getElementById('reportGeneratedAt').textContent = `Generated at: ${new Date(data.report.generated_at).toLocaleString()}`;
                    document.getElementById('rptRegions').textContent = s.total_regions?.toLocaleString() || '0';
                    document.getElementById('rptRegionalAdmins').textContent = s.regional_admins?.toLocaleString() || '0';
                    document.getElementById('rptNationalAdmins').textContent = s.national_admins?.toLocaleString() || '0';
                    document.getElementById('rptStateAdmins').textContent = s.state_admins?.toLocaleString() || '0';
                    document.getElementById('rptHealthWorkers').textContent = s.health_workers?.toLocaleString() || '0';
                    document.getElementById('rptFacilities').textContent = s.facilities?.toLocaleString() || '0';
                    document.getElementById('rptDoctors').textContent = s.doctors?.toLocaleString() || '0';
                    document.getElementById('rptClients').textContent = s.clients?.toLocaleString() || '0';
                    document.getElementById('rptTotalUsers').textContent = s.total_users?.toLocaleString() || '0';
                }
            } catch (error) {
                console.error('Error loading reports:', error);
            }
        }

        // Export Report as CSV
        function exportReport() {
            if (!reportData) {
                alert('Please wait for report to load');
                return;
            }
            
            const s = reportData.summary;
            const csvContent = `Continental Summary Report\nContinent,${reportData.continent_name}\nGenerated At,${reportData.generated_at}\n\nMetric,Count\nRegions,${s.total_regions}\nRegional Admins,${s.regional_admins}\nNational Admins,${s.national_admins}\nState Admins,${s.state_admins}\nHealth Workers,${s.health_workers}\nFacilities,${s.facilities}\nDoctors,${s.doctors}\nClients,${s.clients}\nTotal Users,${s.total_users}`;
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `continent_report_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load Settings
        async function loadSettings() {
            try {
                const response = await fetch('/api/continent-admin/settings');
                const data = await response.json();
                
                if (data.success) {
                    const s = data.settings;
                    document.getElementById('settingsFullName').value = s.full_name || '';
                    document.getElementById('settingsEmail').value = s.email || '';
                    document.getElementById('settingsMobile').value = s.mobile || '';
                    document.getElementById('settingsContinent').value = s.continent_name || '';
                    document.getElementById('settingsContinentId').textContent = s.continent_id || '-';
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Settings form submission
        document.getElementById('settingsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const successDiv = document.getElementById('settingsSuccess');
            const errorDiv = document.getElementById('settingsError');
            successDiv.classList.add('d-none');
            errorDiv.classList.add('d-none');
            
            try {
                const response = await fetch('/api/continent-admin/settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        full_name: document.getElementById('settingsFullName').value,
                        mobile: document.getElementById('settingsMobile').value
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    successDiv.textContent = 'Settings saved successfully!';
                    successDiv.classList.remove('d-none');
                } else {
                    errorDiv.textContent = data.error || 'Failed to save settings';
                    errorDiv.classList.remove('d-none');
                }
            } catch (error) {
                errorDiv.textContent = 'Error saving settings';
                errorDiv.classList.remove('d-none');
            }
        });

        // Form submission
        document.getElementById('addRegionalAdminForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const spinner = document.getElementById('submitSpinner');
            const errorDiv = document.getElementById('formError');
            const successDiv = document.getElementById('formSuccess');
            
            // Reset alerts
            errorDiv.classList.add('d-none');
            successDiv.classList.add('d-none');
            
            // Show loading
            submitBtn.disabled = true;
            spinner.classList.remove('d-none');
            
            const formData = {
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                mobile: document.getElementById('mobile').value,
                password: document.getElementById('password').value,
                region_id: document.getElementById('regionSelect').value
            };
            
            try {
                const response = await fetch('/api/continent-admin/create-regional-admin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    successDiv.textContent = `Regional Admin "${data.admin.full_name}" created successfully! UID: ${data.admin.uid}`;
                    successDiv.classList.remove('d-none');
                    
                    // Reset form
                    this.reset();
                    
                    // Reload data
                    loadRegionalAdmins();
                    
                    // Close modal after 2 seconds
                    setTimeout(() => {
                        bootstrap.Modal.getInstance(document.getElementById('addRegionalAdminModal')).hide();
                        successDiv.classList.add('d-none');
                    }, 2000);
                } else {
                    errorDiv.textContent = data.error || 'Failed to create Regional Admin';
                    errorDiv.classList.remove('d-none');
                }
            } catch (error) {
                errorDiv.textContent = 'Network error. Please try again.';
                errorDiv.classList.remove('d-none');
            } finally {
                submitBtn.disabled = false;
                spinner.classList.add('d-none');
            }
        });

        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
            loadRegionalAdmins();
            loadRegions();
        });
        
        // Load Dashboard Stats
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/continent-admin/dashboard-stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalRegions').textContent = data.stats.regions;
                    document.getElementById('totalRegionalAdmins').textContent = data.stats.regional_admins;
                    document.getElementById('totalNationalAdmins').textContent = data.stats.national_admins;
                    document.getElementById('totalCountries').textContent = data.stats.countries;
                    document.getElementById('totalStateAdmins').textContent = data.stats.state_admins;
                    document.getElementById('totalUsers').textContent = data.stats.total_users.toLocaleString();
                }
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }
        
        // ===== EDIT/DELETE FUNCTIONS =====
        
        // Open Edit Modal
        function openEditAdmin(id, fullName, email, mobile) {
            document.getElementById('editAdminId').value = id;
            document.getElementById('editFullName').value = fullName;
            document.getElementById('editEmail').value = email;
            document.getElementById('editMobile').value = mobile;
            
            document.getElementById('editFormError').classList.add('d-none');
            document.getElementById('editFormSuccess').classList.add('d-none');
            
            const modal = new bootstrap.Modal(document.getElementById('editRegionalAdminModal'));
            modal.show();
        }
        
        // Edit Form Submit
        document.getElementById('editRegionalAdminForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const adminId = document.getElementById('editAdminId').value;
            const submitBtn = document.getElementById('editSubmitBtn');
            const spinner = document.getElementById('editSubmitSpinner');
            const errorDiv = document.getElementById('editFormError');
            const successDiv = document.getElementById('editFormSuccess');
            
            errorDiv.classList.add('d-none');
            successDiv.classList.add('d-none');
            submitBtn.disabled = true;
            spinner.classList.remove('d-none');
            
            const formData = {
                full_name: document.getElementById('editFullName').value,
                email: document.getElementById('editEmail').value,
                mobile: document.getElementById('editMobile').value
            };
            
            try {
                const response = await fetch(`/api/continent-admin/regional-admins/${adminId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    successDiv.textContent = 'Regional Admin updated successfully!';
                    successDiv.classList.remove('d-none');
                    loadRegionalAdmins();
                    
                    setTimeout(() => {
                        bootstrap.Modal.getInstance(document.getElementById('editRegionalAdminModal')).hide();
                    }, 1000);
                } else {
                    errorDiv.textContent = data.error || 'Failed to update';
                    errorDiv.classList.remove('d-none');
                }
            } catch (error) {
                errorDiv.textContent = 'Network error. Please try again.';
                errorDiv.classList.remove('d-none');
            } finally {
                submitBtn.disabled = false;
                spinner.classList.add('d-none');
            }
        });
        
        // Open Delete Modal
        function openDeleteAdmin(id, name) {
            document.getElementById('deleteAdminId').value = id;
            document.getElementById('deleteAdminName').textContent = name;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteAdminModal'));
            modal.show();
        }
        
        // Confirm Delete
        async function confirmDeleteAdmin() {
            const adminId = document.getElementById('deleteAdminId').value;
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const spinner = document.getElementById('deleteSpinner');
            
            confirmBtn.disabled = true;
            spinner.classList.remove('d-none');
            
            try {
                const response = await fetch(`/api/continent-admin/regional-admins/${adminId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('deleteAdminModal')).hide();
                    loadRegionalAdmins();
                    alert(data.message || 'Admin deactivated successfully!');
                } else {
                    alert(data.error || 'Failed to deactivate admin');
                }
            } catch (error) {
                alert('Network error. Please try again.');
            } finally {
                confirmBtn.disabled = false;
                spinner.classList.add('d-none');
            }
        }
    </script>
</body>
</html>
