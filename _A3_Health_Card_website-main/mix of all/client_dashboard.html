<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Dashboard | A3 Health Card</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='theme.css') }}">
    <link rel="stylesheet" href="../static/client_dashboard.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='medical_records.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='page_fix.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='mental_health.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='diet.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='physical_activity.css') }}">
    
    <!-- Chart.js for vitals charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        {% if doctor_mode %}
        <div class="alert alert-warning w-100 mb-0 text-center fw-bold rounded-0" style="position: absolute; top: 0; left: 0; z-index: 1001; height: 30px; line-height: 30px; padding: 0;">
            <i class="fas fa-eye me-2"></i> Viewing Patient: {{ user.full_name }} (UID: {{ user.uid }})
        </div>
        {% endif %}
        <div class="header-left" {% if doctor_mode %}style="margin-top: 30px;"{% endif %}>
            <h1 class="brand-logo">A3 Health Card</h1>
        </div>
        <div class="header-right" {% if doctor_mode %}style="margin-top: 30px;"{% endif %}>
            <button class="icon-btn" id="refreshBtn" title="Refresh">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="icon-btn" id="helpBtn" title="Help">
                <i class="fas fa-question-circle"></i>
            </button>
            <button class="icon-btn notification-btn" id="notificationBtn" title="Notifications">
                <i class="fas fa-bell"></i>
            </button>
            <div class="user-profile" id="userProfileBtn">
                <img src="https://ui-avatars.com/api/?name={{ user.full_name or 'User' }}&background=d32f2f&color=fff" alt="Profile" class="profile-img">
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="dashboard-container">
        <!-- Left Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="overview">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard Overview</span>
                </a>
                <a href="#" class="nav-item" data-page="health-card">
                    <i class="fas fa-id-card"></i>
                    <span>My Health Card</span>
                </a>
                <a href="#" class="nav-item" data-page="general-details">
                    <i class="fas fa-user"></i>
                    <span>General Details</span>
                </a>
                <a href="#" class="nav-item" data-page="household">
                    <i class="fas fa-home"></i>
                    <span>Household Details</span>
                </a>
                <a href="#" class="nav-item" data-page="medical-records">
                    <i class="fas fa-file-medical"></i>
                    <span>Medical Records</span>
                </a>
                <a href="#" class="nav-item" data-page="health-assessments">
                    <i class="fas fa-stethoscope"></i>
                    <span>Health Assessments</span>
                </a>
                <a href="#" class="nav-item" data-page="vaccination">
                    <i class="fas fa-syringe"></i>
                    <span>Vaccination History</span>
                </a>
                <a href="#" class="nav-item" data-page="allergy">
                    <i class="fas fa-allergies"></i>
                    <span>Allergy</span>
                </a>
                <a href="#" class="nav-item" data-page="surgery">
                    <i class="fas fa-procedures"></i>
                    <span>Surgery History</span>
                </a>
                <a href="#" class="nav-item" data-page="implantation">
                    <i class="fas fa-heart"></i>
                    <span>Bio Medical Implants</span>
                </a>
                <a href="#" class="nav-item" data-page="family-history">
                    <i class="fas fa-users"></i>
                    <span>Family History</span>
                </a>
                <a href="#" class="nav-item" data-page="medical-history">
                    <i class="fas fa-notes-medical"></i>
                    <span>Medical History</span>
                </a>
                <a href="#" class="nav-item" data-page="lifestyle">
                    <i class="fas fa-running"></i>
                    <span>Lifestyle & Risk</span>
                </a>
                <a href="#" class="nav-item" data-page="my-vitals">
                    <i class="fas fa-heartbeat"></i>
                    <span>My Vitals</span>
                </a>
                <a href="#" class="nav-item" data-page="my-investigations">
                    <i class="fas fa-flask"></i>
                    <span>Lab & Investigations</span>
                </a>
                <a href="#" class="nav-item" data-page="appointments">
                    <i class="fas fa-calendar-check"></i>
                    <span>Appointments</span>
                </a>
                <a href="#" class="nav-item" data-page="pill-reminder">
                    <i class="fas fa-pills"></i>
                    <span>Pill Reminder</span>
                </a>
                <a href="#" class="nav-item" data-page="pharmacy">
                    <i class="fas fa-pills"></i>
                    <span>Pharmacy Services</span>
                </a>
                <a href="#" class="nav-item" data-page="blood-requests">
                    <i class="fas fa-tint"></i>
                    <span>Blood Requests/Donate</span>
                </a>
                <a href="#" class="nav-item" data-page="Organ-requests">
                    <i class="fas fa-lungs"></i>
                    <span>Organ Requests/Donate</span>
                </a>
                <a href="#" class="nav-item" data-page="insurance">
                    <i class="fas fa-shield-alt"></i>
                    <span>Insurance & Claims</span>
                </a>
                <a href="#" class="nav-item" data-page="iot-monitoring">
                    <i class="fas fa-heartbeat"></i>
                    <span>IoT Monitoring</span>
                </a>
                <a href="#" class="nav-item" data-page="ai-predictors">
                    <i class="fas fa-brain"></i>
                    <span>AI Predictors</span>
                </a>
                <a href="#" class="nav-item" data-page="mental-health">
                    <i class="fas fa-spa"></i>
                    <span>Mental Health</span>
                </a>
                <a href="#" class="nav-item" data-page="diet-plan">
                    <i class="fas fa-utensils"></i>
                    <span>Diet & Nutrition</span>
                </a>
                <a href="#" class="nav-item" data-page="physical-activity">
                    <i class="fas fa-running"></i>
                    <span>Physical Activity</span>
                </a>
                {% if not doctor_mode %}
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Profile Settings</span>
                </a>
                {% endif %}
                {% if doctor_mode %}
                <a href="{{ url_for('doctor_dashboard') }}" class="nav-item logout-item text-danger">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Exit View</span>
                </a>
                {% else %}
                <a href="{{ url_for('logout') }}" class="nav-item logout-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
                {% endif %}
            </nav>
        </aside>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Overview Page -->
            <div class="content-page active" id="overview-page">
                <!-- Overview content can be added here -->
                <div class="overview-content-area">
                    <h2 class="page-title"><i class="fas fa-th-large me-2"></i>Dashboard</h2>
                    <p class="text-muted mb-4">Welcome to your health dashboard. Select an option from the menu to get started.</p>
                    
                    <!-- 9 Play Cards Grid (3x3) -->
                    <div class="play-cards-grid">
                        <!-- Card 1 - Light Blue - Vitals (Clickable) -->
                        <a href="#" class="play-card" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); text-decoration: none;" data-page="my-vitals">
                            <div class="play-card-icon"><i class="fas fa-heartbeat"></i></div>
                            <h4 class="play-card-title">Vitals</h4>
                            <p class="play-card-text">Monitor your vital signs</p>
                        </a>
                        
                        <!-- Card 2 - Light Yellow -->
                        <div class="play-card" style="background: linear-gradient(135deg, #fffde7 0%, #fff9c4 100%);">
                            <div class="play-card-icon"><i class="fas fa-map-marker-alt"></i></div>
                            <h4 class="play-card-title">Locate Nearest Doctor & Pharmacy</h4>
                            <p class="play-card-text">Content coming soon</p>
                        </div>
                        
                        <!-- Card 3 - Light Lavender -->
                        <div class="play-card" style="background: linear-gradient(135deg, #ede7f6 0%, #d1c4e9 100%);">
                            <div class="play-card-icon"><i class="fas fa-video"></i></div>
                            <h4 class="play-card-title">Telemedicine Point</h4>
                            <p class="play-card-text">Content coming soon</p>
                        </div>

                        <!-- Card 4 - Light Purple - Pill Reminder (Clickable) -->
                        <a href="#" class="play-card" style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); text-decoration: none;" data-page="pill-reminder">
                            <div class="play-card-icon"><i class="fas fa-pills"></i></div>
                            <h4 class="play-card-title">Pill Reminder</h4>
                            <p class="play-card-text">Manage your medications</p>
                        </a>

                        <!-- Card 5 - Light Teal - Appointments (Clickable) -->
                        <a href="#" class="play-card" style="background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%); text-decoration: none;" data-page="appointments">
                            <div class="play-card-icon"><i class="fas fa-calendar-check"></i></div>
                            <h4 class="play-card-title">Appointment Reminder</h4>
                            <p class="play-card-text">View & manage appointments</p>
                        </a>


                        <!-- Card 6 - Light Cyan -->
                        <div class="play-card" style="background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);">
                            <div class="play-card-icon"><i class="fas fa-robot"></i></div>
                            <h4 class="play-card-title">Ai Alerts</h4>
                            <p class="play-card-text">Content coming soon</p>
                        </div>

                        
                        <!-- Card 7 - Light Green - Mental Health (Clickable) -->
                        <a href="#" class="play-card" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); text-decoration: none;" data-page="mental-health">
                            <div class="play-card-icon"><i class="fas fa-brain"></i></div>
                            <h4 class="play-card-title">Mental Health</h4>
                            <p class="play-card-text">Track your mental wellness</p>
                        </a>
                        
                        <!-- Card 8 - Light Pink - Diet Plan (Clickable) -->
                        <a href="#" class="play-card" style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); text-decoration: none;" data-page="diet-plan">
                            <div class="play-card-icon"><i class="fas fa-utensils"></i></div>
                            <h4 class="play-card-title">Diet Plan</h4>
                            <p class="play-card-text">Manage your nutrition</p>
                        </a>
                        
                        <!-- Card 9 - Light Orange - Physical Activity (Clickable) -->
                        <a href="#" class="play-card" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); text-decoration: none;" data-page="physical-activity">
                            <div class="play-card-icon"><i class="fas fa-running"></i></div>
                            <h4 class="play-card-title">Physical Activity</h4>
                            <p class="play-card-text">Track your exercises</p>
                        </a>
                    </div>
                </div>
            </div>


            <!-- Other Pages (Hidden by default) -->
            <!-- Health Card Page -->
            <div class="content-page" id="health-card-page">
                <div class="page-header">
                    <h2><i class="fas fa-id-card"></i> My Health Card</h2>
                    <button class="btn-primary">
                        <i class="fas fa-download"></i> Download Card
                    </button>
                </div>
                <div class="health-card-view">
                    <div class="health-card-front">
                        <div class="card-logo">A3 Health Card</div>
                        <div class="card-photo">
                            <img src="https://ui-avatars.com/api/?name={{ user.full_name or 'User' }}&background=d32f2f&color=fff&size=150" alt="Photo">
                        </div>
                        <div class="card-info">
                            <h3>{{ user.full_name or 'User Name' }}</h3>
                            <p class="card-uid">UID: {{ user.uid }}</p>
                            <div class="card-details">
                                <div class="detail-row">
                                    <span>DOB:</span>
                                    <strong>{{ user.dob.strftime('%d/%m/%Y') if user.dob else 'N/A' }}</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Blood Group:</span>
                                    <strong>{{ (user.blood_group or '') ~ (user.blood_rh or '') or 'N/A' }}</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Gender:</span>
                                    <strong>{{ user.gender or 'N/A' }}</strong>
                                </div>
                            </div>
                        </div>
                        <div class="card-qr">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data={{ user.uid }}" alt="QR Code">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Family History Page -->
            <div class="content-page" id="family-history-page">
                <div class="page-header">
                    <h2><i class="fas fa-users"></i> Family Medical History</h2>
                    <button class="btn-primary" id="addFamilyHistoryBtn">
                        <i class="fas fa-plus"></i> Add Family History
                    </button>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #FF6B6B 0%, #EE5253 100%); color: white;">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Members</p>
                            <h3 class="stat-value" id="fhStatTotal">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #FF9F43 0%, #EE5A24 100%); color: white;">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">With Conditions</p>
                            <h3 class="stat-value" id="fhStatConditions">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #54a0ff 0%, #2e86de 100%); color: white;">
                            <i class="fas fa-dna"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Genetic Conditions</p>
                            <h3 class="stat-value" id="fhStatGenetic">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #fff; border: 1px solid #eee; color: #666;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last Updated</p>
                            <h3 class="stat-value" id="fhStatUpdated">N/A</h3>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="allergy-dashboard-inline">
                    <div class="allergy-header-row">
                        <div class="allergy-search">
                            <label for="fhSearchInput" class="form-label">Search</label>
                            <input type="search" id="fhSearchInput" class="form-control" placeholder="Name, condition, relation...">
                        </div>
                        <div class="allergy-filters">
                            <div class="form-group">
                                <label class="form-label">Relation</label>
                                <select id="fhRelationFilter" class="form-control">
                                    <option value="">All</option>
                                    <option value="Father">Father</option>
                                    <option value="Mother">Mother</option>
                                    <option value="Brother">Brother</option>
                                    <option value="Sister">Sister</option>
                                    <option value="Grandfather">Grandfather</option>
                                    <option value="Grandmother">Grandmother</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Condition</label>
                                <select id="fhConditionFilter" class="form-control">
                                    <option value="">All</option>
                                    <option value="Diabetes">Diabetes</option>
                                    <option value="Hypertension">Hypertension</option>
                                    <option value="Cancer">Cancer</option>
                                    <option value="Heart Disease">Heart Disease</option>
                                </select>
                            </div>
                            <button class="btn-secondary" id="fhResetFilters">Reset</button>
                        </div>
                    </div>

                    <!-- Content Grid -->
                    <div class="row" id="fhCardsContainer">
                        <!-- Cards injected here -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="fhEmptyState" class="card empty-state" style="display: none;">
                        <i class="fas fa-users"></i>
                        <h3>No family history recorded</h3>
                        <p>Add your family's medical history to help doctors assess your genetic risks.</p>
                        <button class="btn-primary" id="fhEmptyAddBtn">
                            <i class="fas fa-plus"></i> Add Family History
                        </button>
                    </div>
                </div>
            </div>

            <!-- Health Assessments Page -->
            <div class="content-page" id="health-assessments-page">
                <div class="page-header">
                    <h2><i class="fas fa-stethoscope"></i> Health Assessments</h2>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #E63946 0%, #d32f2f 100%); color: #fff;">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Assessments</p>
                            <h3 class="stat-value" id="assessmentStatTotal">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: #fff;">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last BP</p>
                            <h3 class="stat-value" id="assessmentStatLastBP">--/--</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: #fff;">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last Pulse</p>
                            <h3 class="stat-value" id="assessmentStatLastPulse">-- bpm</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #fff; border: 1px solid #eee; color: #666;">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last Check</p>
                            <h3 class="stat-value" id="assessmentStatLastDate">N/A</h3>
                        </div>
                    </div>
                </div>

                <!-- Info Alert -->
                <div class="alert alert-info mt-3" style="border-radius: 12px;">
                    <i class="fas fa-info-circle"></i> Your health assessments are recorded by ASHA/ANM workers during home visits.
                </div>

                <!-- Category Tabs -->
                <div class="assessment-tabs mt-4">
                    <button class="assessment-tab active" data-category="all">
                        <i class="fas fa-list"></i> All
                    </button>
                    <button class="assessment-tab" data-category="General">
                        <i class="fas fa-heartbeat"></i> Vitals
                    </button>
                    <button class="assessment-tab" data-category="ANC">
                        <i class="fas fa-baby"></i> Pregnancy
                    </button>
                    <button class="assessment-tab" data-category="Child">
                        <i class="fas fa-child"></i> Child Health
                    </button>
                    <button class="assessment-tab" data-category="TB">
                        <i class="fas fa-lungs"></i> TB
                    </button>
                    <button class="assessment-tab" data-category="NCD">
                        <i class="fas fa-heart-broken"></i> NCD
                    </button>
                    <button class="assessment-tab" data-category="Elderly">
                        <i class="fas fa-user-clock"></i> Elderly
                    </button>
                    <button class="assessment-tab" data-category="Mental">
                        <i class="fas fa-brain"></i> Mental Health
                    </button>
                </div>

                <!-- Assessment Cards Container -->
                <h5 class="mt-4 mb-3"><i class="fas fa-chart-line"></i> Assessment Records</h5>
                <div id="assessmentCardsContainer" class="row">
                    <!-- Cards rendered by JS -->
                </div>
                
                <!-- Loading State -->
                <div id="assessmentLoadingState" class="text-center py-4" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading assessments...</p>
                </div>
                
                <!-- Empty State -->
                <div id="assessmentEmptyState" class="card empty-state" style="display: none;">
                    <i class="fas fa-stethoscope"></i>
                    <h3>No assessments recorded yet</h3>
                    <p>Your health worker will record assessments during home visits. Make sure to schedule regular check-ups!</p>
                </div>
            </div>

            <style>
            .assessment-tabs { display: flex; flex-wrap: wrap; gap: 8px; }
            .assessment-tab { padding: 8px 16px; border: 2px solid #e9ecef; border-radius: 20px; background: white; cursor: pointer; font-weight: 500; font-size: 0.9rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
            .assessment-tab:hover { border-color: #dc3545; color: #dc3545; }
            .assessment-tab.active { background: #dc3545; color: white; border-color: #dc3545; }
            .assessment-card { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 15px; overflow: hidden; }
            .assessment-card-header { padding: 12px 16px; background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%); color: white; }
            .assessment-card-body { padding: 16px; }
            .vitals-grid-compact { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
            .vital-mini { text-align: center; padding: 8px; background: #f8f9fa; border-radius: 8px; }
            .vital-mini-value { font-size: 1.1rem; font-weight: 600; color: #333; }
            .vital-mini-label { font-size: 0.7rem; color: #666; text-transform: uppercase; }
            .category-badge { padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
            .category-General { background: #e8f5e9; color: #2e7d32; }
            .category-ANC { background: #fce4ec; color: #c2185b; }
            .category-Child { background: #e3f2fd; color: #1565c0; }
            .category-TB { background: #fff3e0; color: #e65100; }
            .category-NCD { background: #f3e5f5; color: #7b1fa2; }
            .category-Elderly { background: #efebe9; color: #5d4037; }
            .category-Mental { background: #e0f7fa; color: #00838f; }
            </style>


            <!-- Vaccination History Page -->
            <div class="content-page" id="vaccination-page">
                <div class="page-header">
                    <h2><i class="fas fa-syringe"></i> Vaccination History</h2>
                    <button class="btn-primary" id="addVaccinationBtn">
                        <i class="fas fa-plus"></i> Add Vaccination
                    </button>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg,#E63946 0%,#d32f2f 100%); color:#fff;">
                            <i class="fas fa-syringe"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Vaccines</p>
                            <h3 class="stat-value" id="vaccinationStatTotal">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:#4CAF50; color:#fff;">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Upcoming</h3>
                            <h3 class="stat-value" id="vaccinationStatUpcoming">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:#FF9800; color:#fff;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Overdue</p>
                            <h3 class="stat-value" id="vaccinationStatOverdue">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:#fff; border:1px solid #eee; color:#666;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last Updated</p>
                            <h3 class="stat-value" id="vaccinationStatUpdated">N/A</h3>
                        </div>
                    </div>
                </div>

                <!-- Content Container -->
                <div id="vaccinationCardContainer" class="row" style="margin-top: 20px;">
                    <!-- Cards will be inserted here -->
                </div>
                
                <!-- Empty State -->
                <div id="vaccinationEmptyState" class="card empty-state" style="display: none;">
                    <i class="fas fa-syringe"></i>
                    <h3>No vaccination records yet</h3>
                    <p>Add your vaccination history to keep a complete record of your immunizations.</p>
                    <button class="btn-primary" id="vaccinationEmptyAddBtn">
                        <i class="fas fa-plus"></i> Add Vaccination
                    </button>
                </div>
            </div>

            <!-- Allergy Page -->
            <div class="content-page" id="allergy-page">
                <div class="page-header">
                    <h2><i class="fas fa-allergies"></i> Allergy Profile</h2>
                    <button class="btn-primary js-add-allergy" id="addAllergyBtn">
                        <i class="fas fa-plus"></i> Add Allergy
                    </button>
                </div>

                <!-- Content Container -->
                <div id="allergyCardContainer" class="row" style="margin-top: 20px;">
                    <!-- Cards will be inserted here -->
                </div>
                
                <!-- Empty State -->
                <div id="allergyEmptyState" class="card empty-state" style="display: none;">
                    <i class="fas fa-allergies"></i>
                    <h3>No allergy information yet</h3>
                    <p>Add your allergies to keep critical alerts handy for doctors and emergency responders.</p>
                    <button class="btn-primary js-add-allergy">
                        <i class="fas fa-plus"></i> Add Allergy
                    </button>
                </div>
            </div>

            <!-- Surgery History Page -->
            <div class="content-page" id="surgery-page">
                <div class="page-header">
                    <h2><i class="fas fa-procedures"></i> Surgery History</h2>
                    <button class="btn-primary" id="addSurgeryBtn">
                        <i class="fas fa-plus"></i> Add Surgery
                    </button>
                </div>

                <!-- Content Container -->
                <div id="surgeryCardsContainer" class="row" style="margin-top: 20px;">
                    <!-- Cards will be inserted here -->
                </div>
                
                <!-- Empty State -->
                <div id="surgeryEmptyState" class="card empty-state" style="display: none;">
                    <i class="fas fa-procedures"></i>
                    <h3>No surgery history yet</h3>
                    <p>Add your past surgeries so your care team can see your complete clinical picture.</p>
                    <button class="btn-primary" id="surgeryEmptyAddBtn">
                        <i class="fas fa-plus"></i> Add Surgery
                    </button>
                </div>
            </div>

            <!-- Bio Medical Implants Page -->
            <div class="content-page" id="implantation-page">
                <div class="page-header">
                    <h2><i class="fas fa-heart"></i> Bio Medical Implants</h2>
                    <button class="btn-primary" id="addImplantBtn">
                        <i class="fas fa-plus"></i> Add Implant
                    </button>
                </div>

                <!-- Content Container -->
                <div id="implantCardsContainer" class="row" style="margin-top: 20px;">
                    <!-- Cards will be inserted here -->
                </div>
                
                <!-- Empty State -->
                <div id="implantEmptyState" class="card empty-state" style="display: none;">
                    <i class="fas fa-microchip"></i>
                    <h3>No implant history yet</h3>
                    <p>Track your medical devices to ensure safety and easy reference.</p>
                    <button class="btn-primary" id="implantEmptyAddBtn">
                        <i class="fas fa-plus"></i> Add Implant
                    </button>
                </div>
            </div>

            <!-- Modals for Add/Edit Forms -->
            
            <!-- Vaccination Modal -->
            <div class="modal fade" id="vaccinationModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="vaccinationModalTitle">Add Vaccination</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="vaccinationForm">
                                <input type="hidden" id="vaccinationId">
                                
                                <!-- Basic Information -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Vaccine Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="vaccineName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Vaccination Date <span class="text-danger">*</span></label>
                                        <input type="date" class="form-control" id="vaccinationDate" required>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Category <span class="text-danger">*</span></label>
                                        <select class="form-control" id="vaccineCategory" required>
                                            <option value="">Select...</option>
                                            <option>COVID-19</option>
                                            <option>Childhood</option>
                                            <option>Adult</option>
                                            <option>Travel</option>
                                            <option>Flu</option>
                                            <option>Booster</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Dose Number <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="doseNumber" placeholder="e.g., Dose 1, Booster" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Status <span class="text-danger">*</span></label>
                                    <div class="d-flex gap-3 flex-wrap">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="status" id="statusCompleted" value="Completed" checked>
                                            <label class="form-check-label" for="statusCompleted">Completed</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="status" id="statusScheduled" value="Scheduled">
                                            <label class="form-check-label" for="statusScheduled">Scheduled</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="status" id="statusUpcoming" value="Upcoming">
                                            <label class="form-check-label" for="statusUpcoming">Upcoming</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Next Due Date</label>
                                    <input type="date" class="form-control" id="nextDueDate">
                                </div>
                                
                                <!-- Medical Details -->
                                <hr class="my-3">
                                <h6 class="mb-3">Medical Details</h6>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Manufacturer</label>
                                        <input type="text" class="form-control" id="manufacturer" placeholder="e.g., Pfizer, Moderna">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Batch / Lot Number</label>
                                        <input type="text" class="form-control" id="batchLotNumber" placeholder="e.g., ABC123456">
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Hospital / Clinic</label>
                                        <input type="text" class="form-control" id="hospitalClinicName" placeholder="e.g., City Hospital">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Doctor / Nurse</label>
                                        <input type="text" class="form-control" id="doctorNurseName" placeholder="e.g., Dr. Smith">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Side Effects</label>
                                    <textarea class="form-control" id="sideEffects" rows="2" placeholder="e.g., Mild fever, sore arm"></textarea>
                                    <small class="form-text text-muted">Separate multiple side effects with commas</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="vaccinationNotes" rows="2" placeholder="Additional notes..."></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="saveVaccinationBtn">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Allergy Modal -->
            <div class="modal fade" id="allergyModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="allergyModalTitle">Add Allergy</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id ="allergyForm">
                                <input type="hidden" id="allergyId">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Category <span class="text-danger">*</span></label>
                                        <select class="form-control" id="allergyCategory" required>
                                            <option value="">Select...</option>
                                            <option>Food</option>
                                            <option>Drug</option>
                                            <option>Environmental</option>
                                            <option>Other</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Allergen <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="allergen" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Severity <span class="text-danger">*</span></label>
                                    <select class="form-control" id="allergySeverity" required>
                                        <option value="">Select...</option>
                                        <option value="mild">Mild</option>
                                        <option value="moderate">Moderate</option>
                                        <option value="severe">Severe</option>
                                        <option value="life-threatening">Life-Threatening</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Reactions</label>
                                    <textarea class="form-control" id="allergyReaction" rows="2" placeholder="e.g., rashes, swelling"></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">First Reaction Date</label>
                                        <input type="date" class="form-control" id="firstReactionDate">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Active</label>
                                        <select class="form-control" id="allergyActive">
                                            <option value="true">Yes (Active)</option>
                                            <option value="false">No (Archived)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="allergyNotes" rows="2"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="saveAllergyBtn">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Surgery Modal -->
            <div class="modal fade" id="surgeryModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="surgeryModalTitle">Add Surgery</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="surgeryForm">
                                <input type="hidden" id="surgeryId">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Surgery Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="surgeryName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Surgery Date <span class="text-danger">*</span></label>
                                        <input type="date" class="form-control" id="surgeryDate" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Surgery Type <span class="text-danger">*</span></label>
                                        <select class="form-control" id="surgeryType" required>
                                            <option value="">Select...</option>
                                            <option>Minor</option>
                                            <option>Major</option>
                                            <option>Emergency</option>
                                            <option>Elective</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Category</label>
                                        <select class="form-control" id="surgeryCategory">
                                            <option value="">Select...</option>
                                            <option>Orthopedic</option>
                                            <option>Cardiac</option>
                                            <option>Neurological</option>
                                            <option>General</option>
                                            <option>Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Hospital</label>
                                        <input type="text" class="form-control" id="surgeryHospital">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Surgeon Name</label>
                                        <input type="text" class="form-control" id="surgeonName">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Outcome</label>
                                        <select class="form-control" id="surgeryOutcome">
                                            <option value="">Select...</option>
                                            <option>Successful</option>
                                            <option>Complications</option>
                                            <option>Failed</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Follow-up Date</label>
                                        <input type="date" class="form-control" id="followUpDate">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Post-op Notes</label>
                                    <textarea class="form-control" id="postOpNotes" rows="2"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="saveSurgeryBtn">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Implant Modal -->
            <div class="modal fade" id="implantModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="implantModalTitle">Add Implant</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="implantForm">
                                <input type="hidden" id="implantId">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Device Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="deviceName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Category <span class="text-danger">*</span></label>
                                        <select class="form-control" id="implantCategory" required>
                                            <option value="">Select...</option>
                                            <option>Pacemaker</option>
                                            <option>Stent</option>
                                            <option>Prosthetic</option>
                                            <option>Joint Replacement</option>
                                            <option>Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Implantation Date <span class="text-danger">*</span></label>
                                        <input type="date" class="form-control" id="implantDate" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Status</label>
                                        <select class="form-control" id="implantStatus">
                                            <option>Active</option>
                                            <option>Explanted</option>
                                            <option>Recall</option>
                                            <option>Failed</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Manufacturer</label>
                                        <input type="text" class="form-control" id="implantManufacturer">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Model Number</label>
                                        <input type="text" class="form-control" id="modelNumber">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Serial Number</label>
                                        <input type="text" class="form-control" id="serialNumber">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Expiry Date</label>
                                        <input type="date" class="form-control" id="expiryDate">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Surgeon Name</label>
                                        <input type="text" class="form-control" id="implantSurgeon">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Hospital</label>
                                        <input type="text" class="form-control" id="implantHospital">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="implantNotes" rows="2"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="saveImplantBtn">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- General Details Page -->
            <div class="content-page" id="general-details-page">
                <div class="page-header">
                    <h2><i class="fas fa-user"></i> General Details</h2>
                    <button class="btn-primary" id="editDetailsBtn">
                        <i class="fas fa-edit"></i> Edit Details
                    </button>
                </div>
                <div class="details-form">
                    <form id="generalDetailsForm">
                        <!-- Section: Basic Information -->
                        <h5 class="section-heading"><i class="fas fa-id-card"></i> Basic Information</h5>
                        <div class="form-grid two-column">
                            <div class="form-group">
                                <label for="prefix">Prefix</label>
                                <select id="prefix" name="prefix" class="form-control form-control-sm" disabled>
                                    <option value="">{{ user.prefix or 'Select' }}</option>
                                    <option>Mr.</option>
                                    <option>Mrs.</option>
                                    <option>Ms.</option>
                                    <option>Dr.</option>
                                    <option>Prof.</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="first_name">First Name</label>
                                <input id="first_name" name="first_name" type="text" class="form-control" value="{{ user.first_name or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="middle_name">Middle Name</label>
                                <input id="middle_name" name="middle_name" type="text" class="form-control" value="{{ user.middle_name or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="last_name">Last Name</label>
                                <input id="last_name" name="last_name" type="text" class="form-control" value="{{ user.last_name or '' }}" disabled />
                            </div>
                            <div class="form-group full-width">
                                <label for="alias_names">Alias/Previous Names</label>
                                <input id="alias_names" name="alias_names" type="text" class="form-control" value="{{ user.alias_names or '' }}" disabled placeholder="Comma-separated if multiple" />
                            </div>
                            <div class="form-group">
                                <label for="dob_input">Date of Birth</label>
                                <input id="dob_input" name="dob" type="date" class="form-control" value="{{ user.dob.strftime('%Y-%m-%d') if user.dob else '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="age_input">Age</label>
                                <input id="age_input" name="age" type="text" class="form-control" value="" disabled placeholder="Auto-calculated" />
                            </div>
                            <div class="form-group">
                                <label for="gender">Gender</label>
                                <select id="gender" name="gender" class="form-control" disabled>
                                    <option value="" {% if not user.gender %}selected{% endif %}>Select Gender</option>
                                    <option value="Male" {% if user.gender == 'Male' %}selected{% endif %}>Male</option>
                                    <option value="Female" {% if user.gender == 'Female' %}selected{% endif %}>Female</option>
                                    <option value="Other" {% if user.gender == 'Other' %}selected{% endif %}>Other</option>
                                    <option value="Prefer not to say" {% if user.gender == 'Prefer not to say' %}selected{% endif %}>Prefer not to say</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sex_at_birth">Sex at Birth</label>
                                <select id="sex_at_birth" name="sex_at_birth" class="form-control" disabled>
                                    <option value="">{{ user.sex_at_birth or 'Select' }}</option>
                                    <option>Male</option>
                                    <option>Female</option>
                                    <option>Third</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="place_of_birth">Place of Birth</label>
                                <input id="place_of_birth" name="place_of_birth" type="text" class="form-control" value="{{ user.place_of_birth or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="marital_status">Marital Status</label>
                                <select id="marital_status" name="marital_status" class="form-control" disabled>
                                    <option value="">{{ user.marital_status or 'Select' }}</option>
                                    <option>Single</option>
                                    <option>Married</option>
                                    <option>Divorced</option>
                                    <option>Widowed</option>
                                    <option>Separated</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="nationality">Nationality</label>
                                <input id="nationality" name="nationality" type="text" class="form-control" value="{{ user.nationality or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="citizenship_status">Citizenship Status</label>
                                <select id="citizenship_status" name="citizenship_status" class="form-control" disabled>
                                    <option value="">{{ user.citizenship_status or 'Citizen' }}</option>
                                    <option>Citizen</option>
                                    <option>Permanent Resident</option>
                                    <option>Visa Holder</option>
                                    <option>Work Permit</option>
                                    <option>Refugee</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="language_preference">Preferred Language</label>
                                <input id="language_preference" name="language_preference" type="text" class="form-control" value="{{ user.language_preference or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="literacy_status">Literacy Status</label>
                                <select id="literacy_status" name="literacy_status" class="form-control" disabled>
                                    <option value="">{{ user.literacy_status or 'Literate' }}</option>
                                    <option>Literate</option>
                                    <option>Basic</option>
                                    <option>Illiterate</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="education_level">Education Level</label>
                                <select id="education_level" name="education_level" class="form-control" disabled>
                                    <option value="">{{ user.education_level or 'Select' }}</option>
                                    <option>No Formal Education</option>
                                    <option>Primary (5th)</option>
                                    <option>Middle (8th)</option>
                                    <option>Secondary (10th)</option>
                                    <option>Higher Secondary (12th)</option>
                                    <option>Diploma</option>
                                    <option>Graduation</option>
                                    <option>Post Graduation</option>
                                    <option>Doctorate</option>
                                    <option>Professional</option>
                                </select>
                            </div>
                        </div>

                        <!-- Section: Contact Information -->
                        <h5 class="section-heading"><i class="fas fa-phone"></i> Contact Information</h5>
                        <div class="form-grid two-column">
                            <div class="form-group">
                                <label for="email">Email ID</label>
                                <input id="email" name="email" type="email" class="form-control" value="{{ user.email or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="phone">Mobile Number</label>
                                <input id="phone" name="phone" type="tel" class="form-control" value="{{ user.mobile or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="alternate_mobile">Alternate Mobile</label>
                                <input id="alternate_mobile" name="alternate_mobile" type="tel" class="form-control" value="{{ user.alternate_mobile or '' }}" disabled />
                            </div>
                        </div>
                        <div class="form-card bg-light p-3 mb-3">
                            <h6><i class="fas fa-exclamation-triangle text-danger"></i> Emergency Contact 1</h6>
                            <div class="form-grid three-column">
                                <div class="form-group">
                                    <label for="emergency_contact_name">Name</label>
                                    <input id="emergency_contact_name" name="emergency_contact_name" type="text" class="form-control" value="{{ user.emergency_contact_name or '' }}" disabled />
                                </div>
                                <div class="form-group">
                                    <label for="emergency">Phone</label>
                                    <input id="emergency" name="emergency" type="tel" class="form-control" value="{{ user.emergency_contact or '' }}" disabled />
                                </div>
                                <div class="form-group">
                                    <label for="emergency_contact_relation">Relationship</label>
                                    <select id="emergency_contact_relation" name="emergency_contact_relation" class="form-control" disabled>
                                        <option value="">{{ user.emergency_contact_relation or 'Select' }}</option>
                                        <option>Spouse</option>
                                        <option>Parent</option>
                                        <option>Child</option>
                                        <option>Sibling</option>
                                        <option>Friend</option>
                                        <option>Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-card bg-light p-3 mb-3">
                            <h6><i class="fas fa-exclamation-triangle text-warning"></i> Emergency Contact 2</h6>
                            <div class="form-grid three-column">
                                <div class="form-group">
                                    <label for="emergency_contact_name2">Name</label>
                                    <input id="emergency_contact_name2" name="emergency_contact_name2" type="text" class="form-control" value="{{ user.emergency_contact_name2 or '' }}" disabled />
                                </div>
                                <div class="form-group">
                                    <label for="emergency_contact_phone2">Phone</label>
                                    <input id="emergency_contact_phone2" name="emergency_contact_phone2" type="tel" class="form-control" value="{{ user.emergency_contact_phone2 or '' }}" disabled />
                                </div>
                                <div class="form-group">
                                    <label for="emergency_contact_relation2">Relationship</label>
                                    <select id="emergency_contact_relation2" name="emergency_contact_relation2" class="form-control" disabled>
                                        <option value="">{{ user.emergency_contact_relation2 or 'Select' }}</option>
                                        <option>Spouse</option>
                                        <option>Parent</option>
                                        <option>Child</option>
                                        <option>Sibling</option>
                                        <option>Friend</option>
                                        <option>Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-card bg-light p-3 mb-3">
                            <h6><i class="fas fa-exclamation-triangle text-info"></i> Emergency Contact 3</h6>
                            <div class="form-grid three-column">
                                <div class="form-group">
                                    <label for="emergency_contact_name3">Name</label>
                                    <input id="emergency_contact_name3" name="emergency_contact_name3" type="text" class="form-control" value="{{ user.emergency_contact_name3 or '' }}" disabled />
                                </div>
                                <div class="form-group">
                                    <label for="emergency_contact_phone3">Phone</label>
                                    <input id="emergency_contact_phone3" name="emergency_contact_phone3" type="tel" class="form-control" value="{{ user.emergency_contact_phone3 or '' }}" disabled />
                                </div>
                                <div class="form-group">
                                    <label for="emergency_contact_relation3">Relationship</label>
                                    <select id="emergency_contact_relation3" name="emergency_contact_relation3" class="form-control" disabled>
                                        <option value="">{{ user.emergency_contact_relation3 or 'Select' }}</option>
                                        <option>Spouse</option>
                                        <option>Parent</option>
                                        <option>Child</option>
                                        <option>Sibling</option>
                                        <option>Friend</option>
                                        <option>Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Address Details -->
                        <h5 class="section-heading"><i class="fas fa-map-marker-alt"></i> Address Details</h5>
                        <div class="form-grid two-column">
                            <div class="form-group full-width">
                                <label for="building">Building / Flat / House No.</label>
                                <input id="building" name="building" type="text" class="form-control" value="{{ user.building_details or '' }}" disabled />
                            </div>
                            <div class="form-group full-width">
                                <label for="street">Street Name</label>
                                <input id="street" name="street" type="text" class="form-control" value="{{ user.street_name or '' }}" disabled />
                            </div>
                            <div class="form-group full-width">
                                <label for="locality">Locality</label>
                                <input id="locality" name="locality" type="text" class="form-control" value="{{ user.locality or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="village">Village</label>
                                <input id="village" name="village" type="text" class="form-control" value="{{ user.village or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="block">Block/Tehsil/County</label>
                                <input id="block" name="block" type="text" class="form-control" value="{{ user.block or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="district">District</label>
                                <input id="district" name="district" type="text" class="form-control" value="{{ user.district or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="city">City</label>
                                <input id="city" name="city" type="text" class="form-control" value="{{ user.city or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="state">State</label>
                                <input id="state" name="state" type="text" class="form-control" value="{{ user.state or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="pincode">Pincode / Zip code</label>
                                <input id="pincode" name="pincode" type="text" class="form-control" value="{{ user.postal_code or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="country">Country</label>
                                <input id="country" name="country" type="text" class="form-control" value="{{ user.country or 'India' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="region">Region/Continent</label>
                                <select id="region" name="region" class="form-control" disabled>
                                    <option value="">{{ user.region or 'Asia' }}</option>
                                    <option>Asia</option>
                                    <option>Europe</option>
                                    <option>North America</option>
                                    <option>South America</option>
                                    <option>Africa</option>
                                    <option>Oceania</option>
                                    <option>Antarctica</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="migration_status">Migration Status</label>
                                <select id="migration_status" name="migration_status" class="form-control" disabled>
                                    <option value="">{{ user.migration_status or 'Permanent' }}</option>
                                    <option>Permanent</option>
                                    <option>Migrant</option>
                                    <option>Seasonal</option>
                                    <option>Refugee</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="homeless_status">Homeless/Shelter Status</label>
                                <input type="checkbox" id="homeless_status" name="homeless_status" class="form-check-input" {{ 'checked' if user.homeless_status else '' }} disabled />
                                <label class="form-check-label" for="homeless_status">Currently homeless or in shelter</label>
                            </div>
                        </div>

                        <!-- Section: GPS Location -->
                        <h5 class="section-heading"><i class="fas fa-map-marker-alt"></i> GPS Location</h5>
                        <div class="form-grid two-column">
                            <div class="form-group">
                                <label for="latitude">Latitude</label>
                                <input id="latitude" name="latitude" type="text" class="form-control" value="{{ user.latitude or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="longitude">Longitude</label>
                                <input id="longitude" name="longitude" type="text" class="form-control" value="{{ user.longitude or '' }}" disabled />
                            </div>
                            {% if user.latitude and user.longitude %}
                            <div class="form-group full-width">
                                <a href="https://www.google.com/maps?q={{ user.latitude }},{{ user.longitude }}" target="_blank" class="btn btn-outline-primary btn-sm" style="border-color: #b71c1c; color: white; background-color: #b71c1c;">
                                    <i class="fas fa-external-link-alt me-1"></i> View on Google Maps
                                </a>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Section: Identity & Documents -->
                        <h5 class="section-heading"><i class="fas fa-id-badge"></i> Identity & Documents</h5>
                        <div class="form-grid two-column">
                            <div class="form-group">
                                <label for="national_health_id">National Health ID (ABHA)</label>
                                <input id="national_health_id" name="national_health_id" type="text" class="form-control" value="{{ user.national_health_id or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="aadhaar">Aadhaar / Govt. ID</label>
                                <input id="aadhaar" name="aadhaar" type="text" class="form-control" value="{{ user.aadhaar or '' }}" disabled />
                            </div>
                            <div class="form-group">
                                <label for="passport_number">Passport Number</label>
                                <input id="passport_number" name="passport_number" type="text" class="form-control" value="{{ user.passport_number or '' }}" disabled />
                            </div>
                        </div>

                        <!-- Section: Health Information -->
                        <h5 class="section-heading"><i class="fas fa-heartbeat"></i> Health Information</h5>
                        <div class="form-grid two-column">
                            <div class="form-group">
                                <label for="blood_group">Blood Group</label>
                                <select id="blood_group" name="blood_group" class="form-control" disabled>
                                    <option>{{ user.blood_group or 'Select Blood Group' }}</option>
                                    <option>A</option>
                                    <option>B</option>
                                    <option>AB</option>
                                    <option>O</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="rh_factor">Rh Factor</label>
                                <select id="rh_factor" name="rh_factor" class="form-control" disabled>
                                    <option>{{ user.blood_rh or 'Select Rh' }}</option>
                                    <option>+</option>
                                    <option>-</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            

            <!-- Household Details Page (Read-Only) -->
            <div class="content-page" id="household-page">
                <div class="page-header">
                    <h2><i class="fas fa-home"></i> Household Details</h2>
                </div>
                
                {% if user.household_member and user.household_member.household %}
                {% set household = user.household_member.household %}
                <div class="card" style="padding: 24px;">
                    <!-- Household Info Header -->
                    <div class="d-flex justify-content-between align-items-start mb-4 pb-3 border-bottom">
                        <div>
                            <h4 class="mb-1"><i class="fas fa-home text-danger me-2"></i>{{ household.head_name }}'s Household</h4>
                            <span class="badge bg-secondary">{{ household.household_id }}</span>
                        </div>
                        <span class="badge bg-{{ 'danger' if household.risk_level == 'high' else ('warning' if household.risk_level == 'medium' else 'success') }} px-3 py-2">
                            {{ household.risk_level|capitalize }} Risk
                        </span>
                    </div>
                    
                    <!-- Basic Info -->
                    <h5 class="section-heading"><i class="fas fa-info-circle"></i> Basic Information</h5>
                    <div class="form-grid two-column mb-4">
                        <div class="form-group">
                            <label>Head of Household</label>
                            <input type="text" class="form-control" value="{{ household.head_name or '' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Village</label>
                            <input type="text" class="form-control" value="{{ household.village or '' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <input type="text" class="form-control" value="{{ household.address or '' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="text" class="form-control" value="{{ household.phone or '' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Total Members</label>
                            <input type="text" class="form-control" value="{{ household.total_members or household.family_size or '' }}" disabled />
                        </div>
                    </div>
                    
                    <!-- Social Category -->
                    <h5 class="section-heading"><i class="fas fa-users"></i> Social Category</h5>
                    <div class="form-grid two-column mb-4">
                        <div class="form-group">
                            <label>Caste/Tribe/Ethnicity</label>
                            <input type="text" class="form-control" value="{{ household.caste_tribe_ethnicity or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Religion</label>
                            <input type="text" class="form-control" value="{{ household.religion or 'Not specified' }}" disabled />
                        </div>
                    </div>
                    
                    <!-- Employment & Income -->
                    <h5 class="section-heading"><i class="fas fa-briefcase"></i> Employment & Income</h5>
                    <div class="form-grid two-column mb-4">
                        <div class="form-group">
                            <label>Occupation</label>
                            <input type="text" class="form-control" value="{{ household.occupation or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Employer Type</label>
                            <input type="text" class="form-control" value="{{ household.employer_type or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Income Category</label>
                            <input type="text" class="form-control" value="{{ household.income_category or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Poverty Index</label>
                            <input type="text" class="form-control" value="{{ household.poverty_index or 'Not specified' }}" disabled />
                        </div>
                    </div>
                    
                    <!-- Education & Welfare -->
                    <h5 class="section-heading"><i class="fas fa-graduation-cap"></i> Education & Welfare</h5>
                    <div class="form-grid two-column mb-4">
                        <div class="form-group">
                            <label>Education Level</label>
                            <input type="text" class="form-control" value="{{ household.education_level or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Ration Card Number</label>
                            <input type="text" class="form-control" value="{{ household.ration_card_number or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Ration Card Type</label>
                            <input type="text" class="form-control" value="{{ household.ration_card_type or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Welfare Schemes</label>
                            <input type="text" class="form-control" value="{{ household.welfare_schemes or 'None enrolled' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Disability Certificate</label>
                            <input type="text" class="form-control" value="{{ household.disability_certificate or 'Not applicable' }}" disabled />
                        </div>
                    </div>
                    
                    <!-- Housing & Utilities -->
                    <h5 class="section-heading"><i class="fas fa-home"></i> Housing & Utilities</h5>
                    <div class="form-grid two-column mb-4">
                        <div class="form-group">
                            <label>Housing Type</label>
                            <input type="text" class="form-control" value="{{ household.housing_type or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Ownership Status</label>
                            <input type="text" class="form-control" value="{{ household.ownership_status or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Water Source</label>
                            <input type="text" class="form-control" value="{{ household.water_source or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Sanitation Facility</label>
                            <input type="text" class="form-control" value="{{ household.sanitation_facility or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group">
                            <label>Cooking Fuel</label>
                            <input type="text" class="form-control" value="{{ household.cooking_fuel or 'Not specified' }}" disabled />
                        </div>
                        <div class="form-group d-flex gap-4 pt-3">
                            <div>
                                <i class="fas fa-bolt {{ 'text-success' if household.electricity_available else 'text-muted' }} me-1"></i>
                                Electricity: <strong>{{ 'Yes' if household.electricity_available else 'No' }}</strong>
                            </div>
                            <div>
                                <i class="fas fa-wifi {{ 'text-success' if household.internet_available else 'text-muted' }} me-1"></i>
                                Internet: <strong>{{ 'Yes' if household.internet_available else 'No' }}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3 mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        This information is maintained by your assigned health worker. Contact them for any updates.
                    </div>
                </div>
                {% else %}
                <div class="card" style="padding: 40px; text-align: center;">
                    <i class="fas fa-home fa-4x text-muted mb-3" style="opacity: 0.3;"></i>
                    <h4 class="text-muted">No Household Linked</h4>
                    <p class="text-muted mb-0">You are not currently linked to any household. Please contact your local health worker to get registered with a household.</p>
                </div>
                {% endif %}
            </div>

            <!-- Medical History Page (Read-Only) -->
            <div class="content-page" id="medical-history-page">
                <div class="page-header">
                    <h2><i class="fas fa-notes-medical"></i> Medical History</h2>
                </div>
                
                <div class="alert alert-info mb-4">
                    <i class="fas fa-info-circle me-2"></i>
                    This section shows your complete medical history including chronic conditions, past illnesses, hospitalizations, and more. Contact your doctor or health worker to update these records.
                </div>

                <div id="clientMedicalHistoryContent">
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <p>Loading medical history...</p>
                    </div>
                </div>
            </div>

            <!-- Lifestyle & Risk Page (Read-Only) -->
            <div class="content-page" id="lifestyle-page">
                <div class="page-header">
                    <h2><i class="fas fa-running"></i> Lifestyle & Risk Assessment</h2>
                </div>
                
                <div class="alert alert-info mb-4">
                    <i class="fas fa-info-circle me-2"></i>
                    This section shows your lifestyle factors and health risk assessment. Contact your health worker to update these records.
                </div>

                <div id="clientLifestyleContent">
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <p>Loading lifestyle assessment...</p>
                    </div>
                </div>
            </div>

            <!-- My Vitals Page - Enhanced with KPIs, Forms & Charts -->
            <div class="content-page" id="my-vitals-page">
                <div class="page-header">
                    <h2><i class="fas fa-heartbeat"></i> My Vitals</h2>
                    <button class="btn-primary" id="addVitalBtn" onclick="openVitalModal('general')">
                        <i class="fas fa-plus-circle"></i> Record Vitals
                    </button>
                </div>
                
                <!-- 3 KPI Cards -->
                <div class="vitals-kpi-grid">
                    <!-- Heart Watch KPI -->
                    <div class="vitals-kpi-card heart-watch" onclick="openVitalModal('heart_watch')">
                        <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, #ff6b6b 0%, #d63031 100%);">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="kpi-content">
                            <h4 class="kpi-title">Heart Watch</h4>
                            <p class="kpi-desc">Blood Pressure & Heart Rate</p>
                            <div class="kpi-values" id="heartWatchValues">
                                <span class="kpi-value-main">--/-- mmHg</span>
                                <span class="kpi-value-sub"><b>-- bpm</b></span>
                            </div>
                        </div>
                        <div class="kpi-action">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                    </div>
                    
                    <!-- Diabetes Watch KPI -->
                    <div class="vitals-kpi-card diabetes-watch" onclick="openVitalModal('diabetes_watch')">
                        <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="kpi-content">
                            <h4 class="kpi-title">Diabetes Watch</h4>
                            <p class="kpi-desc">Blood Sugar Levels</p>
                            <div class="kpi-values" id="diabetesWatchValues">
                                <span class="kpi-value-main">-- mg/dL</span>
                            </div>
                        </div>
                        <div class="kpi-action">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                    </div>
                    
                    <!-- Obese Watch KPI -->
                    <div class="vitals-kpi-card obese-watch" onclick="openVitalModal('obese_watch')">
                        <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);">
                            <i class="fas fa-weight"></i>
                        </div>
                        <div class="kpi-content">
                            <h4 class="kpi-title">Obese Watch</h4>
                            <p class="kpi-desc">Weight & BMI Tracking</p>
                            <div class="kpi-values" id="obeseWatchValues">
                                <span class="kpi-value-main">-- kg</span>
                                <span class="kpi-value-sub">BMI: --</span>
                            </div>
                        </div>
                        <div class="kpi-action">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Vitals History Section -->
                <div class="vitals-history-section">
                    <div class="section-header">
                        <h3><i class="fas fa-history"></i> Vitals History</h3>
                        <div class="history-filters">
                            <button class="filter-btn active" data-days="7">Last 7 Days</button>
                            <button class="filter-btn" data-days="30">Last 30 Days</button>
                            <button class="filter-btn" data-days="0">All Time</button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table vitals-table" id="vitalsHistoryTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Blood Pressure</th>
                                    <th>Heart Rate</th>
                                    <th>Blood Sugar</th>
                                    <th>Weight</th>
                                    <th>BMI</th>
                                    <th>SpO2</th>
                                    <th>Temp</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vitalsHistoryBody">
                                <tr>
                                    <td colspan="9" class="text-center text-muted py-4">
                                        <i class="fas fa-spinner fa-spin me-2"></i> Loading vitals...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="vitals-charts-section">
                    <div class="section-header">
                        <h3><i class="fas fa-chart-line"></i> Vitals Trends</h3>
                        <div class="chart-filters" id="chartFilterBtns">
                            <button class="filter-btn active" data-range="7">7 Days</button>
                            <button class="filter-btn" data-range="30">30 Days</button>
                            <button class="filter-btn" data-range="90">90 Days</button>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <!-- Heart Rate Chart -->
                        <div class="chart-card">
                            <h5><i class="fas fa-heartbeat text-danger"></i> Heart Rate & Blood Pressure</h5>
                            <canvas id="heartRateChart" height="200"></canvas>
                        </div>
                        
                        <!-- Blood Sugar Chart -->
                        <div class="chart-card">
                            <h5><i class="fas fa-tint text-info"></i> Blood Sugar Levels</h5>
                            <canvas id="bloodSugarChart" height="200"></canvas>
                        </div>
                        
                        <!-- Weight/BMI Chart -->
                        <div class="chart-card">
                            <h5><i class="fas fa-weight text-success"></i> Weight & BMI</h5>
                            <canvas id="weightBmiChart" height="200"></canvas>
                        </div>
                        
                        <!-- Temperature & SpO2 Chart -->
                        <div class="chart-card">
                            <h5><i class="fas fa-thermometer-half text-warning"></i> Temperature & SpO2</h5>
                            <canvas id="tempSpo2Chart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>


            <!-- My Investigations Page (Read-Only) - Phase 4 -->
            <div class="content-page" id="my-investigations-page">
                <div class="page-header">
                    <h2><i class="fas fa-flask"></i> Lab & Investigations</h2>
                </div>
                
                <div class="alert alert-info mb-4">
                    <i class="fas fa-info-circle me-2"></i>
                    This section shows your lab tests, imaging, and other investigations. Results are updated as they become available.
                </div>

                <div id="clientInvestigationsContent">
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <p>Loading investigations...</p>
                    </div>
                </div>
            </div>

            <!-- Medical Records Page -->
            <div class="content-page" id="medical-records-page">
                <div class="page-header">
                    <h2><i class="fas fa-file-medical"></i> Medical Records</h2>
                    <button class="btn-primary" id="uploadDocumentBtn">
                        <i class="fas fa-cloud-upload-alt"></i> Upload Document
                    </button>
                </div>

                <!-- HIV/STD Status Card -->
                <div class="hiv-std-status-card" id="hivStdStatusCard">
                    <div class="status-info">
                        <div class="status-icon">
                            <i class="fas fa-shield-virus"></i>
                        </div>
                        <div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <strong style="font-size: 1.1rem;">HIV/STD Status:</strong>
                                <span class="hiv-status-badge badge-unknown">Unknown</span>
                            </div>
                            <p class="hiv-last-test mb-0">No test date recorded</p>
                        </div>
                    </div>
                    <button class="btn btn-outline-danger" onclick="openHivStdModal()">
                        <i class="fas fa-edit me-1"></i>Update Status
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="medical-summary-grid">
                    <div class="summary-card">
                        <div class="summary-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <div class="summary-content">
                            <p class="summary-label">Total Records</p>
                            <h3 class="summary-value" id="totalRecordsCount">0</h3>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="summary-content">
                            <p class="summary-label">Lab Tests</p>
                            <h3 class="summary-value" id="labTestsCount">0</h3>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-x-ray"></i>
                        </div>
                        <div class="summary-content">
                            <p class="summary-label">Imaging</p>
                            <h3 class="summary-value" id="imagingCount">0</h3>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-notes-medical"></i>
                        </div>
                        <div class="summary-content">
                            <p class="summary-label">Other Reports</p>
                            <h3 class="summary-value" id="otherReportsCount">0</h3>
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filters-section">
                    <div class="filter-tabs" id="recordTypeFilters">
                        <button class="filter-tab active" data-type="all">
                            <i class="fas fa-list"></i> All Records
                        </button>
                        <button class="filter-tab" data-type="Blood Test">
                            <i class="fas fa-tint"></i> Blood Test
                        </button>
                        <button class="filter-tab" data-type="X-Ray">
                            <i class="fas fa-x-ray"></i> X-Ray
                        </button>
                        <button class="filter-tab" data-type="MRI">
                            <i class="fas fa-brain"></i> MRI
                        </button>
                        <button class="filter-tab" data-type="CT Scan">
                            <i class="fas fa-procedures"></i> CT Scan
                        </button>
                        <button class="filter-tab" data-type="Ultrasound">
                            <i class="fas fa-baby"></i> Ultrasound
                        </button>
                        <button class="filter-tab" data-type="Prescription">
                            <i class="fas fa-prescription"></i> Prescription
                        </button>
                        <button class="filter-tab" data-type="Other">
                            <i class="fas fa-file-alt"></i> Other
                        </button>
                    </div>
                    <div class="filter-actions">
                        <button class="btn-secondary" id="exportRecordsBtn" disabled>
                            <i class="fas fa-file-export"></i> Export
                        </button>
                        <button class="btn-secondary" id="shareRecordsBtn" disabled>
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                    </div>
                </div>

                <!-- Records Grid -->
                <div class="records-grid-container" id="recordsGridContainer">
                    <!-- Empty state -->
                    <div class="empty-state-card" id="emptyStateCard" style="display: none;">
                        <i class="fas fa-folder-open"></i>
                        <p>No medical records found</p>
                        <button class="btn-primary" onclick="document.getElementById('uploadDocumentBtn').click()">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Your First Document
                        </button>
                    </div>
                    
                    <!-- Records will be dynamically inserted here as cards -->
                </div>
            </div>

            <!-- Appointments Page -->
            <div class="content-page" id="appointments-page">
                <div class="appointments-hero">
                    <div>
                        <h2><i class="fas fa-calendar-heart"></i> Appointments Center</h2>
                        <p>Track upcoming visits, reschedule with one click, and start video consultations instantly.</p>
                    </div>
                    <div class="appointments-hero-actions">
                        <button class="btn-primary" id="bookAppointmentBtn">
                            <i class="fas fa-plus-circle"></i> Book New Appointment
                        </button>
                        <button class="btn-secondary ghost" id="findDoctorCTA">
                            <i class="fas fa-user-md"></i> Find a Doctor
                        </button>
                    </div>
                </div>

                <div class="appointments-stats-grid">
                    <div class="appointment-stat-card">
                        <div class="stat-label">
                            <span>Upcoming</span>
                            <small>Scheduled within next 30 days</small>
                        </div>
                        <div class="stat-value" id="statUpcomingCount">0</div>
                    </div>
                    <div class="appointment-stat-card">
                        <div class="stat-label">
                            <span>Completed</span>
                            <small>Consultations completed</small>
                        </div>
                        <div class="stat-value" id="statCompletedCount">0</div>
                    </div>
                    <div class="appointment-stat-card">
                        <div class="stat-label">
                            <span>Rescheduled</span>
                            <small>Awaiting new confirmations</small>
                        </div>
                        <div class="stat-value" id="statRescheduledCount">0</div>
                    </div>
                    <div class="appointment-stat-card danger">
                        <div class="stat-label">
                            <span>Cancelled</span>
                            <small>Cancelled in last 60 days</small>
                        </div>
                        <div class="stat-value" id="statCancelledCount">0</div>
                    </div>
                </div>

                <div class="appointment-quick-actions">
                    <button class="appointment-action-btn primary" id="quickBookBtn">
                        <i class="fas fa-calendar-plus"></i> Book New Appointment
                    </button>
                    <button class="appointment-action-btn" id="quickFindDoctorBtn">
                        <i class="fas fa-user-md"></i> Find a Doctor
                    </button>
                    <button class="appointment-action-btn" id="quickVideoBtn">
                        <i class="fas fa-video"></i> Video Consultation
                    </button>
                    <button class="appointment-action-btn danger" id="quickEmergencyBtn">
                        <i class="fas fa-ambulance"></i> Emergency
                    </button>
                </div>

                <div class="appointments-layout">
                    <div class="appointments-calendar-card">
                        <div class="calendar-card-header">
                            <div>
                                <h4>30-day Planner</h4>
                                <p id="appointmentsCalendarMonth">November 2024</p>
                            </div>
                            <div class="calendar-nav">
                                <button id="appointmentsCalendarPrev"><i class="fas fa-chevron-left"></i></button>
                                <button id="appointmentsCalendarNext"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <div class="mini-calendar" id="appointmentsMiniCalendar">
                            <!-- Calendar days inserted dynamically -->
                        </div>
                        <div class="calendar-legend">
                            <span><span class="dot upcoming"></span> Upcoming</span>
                            <span><span class="dot today"></span> Today</span>
                            <span><span class="dot cancelled"></span> Cancelled</span>
                        </div>
                    </div>

                    <div class="appointments-list-card">
                        <div class="appointments-tabs">
                            <button class="appointments-tab-btn active" data-tab="upcoming">Upcoming</button>
                            <button class="appointments-tab-btn" data-tab="today">Today</button>
                            <button class="appointments-tab-btn" data-tab="past">Past</button>
                            <button class="appointments-tab-btn" data-tab="cancelled">Cancelled</button>
                        </div>

                        <div class="appointments-filter-banner" id="appointmentsFilterBanner" style="display: none;">
                            <span id="appointmentsFilterLabel"></span>
                            <button id="clearAppointmentsFilter" class="filter-clear-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div class="appointments-list" id="appointmentsListContainer">
                            <div class="appointments-empty" id="appointmentsEmptyState">
                                <i class="fas fa-calendar-xmark"></i>
                                <p>No appointments in this view.</p>
                                <button class="btn-primary small" id="emptyStateBookBtn">
                                    <i class="fas fa-plus"></i> Book Your First Appointment
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pharmacy Services Page -->
            <div class="content-page" id="pharmacy-page">
                <div class="page-header">
                    <h2><i class="fas fa-pills"></i> Pharmacy Services</h2>
                </div>
                
                <div class="row">
                    <!-- Main Action Area -->
                    <div class="col-md-8">
                        <div class="card pharmacy-card mb-4 shadow-sm border-0">
                            <div class="card-body p-4">
                                <h5 class="card-title mb-4">New Pharmacy Request</h5>
                                <form id="unifiedPharmacyRequestForm">
                                    <!-- Pharmacy Selection -->
                                    <div class="mb-3">
                                        <label class="form-label">Select Pharmacy <span class="text-danger">*</span></label>
                                        <select class="form-select pharmacy-select" name="pharmacyId" required>
                                            <option value="" selected disabled>Loading pharmacies...</option>
                                        </select>
                                    </div>

                                    <!-- Prescription Details -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Doctor Name</label>
                                            <input type="text" class="form-control" name="doctorName" placeholder="e.g. Dr. Smith">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Prescription Date</label>
                                            <input type="date" class="form-control" name="prescriptionDate">
                                        </div>
                                    </div>

                                    <!-- File Upload -->
                                    <div class="mb-4">
                                        <label class="form-label">Upload Prescription (Optional)</label>
                                        <input type="file" class="form-control" name="file" accept=".pdf,.jpg,.jpeg,.png">
                                        <div class="form-text">Allowed: PDF, JPG, PNG (Max 10MB)</div>
                                    </div>

                                    <hr class="my-4">

                                    <!-- Medicine List -->
                                    <div class="mb-3">
                                        <label class="form-label d-block">Medicines (Optional)</label>
                                        <div id="medicineListContainer">
                                            <!-- Dynamic rows will be added here -->
                                            <div class="row g-2 mb-2 medicine-row">
                                                <div class="col-7">
                                                    <input type="text" class="form-control" name="medicineName[]" placeholder="Medicine Name">
                                                </div>
                                                <div class="col-3">
                                                    <input type="text" class="form-control" name="medicineQty[]" placeholder="Qty">
                                                </div>
                                                <div class="col-2">
                                                    <button type="button" class="btn btn-outline-danger w-100 remove-medicine-row" disabled>
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="addMedicineRowBtn">
                                            <i class="fas fa-plus me-1"></i> Add Another Medicine
                                        </button>
                                    </div>

                                    <!-- Notes -->
                                    <div class="mb-4">
                                        <label class="form-label">Notes / Instructions</label>
                                        <textarea class="form-control" name="notes" rows="2" placeholder="Any specific instructions..."></textarea>
                                    </div>

                                    <!-- Submit -->
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-danger btn-lg">
                                            <i class="fas fa-paper-plane me-2"></i> Submit Request
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- My Requests Sidebar -->
                    <div class="col-md-4">
                        <div class="card pharmacy-card h-100 shadow-sm border-0">
                            <div class="card-header bg-white border-bottom-0 pt-4 pb-0">
                                <h5 class="fw-bold mb-0">My Requests</h5>
                            </div>
                            <div class="card-body">
                                <div id="requestsList" class="d-flex flex-column gap-3">
                                    <div class="text-center py-4 text-muted">
                                        <div class="spinner-border spinner-border-sm text-danger" role="status"></div>
                                        <span class="ms-2">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Pill Reminder Page -->
            <div class="content-page" id="pill-reminder-page">
                <div class="page-header">
                    <h2><i class="fas fa-pills"></i> Pill Reminder</h2>
                    <button class="btn-primary" id="addMedicationBtn" onclick="openMedicationModal()">
                        <i class="fas fa-plus-circle"></i> Add Medication
                    </button>
                </div>
                
                <!-- KPI Stats Cards -->
                <div class="pill-stats-grid">
                    <div class="pill-stat-card">
                        <div class="pill-stat-icon" style="background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="pill-stat-content">
                            <p class="pill-stat-label">Today's Pills</p>
                            <h3 class="pill-stat-value" id="pillStatToday">0 of 0</h3>
                        </div>
                    </div>
                    <div class="pill-stat-card">
                        <div class="pill-stat-icon" style="background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="pill-stat-content">
                            <p class="pill-stat-label">Adherence Rate</p>
                            <h3 class="pill-stat-value" id="pillStatAdherence">100%</h3>
                        </div>
                    </div>
                    <div class="pill-stat-card">
                        <div class="pill-stat-icon" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);">
                            <i class="fas fa-capsules"></i>
                        </div>
                        <div class="pill-stat-content">
                            <p class="pill-stat-label">Active Medications</p>
                            <h3 class="pill-stat-value" id="pillStatActive">0</h3>
                        </div>
                    </div>
                    <div class="pill-stat-card">
                        <div class="pill-stat-icon" style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="pill-stat-content">
                            <p class="pill-stat-label">Next Dose</p>
                            <h3 class="pill-stat-value" id="pillStatNext">--</h3>
                        </div>
                    </div>
                </div>
                
                <!-- Today's Schedule Section -->
                <div class="card pill-schedule-card mt-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-calendar-day text-primary me-2"></i>Today's Schedule</h5>
                        <span class="badge bg-primary text-white" id="todayDateBadge" style="color: #fff !important;"></span>
                    </div>
                    <div class="card-body">
                        <div id="todayScheduleContainer">
                            <div class="text-center py-4 text-muted">
                                <i class="fas fa-spinner fa-spin me-2"></i> Loading schedule...
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- My Medications Grid -->
                <div class="card mt-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-capsules text-success me-2"></i>My Medications</h5>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="showInactiveMeds">
                            <label class="form-check-label small" for="showInactiveMeds">Show Inactive</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="medicationsGrid" class="medications-grid">
                            <div class="text-center py-4 text-muted">
                                <i class="fas fa-spinner fa-spin me-2"></i> Loading medications...
                            </div>
                        </div>
                        
                        <!-- Empty State -->
                        <div id="medicationsEmptyState" class="text-center py-5" style="display: none;">
                            <i class="fas fa-pills fa-4x text-muted mb-3"></i>
                            <h5>No medications added yet</h5>
                            <p class="text-muted">Add your medications to get reminders and track your adherence.</p>
                            <button class="btn btn-primary" onclick="openMedicationModal()">
                                <i class="fas fa-plus-circle me-2"></i>Add Your First Medication
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Refill Alert -->
                <div id="refillAlertSection" class="alert alert-warning mt-4" style="display: none;">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Low Stock Alert</h6>
                    <p class="mb-2 small">The following medications are running low:</p>
                    <ul id="lowStockList" class="mb-0"></ul>
                </div>
                
                <!-- History Section -->
                <div class="card mt-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-history text-info me-2"></i>Medication History</h5>
                        <div class="btn-group btn-group-sm" id="historyFilterBtns">
                            <button class="btn btn-outline-primary active" data-days="7">7 Days</button>
                            <button class="btn btn-outline-primary" data-days="14">14 Days</button>
                            <button class="btn btn-outline-primary" data-days="30">30 Days</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Medication</th>
                                        <th>Dosage</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="pillHistoryBody">
                                    <tr>
                                        <td colspan="5" class="text-center py-4 text-muted">Loading history...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Adherence Chart -->
                <div class="card mt-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="fas fa-chart-pie text-danger me-2"></i>Adherence Overview</h5>
                    </div>
                    <div class="card-body">
                        <div class="adherence-bars">
                            <div class="adherence-bar-item">
                                <div class="d-flex justify-content-between mb-1">
                                    <span><i class="fas fa-check-circle text-success me-1"></i> Taken</span>
                                    <span id="adherenceTakenPct">0%</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-success" id="adherenceTakenBar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="adherence-bar-item mt-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span><i class="fas fa-forward text-warning me-1"></i> Skipped</span>
                                    <span id="adherenceSkippedPct">0%</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-warning" id="adherenceSkippedBar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="adherence-bar-item mt-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span><i class="fas fa-times-circle text-danger me-1"></i> Missed</span>
                                    <span id="adherenceMissedPct">0%</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-danger" id="adherenceMissedBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Blood Requests / Donate Page -->
            <div class="content-page" id="blood-requests-page">
                <div class="page-header">
                    <h2><i class="fas fa-tint"></i> Blood Donation & Requests</h2>
                </div>
                
                <!-- Donor Profile Stats -->
                <div class="stats-grid mb-4">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #E63946, #c1121f); color: #fff;">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Blood Group</p>
                            <h3 class="stat-value" id="bloodStatGroup">{{ (user.blood_group or '') + (user.blood_rh or '') if user.blood_group else 'Not Set' }}</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: #fff;">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Donations</p>
                            <h3 class="stat-value" id="bloodStatDonations">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #2196F3, #1565C0); color: #fff;">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last Donation</p>
                            <h3 class="stat-value" id="bloodStatLastDonation">-</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #FF9800, #E65100); color: #fff;">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Next Eligible</p>
                            <h3 class="stat-value" id="bloodStatNextEligible">-</h3>
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-4" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#bloodDonorTab">
                            <i class="fas fa-user-plus me-2"></i>Become a Donor
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#bloodRequestTab">
                            <i class="fas fa-search me-2"></i>Request Blood
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#bloodHistoryTab">
                            <i class="fas fa-history me-2"></i>My History
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <!-- Become a Donor Tab -->
                    <div class="tab-pane fade show active" id="bloodDonorTab">
                        <div class="row">
                            <!-- Donor Registration Card -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-danger text-white">
                                        <h6 class="mb-0"><i class="fas fa-heart me-2"></i>Blood Donor Registration</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex align-items-center justify-content-between mb-4 p-3 bg-light rounded">
                                            <div>
                                                <h6 class="mb-1">I am available to donate blood</h6>
                                                <small class="text-muted">Enable this to be listed as an active donor</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="bloodDonorAvailable" style="width: 3rem; height: 1.5rem;">
                                            </div>
                                        </div>
                                        
                                        <div id="donorPreferencesSection" style="display: none;">
                                            <h6 class="text-danger mb-3"><i class="fas fa-cog me-2"></i>Donor Preferences</h6>
                                            
                                            <div class="mb-3">
                                                <label class="form-label">Preferred Donation Type</label>
                                                <select class="form-select" id="preferredDonationType">
                                                    <option value="Whole Blood">Whole Blood</option>
                                                    <option value="Plasma">Plasma</option>
                                                    <option value="Platelets">Platelets</option>
                                                    <option value="Any">Any Type</option>
                                                </select>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label class="form-label">Location/City</label>
                                                <input type="text" class="form-control" id="donorPreferredCity" placeholder="Your city">
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label class="form-label">Availability</label>
                                                <select class="form-select" id="donorAvailability">
                                                    <option value="Available">Available (Anytime)</option>
                                                    <option value="Weekdays">Weekdays Only</option>
                                                    <option value="Weekends">Weekends Only</option>
                                                    <option value="Emergency">Emergency Only</option>
                                                </select>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="donorConsentContact" checked>
                                                    <label class="form-check-label">I consent to be contacted by blood banks when my blood type is needed</label>
                                                </div>
                                            </div>
                                            
                                            <button type="button" class="btn btn-danger w-100" id="saveDonorPreferencesBtn">
                                                <i class="fas fa-save me-2"></i>Save Donor Preferences
                                            </button>
                                        </div>
                                        
                                        <div id="donorNotRegisteredMessage">
                                            <div class="text-center py-3">
                                                <i class="fas fa-tint fa-3x text-muted mb-3"></i>
                                                <p class="text-muted">Toggle the switch above to register as a blood donor and help save lives!</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Blood Donation Info -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Blood Donation Info</h6>
                                    </div>
                                    <div class="card-body">
                                        <h6 class="text-danger">Eligibility Criteria</h6>
                                        <ul class="small">
                                            <li>Age: 18-65 years</li>
                                            <li>Weight: Minimum 50 kg</li>
                                            <li>Hemoglobin: Minimum 12.5 g/dL</li>
                                            <li>No recent illness or surgery</li>
                                            <li>56 days gap between whole blood donations</li>
                                        </ul>
                                        <hr>
                                        <h6 class="text-danger">Waiting Period After Donation</h6>
                                        <table class="table table-sm">
                                            <tr><td>Whole Blood</td><td class="text-end"><strong>56 days</strong></td></tr>
                                            <tr><td>Plasma</td><td class="text-end"><strong>28 days</strong></td></tr>
                                            <tr><td>Platelets</td><td class="text-end"><strong>7 days</strong></td></tr>
                                            <tr><td>Power Red</td><td class="text-end"><strong>112 days</strong></td></tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Record Blood Donation Section -->
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Record Past Donation</h6>
                            </div>
                            <div class="card-body">
                                <p class="text-muted small mb-3">Already donated? Record your past donation here to track your history.</p>
                                <form id="bloodDonationForm">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Donation Date <span class="text-danger">*</span></label>
                                            <input type="date" class="form-control" id="bloodDonationDate" required>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Donation Type</label>
                                            <select class="form-select" id="bloodDonationType">
                                                <option value="Whole Blood">Whole Blood</option>
                                                <option value="Plasma">Plasma</option>
                                                <option value="Platelets">Platelets</option>
                                                <option value="Power Red">Power Red</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Donation Center <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="bloodDonationCenter" placeholder="Blood Bank name" required>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">City</label>
                                            <input type="text" class="form-control" id="bloodDonationCity" placeholder="City">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-2 mb-3">
                                            <label class="form-label">Hemoglobin</label>
                                            <input type="number" class="form-control" id="bloodDonationHb" step="0.1" placeholder="g/dL">
                                        </div>
                                        <div class="col-md-2 mb-3">
                                            <label class="form-label">Blood Pressure</label>
                                            <input type="text" class="form-control" id="bloodDonationBP" placeholder="120/80">
                                        </div>
                                        <div class="col-md-2 mb-3">
                                            <label class="form-label">Certificate #</label>
                                            <input type="text" class="form-control" id="bloodDonationCert" placeholder="Optional">
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">Notes</label>
                                            <input type="text" class="form-control" id="bloodDonationNotes" placeholder="Optional notes">
                                        </div>
                                        <div class="col-md-3 mb-3 d-flex align-items-end">
                                            <button type="submit" class="btn btn-success w-100">
                                                <i class="fas fa-save me-2"></i>Save Record
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Request Blood Tab -->
                    <div class="tab-pane fade" id="bloodRequestTab">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-search me-2"></i>Request Blood</h6>
                            </div>
                            <div class="card-body">
                                <form id="bloodRequestForm">
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Blood Group Needed <span class="text-danger">*</span></label>
                                            <select class="form-select" id="bloodRequestGroup" required>
                                                <option value="">Select Blood Group</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Units Needed <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="bloodRequestUnits" value="1" min="1" max="10" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Urgency <span class="text-danger">*</span></label>
                                            <select class="form-select" id="bloodRequestUrgency" required>
                                                <option value="Routine">Routine</option>
                                                <option value="Within 48 hours">Within 48 hours</option>
                                                <option value="Within 24 hours">Within 24 hours</option>
                                                <option value="Immediate">Immediate (Emergency)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Purpose <span class="text-danger">*</span></label>
                                            <select class="form-select" id="bloodRequestPurpose" required>
                                                <option value="">Select Purpose</option>
                                                <option value="Surgery">Surgery</option>
                                                <option value="Accident">Accident / Trauma</option>
                                                <option value="Disease Treatment">Disease Treatment</option>
                                                <option value="Delivery">Pregnancy/Delivery</option>
                                                <option value="Transfusion">Regular Transfusion</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Required By Date</label>
                                            <input type="date" class="form-control" id="bloodRequestDate">
                                        </div>
                                    </div>
                                    <hr>
                                    <h6>Patient Details</h6>
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Patient Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="bloodRequestPatientName" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Patient Age</label>
                                            <input type="number" class="form-control" id="bloodRequestPatientAge">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Relation to You</label>
                                            <select class="form-select" id="bloodRequestRelation">
                                                <option value="Self">Self</option>
                                                <option value="Spouse">Spouse</option>
                                                <option value="Parent">Parent</option>
                                                <option value="Child">Child</option>
                                                <option value="Sibling">Sibling</option>
                                                <option value="Relative">Other Relative</option>
                                                <option value="Friend">Friend</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr>
                                    <h6>Hospital Details</h6>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Hospital Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="bloodRequestHospital" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Hospital City <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="bloodRequestCity" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Attending Doctor</label>
                                            <input type="text" class="form-control" id="bloodRequestDoctor" placeholder="Dr. Name">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Contact Phone <span class="text-danger">*</span></label>
                                            <input type="tel" class="form-control" id="bloodRequestPhone" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Additional Notes</label>
                                        <textarea class="form-control" id="bloodRequestNotes" rows="2"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="fas fa-paper-plane me-2"></i>Submit Blood Request
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- History Tab -->
                    <div class="tab-pane fade" id="bloodHistoryTab">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-heart me-2 text-danger"></i>My Donations</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead>
                                                    <tr><th>Date</th><th>Type</th><th>Center</th><th>Units</th></tr>
                                                </thead>
                                                <tbody id="bloodDonationsTable">
                                                    <tr><td colspan="4" class="text-center text-muted py-4">No donations recorded yet</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-search me-2 text-primary"></i>My Requests</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead>
                                                    <tr><th>Date</th><th>Blood Group</th><th>Units</th><th>Status</th></tr>
                                                </thead>
                                                <tbody id="bloodRequestsTable">
                                                    <tr><td colspan="4" class="text-center text-muted py-4">No requests submitted yet</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Organ Requests / Donate Page -->
            <div class="content-page" id="Organ-requests-page">
                <div class="page-header">
                    <h2><i class="fas fa-lungs"></i> Organ Donation & Requests</h2>
                </div>
                
                <!-- Donor Profile Stats -->
                <div class="stats-grid mb-4">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); color: #fff;">
                            <i class="fas fa-hand-holding-heart"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Consent Status</p>
                            <h3 class="stat-value" id="organStatConsent">{{ user.organ_consent_status or 'Not Registered' }}</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: #fff;">
                            <i class="fas fa-lungs"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Organs Pledged</p>
                            <h3 class="stat-value" id="organStatPledged">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #2196F3, #1565C0); color: #fff;">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Donor ID</p>
                            <h3 class="stat-value" id="organStatDonorId">{{ user.donor_uid or '-' }}</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #FF9800, #E65100); color: #fff;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Registration Date</p>
                            <h3 class="stat-value" id="organStatRegDate">-</h3>
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-4" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#organPledgeTab">
                            <i class="fas fa-heart me-2"></i>Register as Donor
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#organRequestTab">
                            <i class="fas fa-search me-2"></i>Request Organ
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#organHistoryTab">
                            <i class="fas fa-history me-2"></i>My Pledges & Requests
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <!-- Organ Pledge Tab -->
                    <div class="tab-pane fade show active" id="organPledgeTab">
                        <div class="row">
                            <div class="col-lg-7">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0"><i class="fas fa-hand-holding-heart me-2"></i>Organ Donation Pledge</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="alert alert-info mb-4">
                                            <i class="fas fa-info-circle me-2"></i>
                                            <strong>Be a Hero!</strong> One organ donor can save up to 8 lives.
                                        </div>
                                        <form id="organPledgeForm">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Pledge Date</label>
                                                    <input type="date" class="form-control" id="organPledgeDate">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Pledge Type <span class="text-danger">*</span></label>
                                                    <select class="form-select" id="organPledgeType" required>
                                                        <option value="Deceased Donor">After Death (Deceased Donor)</option>
                                                        <option value="Living Donor">Living Donor (Kidney/Liver)</option>
                                                        <option value="Both">Both</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Select Organs to Pledge <span class="text-danger">*</span></label>
                                                <div class="row">
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Heart" id="pledgeHeart"><label class="form-check-label" for="pledgeHeart">Heart</label></div>
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Kidneys" id="pledgeKidneys"><label class="form-check-label" for="pledgeKidneys">Kidneys</label></div>
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Liver" id="pledgeLiver"><label class="form-check-label" for="pledgeLiver">Liver</label></div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Lungs" id="pledgeLungs"><label class="form-check-label" for="pledgeLungs">Lungs</label></div>
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Pancreas" id="pledgePancreas"><label class="form-check-label" for="pledgePancreas">Pancreas</label></div>
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Intestines" id="pledgeIntestines"><label class="form-check-label" for="pledgeIntestines">Intestines</label></div>
                                                    </div>
                                                    <div class="col-6 col-md-4">
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Corneas" id="pledgeCorneas"><label class="form-check-label" for="pledgeCorneas">Corneas (Eyes)</label></div>
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Skin" id="pledgeSkin"><label class="form-check-label" for="pledgeSkin">Skin</label></div>
                                                        <div class="form-check"><input class="form-check-input organ-checkbox" type="checkbox" value="Bone Marrow" id="pledgeBoneMarrow"><label class="form-check-label" for="pledgeBoneMarrow">Bone Marrow</label></div>
                                                    </div>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-success mt-2" onclick="document.querySelectorAll('.organ-checkbox').forEach(c=>c.checked=true)">Select All Organs</button>
                                            </div>
                                            <hr>
                                            <h6>Witness Details (Optional but Recommended)</h6>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Witness Name</label>
                                                    <input type="text" class="form-control" id="organWitnessName" placeholder="Full name">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Witness Phone</label>
                                                    <input type="tel" class="form-control" id="organWitnessPhone" placeholder="Phone number">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Relation</label>
                                                    <select class="form-select" id="organWitnessRelation">
                                                        <option value="">Select...</option>
                                                        <option value="Spouse">Spouse</option>
                                                        <option value="Parent">Parent</option>
                                                        <option value="Child">Child</option>
                                                        <option value="Sibling">Sibling</option>
                                                        <option value="Friend">Friend</option>
                                                        <option value="Other">Other</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Registration Authority</label>
                                                    <select class="form-select" id="organRegAuthority">
                                                        <option value="">Select...</option>
                                                        <option value="NOTTO">NOTTO (National)</option>
                                                        <option value="State Organ Authority">State Organ Authority</option>
                                                        <option value="Hospital">Hospital</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <hr>
                                            <h6>Family Contact (Emergency)</h6>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Family Contact Name</label>
                                                    <input type="text" class="form-control" id="organFamilyName">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Family Contact Phone</label>
                                                    <input type="tel" class="form-control" id="organFamilyPhone">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Notes</label>
                                                <textarea class="form-control" id="organPledgeNotes" rows="2" placeholder="Any special instructions..."></textarea>
                                            </div>
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="organPledgeConsent" required>
                                                <label class="form-check-label" for="organPledgeConsent">
                                                    I hereby pledge to donate my organs upon my death and consent to this registration.
                                                </label>
                                            </div>
                                            <button type="submit" class="btn btn-success w-100">
                                                <i class="fas fa-check me-2"></i>Register as Organ Donor
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>About Organ Donation</h6>
                                    </div>
                                    <div class="card-body">
                                        <h6 class="text-success">Facts & Benefits</h6>
                                        <ul class="small">
                                            <li>One organ donor can save up to 8 lives</li>
                                            <li>One tissue donor can help up to 75 people</li>
                                            <li>Over 500,000 people in India await organ transplants</li>
                                            <li>There is no age limit for organ donation</li>
                                            <li>Most religions support organ donation</li>
                                        </ul>
                                        <hr>
                                        <h6 class="text-success">Organs That Can Be Donated</h6>
                                        <div class="small">
                                            <span class="badge bg-success me-1 mb-1">Heart</span>
                                            <span class="badge bg-success me-1 mb-1">Kidneys (2)</span>
                                            <span class="badge bg-success me-1 mb-1">Liver</span>
                                            <span class="badge bg-success me-1 mb-1">Lungs (2)</span>
                                            <span class="badge bg-success me-1 mb-1">Pancreas</span>
                                            <span class="badge bg-success me-1 mb-1">Intestines</span>
                                            <span class="badge bg-info me-1 mb-1">Corneas</span>
                                            <span class="badge bg-info me-1 mb-1">Skin</span>
                                            <span class="badge bg-info me-1 mb-1">Bone</span>
                                            <span class="badge bg-info me-1 mb-1">Heart Valves</span>
                                        </div>
                                        <hr>
                                        <p class="small text-muted mb-0">
                                            <i class="fas fa-phone me-1"></i> NOTTO Helpline: <strong>1800-103-7100</strong>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Request Organ Tab -->
                    <div class="tab-pane fade" id="organRequestTab">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0"><i class="fas fa-search me-2"></i>Request Organ / Join Waitlist</h6>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-warning mb-4">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Important:</strong> This form registers your need for an organ transplant. For actual allocation, please contact NOTTO or your hospital's transplant coordinator.
                                </div>
                                <form id="organRequestForm">
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Organ Needed <span class="text-danger">*</span></label>
                                            <select class="form-select" id="organRequestOrgan" required>
                                                <option value="">Select Organ</option>
                                                <option value="Kidney">Kidney</option>
                                                <option value="Liver">Liver</option>
                                                <option value="Heart">Heart</option>
                                                <option value="Lung">Lung</option>
                                                <option value="Pancreas">Pancreas</option>
                                                <option value="Cornea">Cornea</option>
                                                <option value="Bone Marrow">Bone Marrow</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Urgency <span class="text-danger">*</span></label>
                                            <select class="form-select" id="organRequestUrgency" required>
                                                <option value="Low">Low</option>
                                                <option value="Medium" selected>Medium</option>
                                                <option value="High">High</option>
                                                <option value="Critical">Critical</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Blood Group <span class="text-danger">*</span></label>
                                            <select class="form-select" id="organRequestBlood" required>
                                                <option value="">Select...</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Diagnosis <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="organRequestDiagnosis" placeholder="e.g., Chronic Kidney Disease Stage 5" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">HLA Type (if known)</label>
                                            <input type="text" class="form-control" id="organRequestHLA" placeholder="e.g., A2, B7, DR15">
                                        </div>
                                    </div>
                                    <hr>
                                    <h6>Hospital & Doctor Details</h6>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Treating Hospital <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="organRequestHospital" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Hospital City <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="organRequestCity" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Treating Doctor</label>
                                            <input type="text" class="form-control" id="organRequestDoctor" placeholder="Dr. Name">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Doctor Contact</label>
                                            <input type="tel" class="form-control" id="organRequestDoctorPhone">
                                        </div>
                                    </div>
                                    <hr>
                                    <h6>Emergency Contact</h6>
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label class="form-label">Contact Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="organRequestEmergencyName" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Contact Phone <span class="text-danger">*</span></label>
                                            <input type="tel" class="form-control" id="organRequestEmergencyPhone" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Relation</label>
                                            <select class="form-select" id="organRequestEmergencyRelation">
                                                <option value="Spouse">Spouse</option>
                                                <option value="Parent">Parent</option>
                                                <option value="Child">Child</option>
                                                <option value="Sibling">Sibling</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="organRequestInsurance">
                                                <label class="form-check-label">Has Insurance Coverage</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="organRequestFinancialAid">
                                                <label class="form-check-label">Needs Financial Assistance</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Additional Notes</label>
                                        <textarea class="form-control" id="organRequestNotes" rows="2"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-warning w-100">
                                        <i class="fas fa-paper-plane me-2"></i>Submit Organ Request
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- History Tab -->
                    <div class="tab-pane fade" id="organHistoryTab">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-heart me-2 text-success"></i>My Organ Pledges</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead>
                                                    <tr><th>Pledge ID</th><th>Date</th><th>Organs</th><th>Status</th></tr>
                                                </thead>
                                                <tbody id="organPledgesTable">
                                                    <tr><td colspan="4" class="text-center text-muted py-4">No pledges registered yet</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="fas fa-search me-2 text-warning"></i>My Organ Requests</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead>
                                                    <tr><th>Request ID</th><th>Organ</th><th>Urgency</th><th>Status</th></tr>
                                                </thead>
                                                <tbody id="organRequestsTable">
                                                    <tr><td colspan="4" class="text-center text-muted py-4">No requests submitted yet</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insurance & Claims Page -->
            <div class="content-page" id="insurance-page">
                <div class="page-header">
                    <h2><i class="fas fa-shield-alt"></i> Insurance & Financial</h2>
                </div>
                
                <!-- Summary Stats -->
                <div class="stats-grid mb-4">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #2196F3, #1565C0); color: #fff;">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Active Policies</p>
                            <h3 class="stat-value" id="insuranceStatPolicies">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: #fff;">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Coverage</p>
                            <h3 class="stat-value" id="insuranceStatCoverage">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #FF9800, #E65100); color: #fff;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Pending Claims</p>
                            <h3 class="stat-value" id="insuranceStatClaims">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9C27B0, #6A1B9A); color: #fff;">
                            <i class="fas fa-hand-holding-heart"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Govt Schemes</p>
                            <h3 class="stat-value" id="insuranceStatSchemes">0</h3>
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-4" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#insurancePoliciesTab">
                            <i class="fas fa-file-contract me-2"></i>My Policies
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#insuranceClaimsTab">
                            <i class="fas fa-file-invoice me-2"></i>Claims History
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#insuranceGovtTab">
                            <i class="fas fa-landmark me-2"></i>Govt Schemes
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#insuranceExpensesTab">
                            <i class="fas fa-wallet me-2"></i>Expenses
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#insuranceBillsTab">
                            <i class="fas fa-receipt me-2"></i>Bills
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <!-- My Policies Tab -->
                    <div class="tab-pane fade show active" id="insurancePoliciesTab">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="fas fa-file-contract me-2"></i>Insurance Policies</h6>
                                        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#addPolicyForm">
                                            <i class="fas fa-plus me-1"></i>Add Policy
                                        </button>
                                    </div>
                                    <div class="collapse" id="addPolicyForm">
                                        <div class="card-body bg-light">
                                            <form id="insurancePolicyForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Insurance Provider <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" id="insPolicyProvider" required placeholder="e.g., Star Health, ICICI Lombard">
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Provider Type</label>
                                                        <select class="form-select" id="insPolicyProviderType">
                                                            <option value="Private">Private</option>
                                                            <option value="Public">Public (LIC, etc.)</option>
                                                            <option value="Government">Government</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Policy Type</label>
                                                        <select class="form-select" id="insPolicyType">
                                                            <option value="Health">Health Insurance</option>
                                                            <option value="Life">Life Insurance</option>
                                                            <option value="Accident">Accident Insurance</option>
                                                            <option value="Critical Illness">Critical Illness</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Policy Number <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" id="insPolicyNumber" required>
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Policy Name</label>
                                                        <input type="text" class="form-control" id="insPolicyName" placeholder="e.g., Family Floater Gold">
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Sum Insured ()</label>
                                                        <input type="number" class="form-control" id="insPolicySumInsured" placeholder="e.g., 500000">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Start Date <span class="text-danger">*</span></label>
                                                        <input type="date" class="form-control" id="insPolicyStartDate" required>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">End Date <span class="text-danger">*</span></label>
                                                        <input type="date" class="form-control" id="insPolicyEndDate" required>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Premium ()</label>
                                                        <input type="number" class="form-control" id="insPolicyPremium" placeholder="Annual premium">
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Coverage Type</label>
                                                        <select class="form-select" id="insPolicyCoverageType">
                                                            <option value="Individual">Individual</option>
                                                            <option value="Family Floater">Family Floater</option>
                                                            <option value="Group">Group/Corporate</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary w-100">
                                                    <i class="fas fa-save me-2"></i>Save Policy
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead class="table-light">
                                                    <tr><th>Provider</th><th>Policy #</th><th>Coverage</th><th>Valid Till</th><th>Status</th></tr>
                                                </thead>
                                                <tbody id="insurancePoliciesTable">
                                                    <tr><td colspan="5" class="text-center text-muted py-4">No insurance policies added yet</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Insurance Tips</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-unstyled small mb-0">
                                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Keep policy documents handy</li>
                                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Note premium due dates</li>
                                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Review coverage annually</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Know network hospitals</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Claims History Tab -->
                    <div class="tab-pane fade" id="insuranceClaimsTab">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-file-invoice me-2"></i>Claims History</h6>
                                <button class="btn btn-dark btn-sm" data-bs-toggle="collapse" data-bs-target="#addClaimForm">
                                    <i class="fas fa-plus me-1"></i>Submit Claim
                                </button>
                            </div>
                            <div class="collapse" id="addClaimForm">
                                <div class="card-body bg-light">
                                    <form id="insuranceClaimForm">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Select Policy <span class="text-danger">*</span></label>
                                                <select class="form-select" id="insClaimPolicy" required></select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Claim Type</label>
                                                <select class="form-select" id="insClaimType">
                                                    <option value="Cashless">Cashless</option>
                                                    <option value="Reimbursement">Reimbursement</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Treatment Type</label>
                                                <select class="form-select" id="insClaimTreatment">
                                                    <option value="Hospitalization">Hospitalization</option>
                                                    <option value="OPD">OPD</option>
                                                    <option value="Daycare">Daycare</option>
                                                    <option value="Maternity">Maternity</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Hospital Name</label>
                                                <input type="text" class="form-control" id="insClaimHospital">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Diagnosis</label>
                                                <input type="text" class="form-control" id="insClaimDiagnosis">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Total Bill Amount () <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="insClaimBillAmount" required>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Claim Amount () <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="insClaimAmount" required>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Claim Date</label>
                                                <input type="date" class="form-control" id="insClaimDate">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-warning w-100">
                                            <i class="fas fa-paper-plane me-2"></i>Submit Claim
                                        </button>
                                    </form>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr><th>Claim ID</th><th>Date</th><th>Hospital</th><th>Amount</th><th>Status</th></tr>
                                        </thead>
                                        <tbody id="insuranceClaimsTable">
                                            <tr><td colspan="5" class="text-center text-muted py-4">No claims submitted yet</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Govt Schemes Tab -->
                    <div class="tab-pane fade" id="insuranceGovtTab">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-landmark me-2"></i>Government Health Schemes</h6>
                                <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#addGovtSchemeForm">
                                    <i class="fas fa-plus me-1"></i>Link Scheme
                                </button>
                            </div>
                            <div class="collapse" id="addGovtSchemeForm">
                                <div class="card-body bg-light">
                                    <form id="govtSchemeForm">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Scheme Name <span class="text-danger">*</span></label>
                                                <select class="form-select" id="govtSchemeName" required>
                                                    <option value="">Select Scheme</option>
                                                    <option value="Ayushman Bharat PM-JAY">Ayushman Bharat PM-JAY (5 Lakh)</option>
                                                    <option value="Ayushman Bharat ABHA">Ayushman Bharat ABHA</option>
                                                    <option value="MJPJAY (Maharashtra)">MJPJAY (Maharashtra)</option>
                                                    <option value="Aarogyasri (Telangana)">Aarogyasri (Telangana)</option>
                                                    <option value="Chiranjeevi (Rajasthan)">Chiranjeevi (Rajasthan)</option>
                                                    <option value="Swasthya Sathi (West Bengal)">Swasthya Sathi (West Bengal)</option>
                                                    <option value="Other">Other State Scheme</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Enrollment/Card Number <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="govtSchemeEnrollId" required placeholder="e.g., ABHA ID">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Coverage Amount ()</label>
                                                <input type="number" class="form-control" id="govtSchemeCoverage" placeholder="e.g., 500000">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Valid From</label>
                                                <input type="date" class="form-control" id="govtSchemeValidFrom">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Valid Until</label>
                                                <input type="date" class="form-control" id="govtSchemeValidUntil">
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label">Scheme Type</label>
                                                <select class="form-select" id="govtSchemeType">
                                                    <option value="Central">Central Government</option>
                                                    <option value="State">State Government</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success w-100">
                                            <i class="fas fa-link me-2"></i>Link Scheme
                                        </button>
                                    </form>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr><th>Scheme</th><th>Enrollment ID</th><th>Coverage</th><th>Valid Till</th><th>Status</th></tr>
                                        </thead>
                                        <tbody id="govtSchemesTable">
                                            <tr><td colspan="5" class="text-center text-muted py-4">No government schemes linked yet</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expenses Tab -->
                    <div class="tab-pane fade" id="insuranceExpensesTab">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="fas fa-wallet me-2"></i>Medical Expenses (Out-of-Pocket)</h6>
                                        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#addExpenseForm">
                                            <i class="fas fa-plus me-1"></i>Add Expense
                                        </button>
                                    </div>
                                    <div class="collapse" id="addExpenseForm">
                                        <div class="card-body bg-light">
                                            <form id="medicalExpenseForm">
                                                <div class="row">
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Date <span class="text-danger">*</span></label>
                                                        <input type="date" class="form-control" id="expenseDate" required>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Category <span class="text-danger">*</span></label>
                                                        <select class="form-select" id="expenseCategory" required>
                                                            <option value="Consultation">Consultation</option>
                                                            <option value="Medicine">Medicine</option>
                                                            <option value="Lab Tests">Lab Tests</option>
                                                            <option value="Imaging">Imaging (X-Ray, MRI)</option>
                                                            <option value="Surgery">Surgery</option>
                                                            <option value="Hospitalization">Hospitalization</option>
                                                            <option value="Other">Other</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Amount () <span class="text-danger">*</span></label>
                                                        <input type="number" class="form-control" id="expenseAmount" required>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Payment Mode</label>
                                                        <select class="form-select" id="expensePaymentMode">
                                                            <option value="Cash">Cash</option>
                                                            <option value="Card">Card</option>
                                                            <option value="UPI">UPI</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Hospital/Clinic/Pharmacy Name</label>
                                                        <input type="text" class="form-control" id="expenseProvider">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Description</label>
                                                        <input type="text" class="form-control" id="expenseDescription" placeholder="Brief description">
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-danger w-100">
                                                    <i class="fas fa-save me-2"></i>Save Expense
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead class="table-light">
                                                    <tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th></tr>
                                                </thead>
                                                <tbody id="medicalExpensesTable">
                                                    <tr><td colspan="4" class="text-center text-muted py-4">No expenses recorded yet</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-dark text-white">
                                        <h6 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Expense Summary</h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <h2 class="text-danger mb-0" id="expenseTotalAmount">0</h2>
                                        <p class="text-muted">Total Out-of-Pocket</p>
                                        <hr>
                                        <p class="mb-1"><strong id="expenseCount">0</strong> Expenses Recorded</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bills Tab -->
                    <div class="tab-pane fade" id="insuranceBillsTab">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0"><i class="fas fa-receipt me-2"></i>Medical Bills</h6>
                                        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#addBillForm">
                                            <i class="fas fa-plus me-1"></i>Add Bill
                                        </button>
                                    </div>
                                    <div class="collapse" id="addBillForm">
                                        <div class="card-body bg-light">
                                            <form id="medicalBillForm">
                                                <div class="row">
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Bill Number <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" id="billNumber" required>
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Bill Date <span class="text-danger">*</span></label>
                                                        <input type="date" class="form-control" id="billDate" required>
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label class="form-label">Due Date</label>
                                                        <input type="date" class="form-control" id="billDueDate">
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label class="form-label">Facility Name <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" id="billFacility" required>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Service Type</label>
                                                        <select class="form-select" id="billServiceType">
                                                            <option value="Consultation">Consultation</option>
                                                            <option value="Hospitalization">Hospitalization</option>
                                                            <option value="Lab">Lab Tests</option>
                                                            <option value="Surgery">Surgery</option>
                                                            <option value="Other">Other</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label class="form-label">Total Amount () <span class="text-danger">*</span></label>
                                                        <input type="number" class="form-control" id="billTotalAmount" required>
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-secondary w-100">
                                                    <i class="fas fa-save me-2"></i>Save Bill
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead class="table-light">
                                                    <tr><th>Bill #</th><th>Date</th><th>Facility</th><th>Amount</th><th>Status</th></tr>
                                                </thead>
                                                <tbody id="medicalBillsTable">
                                                    <tr><td colspan="5" class="text-center text-muted py-4">No bills added yet</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-danger text-white">
                                        <h6 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Bills Summary</h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <h2 class="text-danger mb-0" id="billsPendingAmount">0</h2>
                                        <p class="text-muted">Pending Payments</p>
                                        <hr>
                                        <p class="mb-1"><strong id="billsCount">0</strong> Bills</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat with Doctor Page -->
            <div class="content-page" id="chat-page">
                <div class="page-header">
                    <h2><i class="fas fa-comments"></i> Chat with Doctor</h2>
                </div>
                <div class="card" style="padding:20px;">
                    <p class="text-muted">This section is under development.</p>
                </div>
            </div>

            <!-- Profile Settings Page -->
            <div class="content-page" id="settings-page">
                <div class="page-header">
                    <h2><i class="fas fa-cog"></i> Profile Settings</h2>
                </div>
                <div class="card" style="padding:20px;">
                    <p class="text-muted">This section is under development.</p>
                </div>
            </div>

            <!-- Vaccination History Page -->
            <div class="content-page" id="vaccination-page">
                <div class="page-header">
                    <h2><i class="fas fa-syringe"></i> Vaccination History</h2>
                    <button class="btn-primary" id="addVaccinationBtn">
                        <i class="fas fa-plus"></i> Add Vaccination
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="stats-grid vaccination-stats-row">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg,#E63946 0%,#d32f2f 100%); color:#fff;">
                            <i class="fas fa-syringe"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Vaccines Taken</p>
                            <h3 class="stat-value" id="vaccinationStatTotal">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:#4CAF50; color:#fff;">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Upcoming Vaccines</p>
                            <h3 class="stat-value" id="vaccinationStatUpcoming">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:#FF9800; color:#fff;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Overdue Vaccines</p>
                            <h3 class="stat-value" id="vaccinationStatOverdue">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:#fff; border:1px solid #eee; color:#d32f2f;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last Updated</p>
                            <h3 class="stat-value" id="vaccinationStatUpdated">N/A</h3>
                        </div>
                    </div>
                </div>

                <!-- Filters and Search -->
                <div class="allergy-dashboard-inline">
                    <div class="allergy-header-row">
                        <div class="allergy-search">
                            <label for="vaccinationSearchInput" class="form-label">Search</label>
                            <input type="search" id="vaccinationSearchInput" class="form-control" placeholder="Search by vaccine name...">
                        </div>
                        <div class="allergy-filters">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select id="vaccinationStatusFilter" class="form-control">
                                    <option value="all">All</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Scheduled">Scheduled</option>
                                    <option value="Missed">Missed</option>
                                    <option value="Upcoming">Upcoming</option>
                                    <option value="Overdue">Overdue</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select id="vaccinationCategoryFilter" class="form-control">
                                    <option value="">All</option>
                                    <option value="COVID">COVID</option>
                                    <option value="Childhood">Childhood</option>
                                    <option value="Adult">Adult</option>
                                    <option value="Travel">Travel</option>
                                    <option value="Flu">Flu</option>
                                    <option value="Booster">Booster</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year</label>
                                <select id="vaccinationYearFilter" class="form-control">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <button class="btn-secondary" id="vaccinationResetFilters">Reset</button>
                        </div>
                    </div>

                    <!-- Content Grid -->
                    <p id="vaccinationSummary" class="muted" style="margin: 10px 0;">Showing vaccination records...</p>
                    <div class="row" id="vaccinationCardContainer">
                        <!-- Vaccination cards will be inserted here by JavaScript -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="vaccinationEmptyState" class="card empty-state" style="display: none;">
                        <i class="fas fa-syringe"></i>
                        <h3>No vaccination records yet</h3>
                        <p>Add your vaccination history to keep a complete record of your immunizations.</p>
                        <button class="btn-primary" id="vaccinationEmptyAddBtn">
                            <i class="fas fa-plus"></i> Add Vaccination
                        </button>
                    </div>
                </div>
            </div>

            <!-- Allergy Page -->
            <div class="content-page" id="allergy-page">
                <div class="page-header">
                    <h2><i class="fas fa-allergies"></i> Allergy Profile</h2>
                    <button class="btn-primary js-add-allergy" id="addAllergyBtn">
                        <i class="fas fa-plus"></i> Add Allergy
                    </button>
                </div>

                <div class="allergy-dashboard-inline">
                    <div class="allergy-header-row">
                        <div class="allergy-search">
                            <label for="allergySearchInput" class="form-label">Search</label>
                            <input type="search" id="allergySearchInput" class="form-control" placeholder="Search by allergen...">
                        </div>
                        <div class="allergy-filters">
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select id="allergyStatusFilter" class="form-control">
                                    <option value="all">All</option>
                                    <option value="active">Active</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                            <button class="btn-secondary" id="allergyResetFilters">Reset</button>
                        </div>
                    </div>

                    <!-- Content Grid -->
                    <p id="allergySummary" class="muted" style="margin: 10px 0;">Showing allergy records...</p>
                    <div class="row" id="allergyCardContainer">
                        <!-- Allergy cards will be inserted here by JavaScript -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="allergyEmptyState" class="card empty-state" style="display: none;">
                        <i class="fas fa-allergies"></i>
                        <h3>No allergy information yet</h3>
                        <p>Add your first allergy to keep critical alerts handy for doctors and emergency responders.</p>
                        <button class="btn-primary js-add-allergy">
                            <i class="fas fa-plus"></i> Add New Allergy
                        </button>
                    </div>
                </div>
            </div>

            <!-- Surgery History Page -->
            <div class="content-page" id="surgery-page">
                <div class="page-header">
                    <h2><i class="fas fa-procedures"></i> Surgery History</h2>
                    <button class="btn-primary" id="addSurgeryBtn">
                        <i class="fas fa-plus"></i> Add Surgery
                    </button>
                </div>

                <!-- Summary stats for surgeries -->
                <div class="stats-grid surgery-stats-row">
                    <div class="stat-card">
                        <div class="stat-icon surgery">
                            <i class="fas fa-procedures"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Surgeries</p>
                            <h3 class="stat-value" id="surgeryStatTotal">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Minor Surgeries</p>
                            <h3 class="stat-value" id="surgeryStatMinor">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:linear-gradient(135deg,#ff9800,#f57c00);color:#fff;">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Major Surgeries</p>
                            <h3 class="stat-value" id="surgeryStatMajor">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:linear-gradient(135deg,#e53935,#b71c1c);color:#fff;">
                            <i class="fas fa-ambulance"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Emergency Surgeries</p>
                            <h3 class="stat-value" id="surgeryStatEmergency">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:#fff;border:1px solid #eee;color:#d32f2f;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Last Updated</p>
                            <h3 class="stat-value" id="surgeryStatUpdated">N/A</h3>
                        </div>
                    </div>
                </div>

                <div class="allergy-dashboard-inline">
                    <div class="allergy-header-row">
                        <div class="allergy-search">
                            <label for="surgerySearchInput" class="form-label">Search</label>
                            <input type="search" id="surgerySearchInput" class="form-control" placeholder="Search by surgery, doctor, or hospital...">
                        </div>
                        <div class="allergy-filters">
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <select id="surgeryTypeFilter" class="form-control">
                                    <option value="">All</option>
                                    <option value="Minor">Minor</option>
                                    <option value="Major">Major</option>
                                    <option value="Emergency">Emergency</option>
                                    <option value="Elective">Elective</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select id="surgeryCategoryFilter" class="form-control">
                                    <option value="">All</option>
                                    <option value="General Surgery">General Surgery</option>
                                    <option value="Orthopedic">Orthopedic</option>
                                    <option value="Cardiac">Cardiac</option>
                                    <option value="Neurosurgery">Neurosurgery</option>
                                    <option value="ENT">ENT</option>
                                    <option value="Ophthalmology">Ophthalmology</option>
                                    <option value="Gastrointestinal">Gastrointestinal</option>
                                    <option value="Urology">Urology</option>
                                    <option value="Plastic Surgery">Plastic Surgery</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year</label>
                                <select id="surgeryYearFilter" class="form-control">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <button class="btn-secondary" id="surgeryResetFilters">Reset</button>
                        </div>
                    </div>

                    <!-- Content Grid -->
                    <p id="surgerySummary" class="muted" style="margin: 10px 0;">Showing surgery records...</p>
                    <div class="row" id="surgeryCardsContainer">
                        <!-- Surgery cards will be inserted here by JavaScript -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="surgeryEmptyState" class="card empty-state" style="display: none;">
                        <i class="fas fa-procedures"></i>
                        <h3>No surgery history yet</h3>
                        <p>Add your past surgeries so your care team can see your complete clinical picture.</p>
                        <button class="btn-primary" id="surgeryEmptyAddBtn">
                            <i class="fas fa-plus"></i> Add Surgery
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bio Medical Implants Page -->
            <div class="content-page" id="implantation-page">
                <div class="page-header">
                    <h2><i class="fas fa-heart"></i> Bio Medical Implants</h2>
                    <button class="btn-primary" id="addImplantBtn">
                        <i class="fas fa-plus"></i> Add Implant
                    </button>
                </div>

                <!-- Summary stats for implants -->
                <div class="stats-grid implant-stats-row">
                    <div class="stat-card">
                        <div class="stat-icon" style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Implants</p>
                            <h3 class="stat-value" id="implantStatTotal">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:linear-gradient(135deg,#10b981,#059669);color:#fff;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Active Devices</p>
                            <h3 class="stat-value" id="implantStatActive">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;">
                            <i class="fas fa-history"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Explanted</p>
                            <h3 class="stat-value" id="implantStatExplanted">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:linear-gradient(135deg,#ef4444,#b91c1c);color:#fff;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Recall Alerts</p>
                            <h3 class="stat-value" id="implantStatRecall">0</h3>
                        </div>
                    </div>
                </div>

                <div class="allergy-dashboard-inline">
                    <div class="allergy-header-row">
                        <div class="allergy-search">
                            <label for="implantSearchInput" class="form-label">Search</label>
                            <input type="search" id="implantSearchInput" class="form-control" placeholder="Search by device or manufacturer...">
                        </div>
                        <div class="allergy-filters">
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select id="implantCategoryFilter" class="form-control">
                                    <option value="">All</option>
                                    <option value="Pacemaker">Pacemaker</option>
                                    <option value="Stent">Stent</option>
                                    <option value="Prosthetic Joint">Prosthetic Joint</option>
                                    <option value="Dental Implant">Dental Implant</option>
                                    <option value="Cochlear Implant">Cochlear Implant</option>
                                    <option value="Intraocular Lens">Intraocular Lens</option>
                                    <option value="Heart Valve">Heart Valve</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select id="implantStatusFilter" class="form-control">
                                    <option value="">All</option>
                                    <option value="Active">Active</option>
                                    <option value="Explanted">Explanted</option>
                                    <option value="Recall">Recall</option>
                                    <option value="Failed">Failed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year</label>
                                <select id="implantYearFilter" class="form-control">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <button class="btn-secondary" id="implantResetFilters">Reset</button>
                        </div>
                    </div>

                    <!-- Content Grid -->
                    <p id="implantSummary" class="muted" style="margin: 10px 0;">Showing implant records...</p>
                    <div class="row" id="implantCardsContainer">
                        <!-- Implant cards will be inserted here by JavaScript -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="implantEmptyState" class="card empty-state" style="display: none;">
                        <i class="fas fa-microchip"></i>
                        <h3>No implant history yet</h3>
                        <p>Track your medical devices to ensure safety and easy reference.</p>
                        <button class="btn-primary" id="implantEmptyAddBtn">
                            <i class="fas fa-plus"></i> Add Implant
                        </button>
                    </div>
                </div>
            </div>

            <!-- IoT Monitoring Page -->
            <div class="content-page" id="iot-monitoring-page">
                <div class="page-header">
                    <h2><i class="fas fa-heartbeat"></i> IoT Health Monitoring</h2>
                    <button class="btn-primary">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
                <div class="monitoring-grid">
                    <p class="text-muted">No IoT device connected yet.</p>
                </div>
            </div>

            <!-- AI Predictors Page -->
            <div class="content-page" id="ai-predictors-page">
                <div class="page-header">
                    <h2><i class="fas fa-brain"></i> AI Health Predictors</h2>
                </div>
                <div class="predictor-grid">
                    <div class="predictor-card">
                        <div class="predictor-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h4>Heart Disease Risk</h4>
                        <p>Analyze your risk based on health data</p>
                        <form class="predictor-form">
                            <input type="number" placeholder="Age" class="form-control">
                            <input type="number" placeholder="Cholesterol" class="form-control">
                            <input type="number" placeholder="Blood Pressure" class="form-control">
                            <button type="button" class="btn-primary">Predict Risk</button>
                        </form>
                        <div class="prediction-result" style="display: none;">
                            <div class="risk-meter">
                                <div class="risk-level low"></div>
                            </div>
                            <p class="risk-text">Low Risk: 15%</p>
                        </div>
                    </div>

                    <div class="predictor-card">
                        <div class="predictor-icon">
                            <i class="fas fa-candy-cane"></i>
                        </div>
                        <h4>Diabetes Risk</h4>
                        <p>Predict diabetes likelihood</p>
                        <form class="predictor-form">
                            <input type="number" placeholder="Blood Sugar" class="form-control">
                            <input type="number" placeholder="BMI" class="form-control">
                            <input type="number" placeholder="Age" class="form-control">
                            <button type="button" class="btn-primary">Predict Risk</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Mental Health Page -->
            <div class="content-page" id="mental-health-page">
                <div class="page-header">
                    <h2><i class="fas fa-spa me-2"></i>Mental Health & Wellness</h2>
                </div>

                <!-- Stats Cards -->
                <div class="mh-stats-grid">
                    <div class="mh-stat-card">
                        <div class="mh-stat-icon mood">
                            <i class="fas fa-smile"></i>
                        </div>
                        <div class="mh-stat-content">
                            <p class="mh-stat-label">Current Mood</p>
                            <h3 class="mh-stat-value" id="mh-stat-mood-score">--</h3>
                            <span class="mh-stat-subtitle">7-day average</span>
                        </div>
                    </div>
                    <div class="mh-stat-card">
                        <div class="mh-stat-icon streak">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="mh-stat-content">
                            <p class="mh-stat-label">Tracking Streak</p>
                            <h3 class="mh-stat-value" id="mh-stat-streak">0 days</h3>
                            <span class="mh-stat-subtitle">Keep it going!</span>
                        </div>
                    </div>
                    <div class="mh-stat-card">
                        <div class="mh-stat-icon assessment">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="mh-stat-content">
                            <p class="mh-stat-label">Assessments</p>
                            <h3 class="mh-stat-value" id="mh-stat-assessments">0</h3>
                            <span class="mh-stat-subtitle">This month</span>
                        </div>
                    </div>
                    <div class="mh-stat-card">
                        <div class="mh-stat-icon mindfulness">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <div class="mh-stat-content">
                            <p class="mh-stat-label">Mindfulness</p>
                            <h3 class="mh-stat-value" id="mh-stat-mindfulness">0 min</h3>
                            <span class="mh-stat-subtitle">This week</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Mood Check-in -->
                <div class="mh-quick-mood">
                    <h4><i class="fas fa-heart me-2"></i>How are you feeling right now?</h4>
                    <div class="mh-mood-emojis">
                        <div class="text-center">
                            <button class="mh-mood-emoji" data-mood="great"><span></span></button>
                            <div class="mh-mood-label">Great</div>
                        </div>
                        <div class="text-center">
                            <button class="mh-mood-emoji" data-mood="good"><span></span></button>
                            <div class="mh-mood-label">Good</div>
                        </div>
                        <div class="text-center">
                            <button class="mh-mood-emoji" data-mood="okay"><span></span></button>
                            <div class="mh-mood-label">Okay</div>
                        </div>
                        <div class="text-center">
                            <button class="mh-mood-emoji" data-mood="bad"><span></span></button>
                            <div class="mh-mood-label">Bad</div>
                        </div>
                        <div class="text-center">
                            <button class="mh-mood-emoji" data-mood="awful"><span></span></button>
                            <div class="mh-mood-label">Awful</div>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="mh-tabs">
                    <button class="mh-tab active" data-tab="overview">
                        <i class="fas fa-th-large"></i> Overview
                    </button>
                    <button class="mh-tab" data-tab="mood">
                        <i class="fas fa-smile"></i> Mood
                    </button>
                    <button class="mh-tab" data-tab="assessments">
                        <i class="fas fa-clipboard-check"></i> Assessments
                    </button>
                    <button class="mh-tab" data-tab="sleep">
                        <i class="fas fa-bed"></i> Sleep
                    </button>
                    <button class="mh-tab" data-tab="journal">
                        <i class="fas fa-book"></i> Journal
                    </button>
                    <button class="mh-tab" data-tab="mindfulness">
                        <i class="fas fa-leaf"></i> Mindfulness
                    </button>
                    <button class="mh-tab" data-tab="insights">
                        <i class="fas fa-chart-line"></i> Insights
                    </button>
                </div>

                <!-- Tab Content: Overview -->
                <div class="mh-tab-content active" id="mh-overview-content">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mh-section-card">
                                <div class="mh-section-header">
                                    <h3><i class="fas fa-chart-line"></i> Mood Trend</h3>
                                </div>
                                <div class="mh-chart-container">
                                    <canvas id="mhMoodTrendChart"></canvas>
                                </div>
                                <div class="mh-empty-state" id="mhMoodChartEmpty" style="display: none;">
                                    <i class="fas fa-chart-line"></i>
                                    <h4>No mood data yet</h4>
                                    <p>Start tracking your mood to see trends</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mh-section-card">
                                <div class="mh-section-header">
                                    <h3><i class="fas fa-lightbulb"></i> Quick Actions</h3>
                                </div>
                                <div class="d-grid gap-2">
                                    <button class="mh-btn-primary" onclick="switchMentalHealthTab('assessments')">
                                        <i class="fas fa-clipboard-check"></i> Take Assessment
                                    </button>
                                    <button class="mh-btn-secondary" onclick="switchMentalHealthTab('journal')">
                                        <i class="fas fa-pen"></i> Write in Journal
                                    </button>
                                    <button class="mh-btn-secondary" onclick="switchMentalHealthTab('mindfulness')">
                                        <i class="fas fa-wind"></i> Breathing Exercise
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Mood -->
                <div class="mh-tab-content" id="mh-mood-content">
                    <div class="mh-section-card">
                        <div class="mh-section-header">
                            <h3><i class="fas fa-history"></i> Mood History</h3>
                            <button class="mh-btn-primary" onclick="openMoodLogModal()">
                                <i class="fas fa-plus"></i> Log Mood
                            </button>
                        </div>
                        <div id="mh-mood-history">
                            <!-- Mood entries will be loaded here -->
                            <div class="mh-loading">
                                <div class="mh-loading-spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Assessments -->
                <div class="mh-tab-content" id="mh-assessments-content">
                    <div class="mh-section-card">
                        <div class="mh-section-header">
                            <h3><i class="fas fa-clipboard-check"></i> Mental Health Assessments</h3>
                        </div>
                        <div class="mh-empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h4>Assessments Coming Soon</h4>
                            <p>PHQ-9, GAD-7, and other standardized assessments will be available in Phase 3</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Sleep -->
                <div class="mh-tab-content" id="mh-sleep-content">
                    <div class="mh-section-card">
                        <div class="mh-section-header">
                            <h3><i class="fas fa-bed"></i> Sleep Tracking</h3>
                        </div>
                        <div class="mh-empty-state">
                            <i class="fas fa-moon"></i>
                            <h4>Sleep Tracking Coming Soon</h4>
                            <p>Track your sleep quality and see correlations with mood in Phase 4</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Journal -->
                <div class="mh-tab-content" id="mh-journal-content">
                    <div class="mh-section-card">
                        <div class="mh-section-header">
                            <h3><i class="fas fa-book"></i> Journaling</h3>
                        </div>
                        <div class="mh-empty-state">
                            <i class="fas fa-pen-fancy"></i>
                            <h4>Journaling Coming Soon</h4>
                            <p>Free writing, gratitude logs, and CBT thought records will be available in Phase 5</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Mindfulness -->
                <div class="mh-tab-content" id="mh-mindfulness-content">
                    <div class="mh-section-card">
                        <div class="mh-section-header">
                            <h3><i class="fas fa-leaf"></i> Mindfulness Tools</h3>
                        </div>
                        <div class="mh-empty-state">
                            <i class="fas fa-wind"></i>
                            <h4>Mindfulness Coming Soon</h4>
                            <p>Breathing exercises, meditation timer, and grounding techniques in Phase 6</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Insights -->
                <div class="mh-tab-content" id="mh-insights-content">
                    <div class="mh-section-card">
                        <div class="mh-section-header">
                            <h3><i class="fas fa-chart-line"></i> AI Insights</h3>
                        </div>
                        <div class="mh-empty-state">
                            <i class="fas fa-robot"></i>
                            <h4>Insights Coming Soon</h4>
                            <p>Pattern detection and personalized recommendations in Phase 7</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diet Plan Page -->
            <div class="content-page" id="diet-plan-page">
                <div class="page-header">
                    <h2><i class="fas fa-utensils me-2"></i>Diet & Nutrition</h2>
                </div>

                <!-- Diet Container -->
                <div class="diet-container" style="padding: 0;">
                    <!-- Tab Navigation -->
                    <div class="diet-tabs">
                        <button class="diet-tab active" data-tab="dashboard">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </button>
                        <button class="diet-tab" data-tab="plan">
                            <i class="fas fa-magic"></i>
                            <span>My Plan</span>
                        </button>
                        <button class="diet-tab" data-tab="meals">
                            <i class="fas fa-utensils"></i>
                            <span>Meals</span>
                        </button>
                        <button class="diet-tab" data-tab="foods">
                            <i class="fas fa-apple-alt"></i>
                            <span>Foods</span>
                        </button>
                        <button class="diet-tab" data-tab="water">
                            <i class="fas fa-tint"></i>
                            <span>Water</span>
                        </button>
                        <button class="diet-tab" data-tab="progress">
                            <i class="fas fa-chart-line"></i>
                            <span>Progress</span>
                        </button>
                        <button class="diet-tab" data-tab="reports">
                            <i class="fas fa-file-alt"></i>
                            <span>Reports</span>
                        </button>
                    </div>

                    <!-- Tab Contents -->
                    <div class="diet-tab-content active" id="diet-dashboard-content">
                        <div class="diet-loading"><div class="diet-loading-spinner"></div></div>
                    </div>
                    
                    <div class="diet-tab-content" id="diet-plan-content">
                        <!-- Plan content loaded dynamically -->
                    </div>
                    
                    <div class="diet-tab-content" id="diet-meals-content">
                        <!-- Meals content loaded dynamically -->
                    </div>
                    
                    <div class="diet-tab-content" id="diet-foods-content">
                        <!-- Foods content loaded dynamically -->
                    </div>
                    
                    <div class="diet-tab-content" id="diet-water-content">
                        <!-- Water content loaded dynamically -->
                    </div>
                    
                    <div class="diet-tab-content" id="diet-progress-content">
                        <!-- Progress content loaded dynamically -->
                    </div>
                    
                    <div class="diet-tab-content" id="diet-reports-content">
                        <!-- Reports content loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Physical Activity Page -->
            <div class="content-page" id="physical-activity-page">
                <div class="page-header">
                    <h2><i class="fas fa-running me-2"></i>Physical Activity</h2>
                </div>

                <!-- Physical Activity Container -->
                <div class="pa-container" style="padding: 0;">
                    <!-- Tab Navigation -->
                    <div class="pa-tabs">
                        <button class="pa-tab active" data-tab="dashboard">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </button>
                        <button class="pa-tab" data-tab="workouts">
                            <i class="fas fa-dumbbell"></i>
                            <span>Workouts</span>
                        </button>
                        <button class="pa-tab" data-tab="exercises">
                            <i class="fas fa-running"></i>
                            <span>Exercises</span>
                        </button>
                        <button class="pa-tab" data-tab="goals">
                            <i class="fas fa-bullseye"></i>
                            <span>Goals</span>
                        </button>
                        <button class="pa-tab" data-tab="schedule">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Schedule</span>
                        </button>
                        <button class="pa-tab" data-tab="achievements">
                            <i class="fas fa-trophy"></i>
                            <span>Achievements</span>
                        </button>
                    </div>

                    <!-- Tab Contents -->
                    <div class="pa-tab-content active" id="pa-dashboard-content">
                        <!-- Dashboard Stats -->
                        <div class="pa-stats-grid">
                            <div class="pa-stat-card">
                                <div class="pa-stat-icon" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div class="pa-stat-content">
                                    <div class="pa-stat-value" id="pa-today-calories">0</div>
                                    <div class="pa-stat-label">Calories Today</div>
                                </div>
                            </div>
                            <div class="pa-stat-card">
                                <div class="pa-stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="pa-stat-content">
                                    <div class="pa-stat-value" id="pa-today-minutes">0</div>
                                    <div class="pa-stat-label">Minutes Active</div>
                                </div>
                            </div>
                            <div class="pa-stat-card">
                                <div class="pa-stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                    <i class="fas fa-fire-alt"></i>
                                </div>
                                <div class="pa-stat-content">
                                    <div class="pa-stat-value" id="pa-current-streak">0</div>
                                    <div class="pa-stat-label">Day Streak </div>
                                </div>
                            </div>
                            <div class="pa-stat-card">
                                <div class="pa-stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="pa-stat-content">
                                    <div class="pa-stat-value" id="pa-total-workouts">0</div>
                                    <div class="pa-stat-label">Total Workouts</div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="pa-section-card">
                            <div class="pa-section-header">
                                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                            </div>
                            <div class="pa-quick-actions">
                                <button class="pa-action-btn pa-action-primary" id="pa-log-workout-btn">
                                    <i class="fas fa-plus-circle"></i>
                                    <span>Log Workout</span>
                                </button>
                                <button class="pa-action-btn" id="pa-browse-exercises-btn">
                                    <i class="fas fa-search"></i>
                                    <span>Browse Exercises</span>
                                </button>
                                <button class="pa-action-btn" id="pa-set-goal-btn">
                                    <i class="fas fa-bullseye"></i>
                                    <span>Set Goal</span>
                                </button>
                            </div>
                        </div>

                        <!-- Today's Schedule -->
                        <div class="pa-section-card">
                            <div class="pa-section-header">
                                <h3><i class="fas fa-calendar-day"></i> Today's Schedule</h3>
                            </div>
                            <div id="pa-today-schedule">
                                <div class="pa-empty-state-small">
                                    <i class="fas fa-calendar-check"></i>
                                    <p>No workouts scheduled for today</p>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Workouts -->
                        <div class="pa-section-card">
                            <div class="pa-section-header">
                                <h3><i class="fas fa-history"></i> Recent Workouts</h3>
                                <button class="pa-btn-link" id="pa-view-all-workouts">View All </button>
                            </div>
                            <div id="pa-recent-workouts">
                                <div class="pa-empty-state-small">
                                    <i class="fas fa-dumbbell"></i>
                                    <p>No workouts logged yet</p>
                                </div>
                            </div>
                        </div>

                        <!-- Weekly Progress -->
                        <div class="pa-section-card">
                            <div class="pa-section-header">
                                <h3><i class="fas fa-chart-bar"></i> Weekly Progress</h3>
                            </div>
                            <div class="pa-weekly-progress">
                                <div class="pa-progress-stat">
                                    <div class="pa-progress-label">Sessions</div>
                                    <div class="pa-progress-value" id="pa-week-sessions">0 / 5</div>
                                    <div class="pa-progress-bar">
                                        <div class="pa-progress-fill" id="pa-week-sessions-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="pa-progress-stat">
                                    <div class="pa-progress-label">Active Minutes</div>
                                    <div class="pa-progress-value" id="pa-week-minutes">0 / 150</div>
                                    <div class="pa-progress-bar">
                                        <div class="pa-progress-fill" id="pa-week-minutes-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="pa-progress-stat">
                                    <div class="pa-progress-label">Calories Burned</div>
                                    <div class="pa-progress-value" id="pa-week-calories">0</div>
                                    <div class="pa-progress-bar">
                                        <div class="pa-progress-fill" id="pa-week-calories-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pa-tab-content" id="pa-workouts-content">
                        <!-- Workouts content loaded dynamically -->
                        <div class="pa-loading"><div class="pa-loading-spinner"></div></div>
                    </div>
                    
                    <div class="pa-tab-content" id="pa-exercises-content">
                        <!-- Exercises content loaded dynamically -->
                        <div class="pa-loading"><div class="pa-loading-spinner"></div></div>
                    </div>
                    
                    <div class="pa-tab-content" id="pa-goals-content">
                        <!-- Goals content loaded dynamically -->
                        <div class="pa-loading"><div class="pa-loading-spinner"></div></div>
                    </div>
                    
                    <div class="pa-tab-content" id="pa-schedule-content">
                        <!-- Schedule content loaded dynamically -->
                        <div class="pa-loading"><div class="pa-loading-spinner"></div></div>
                    </div>
                    
                    <div class="pa-tab-content" id="pa-achievements-content">
                        <!-- Achievements content loaded dynamically -->
                        <div class="pa-loading"><div class="pa-loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar - User Profile Card -->
        <aside class="right-sidebar">
            <div class="sidebar-welcome-card">
                <div class="sidebar-profile-section">
                    <img src="https://ui-avatars.com/api/?name={{ user.full_name or 'User' }}&background=fff&color=d32f2f&size=80" alt="Profile" class="sidebar-profile-img">
                    <div class="sidebar-profile-info">
                        <h3 class="sidebar-user-name">{{ user.full_name or 'User' }}</h3>
                        <p class="sidebar-welcome-text">Welcome Back!</p>
                    </div>
                </div>
                <div class="sidebar-uid-badge">
                    <i class="fas fa-id-card"></i>
                    <span>UID: {{ user.uid }}</span>
                </div>
                <div class="sidebar-details">
                    <div class="sidebar-detail-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span id="sidebarDate"></span>
                    </div>
                    <div class="sidebar-detail-item">
                        <i class="fas fa-clock"></i>
                        <span id="sidebarTime"></span>
                    </div>
                    <div class="sidebar-detail-item">
                        <i class="fas fa-tint"></i>
                        <span>Blood: {{ (user.blood_group or '') ~ (user.blood_rh or '') or 'N/A' }}</span>
                    </div>
                </div>
                <div class="sidebar-quick-actions">
                    <a href="#" class="quick-action-btn" data-page="health-card">
                        <i class="fas fa-id-card"></i>
                        <span>View Card</span>
                    </a>
                    <a href="#" class="quick-action-btn" data-page="general-details">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                </div>
                <!-- Chat with Doctor Button (Full Width) -->
                <a href="#" class="chat-doctor-btn" data-page="chat">
                    <i class="fas fa-comments"></i>
                    <span>Chat with Doctor</span>
                </a>
            </div>
        </aside>
    </div>

    <!-- Upload Document Modal -->
    <div class="modal fade" id="uploadDocumentModal" tabindex="-1" aria-labelledby="uploadDocumentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadDocumentModalLabel">
                        <i class="fas fa-cloud-upload-alt"></i> Upload Medical Document
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadDocumentForm" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="documentTitle" class="form-label">Document Title <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="documentTitle" name="title" required placeholder="e.g., Blood Test Results">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="documentType" class="form-label">Document Type <span class="text-danger">*</span></label>
                                <select class="form-control" id="documentType" name="type" required>
                                    <option value="">Select Type</option>
                                    <optgroup label="Lab Tests">
                                        <option value="Blood Test">Blood Test</option>
                                        <option value="Urine Test">Urine Test</option>
                                        <option value="Stool Test">Stool Test</option>
                                        <option value="Biopsy">Biopsy</option>
                                        <option value="Culture Test">Culture Test</option>
                                    </optgroup>
                                    <optgroup label="Imaging Reports">
                                        <option value="X-Ray">X-Ray</option>
                                        <option value="MRI">MRI</option>
                                        <option value="CT Scan">CT Scan</option>
                                        <option value="Ultrasound">Ultrasound</option>
                                        <option value="PET Scan">PET Scan</option>
                                        <option value="Mammography">Mammography</option>
                                    </optgroup>
                                    <optgroup label="Medical Documents">
                                        <option value="Prescription">Prescription</option>
                                        <option value="Discharge Summary">Discharge Summary</option>
                                        <option value="Medical Certificate">Medical Certificate</option>
                                        <option value="Consultation Report">Consultation Report</option>
                                        <option value="Surgery Report">Surgery Report</option>
                                    </optgroup>
                                    <optgroup label="Other">
                                        <option value="Vaccination Record">Vaccination Record</option>
                                        <option value="Allergy Report">Allergy Report</option>
                                        <option value="Insurance Document">Insurance Document</option>
                                        <option value="Other">Other</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="documentDate" class="form-label">Document Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="documentDate" name="date" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="doctorName" class="form-label">Doctor Name</label>
                                <input type="text" class="form-control" id="doctorName" name="doctor" placeholder="e.g., Dr. John Smith">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="hospitalName" class="form-label">Hospital/Clinic Name</label>
                                <input type="text" class="form-control" id="hospitalName" name="hospital" placeholder="e.g., City General Hospital">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="documentNotes" class="form-label">Notes</label>
                                <textarea class="form-control" id="documentNotes" name="notes" rows="3" placeholder="Add any additional notes or observations"></textarea>
                            </div>
                        </div>
                        <!-- Single File Upload (Default) -->
                        <div class="row" id="singleFileUploadSection">
                            <div class="col-md-12 mb-3">
                                <label for="documentFile" class="form-label">Upload File <span class="text-danger">*</span></label>
                                <div class="file-upload-area" id="fileUploadArea">
                                    <input type="file" class="form-control" id="documentFile" name="file" accept=".pdf,.jpg,.jpeg,.png,.dcm,.dicom" required style="display: none;">
                                    <div class="file-upload-content" id="fileUploadContent">
                                        <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: #d32f2f;"></i>
                                        <p style="margin-top: 15px; font-weight: 500;">Click to browse or drag and drop</p>
                                        <p style="font-size: 14px; color: #666;">Allowed: PDF, JPG, PNG, DICOM | Max size: 500 KB</p>
                                    </div>
                                    <div class="file-selected-info" id="fileSelectedInfo" style="display: none;">
                                        <i class="fas fa-file-alt" style="font-size: 36px; color: #4caf50;"></i>
                                        <p id="fileName" style="margin-top: 10px; font-weight: 500;"></p>
                                        <p id="fileSize" style="font-size: 14px; color: #666;"></p>
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="removeFileBtn">
                                            <i class="fas fa-times"></i> Remove
                                        </button>
                                    </div>
                                </div>
                                <div id="fileError" class="text-danger mt-2" style="display: none;"></div>
                            </div>
                        </div>
                        
                        <!-- Dual File Upload for Imaging Reports -->
                        <div class="row" id="imagingFilesUploadSection" style="display: none;">
                            <div class="col-md-12 mb-2">
                                <div class="alert alert-info" style="font-size: 13px; padding: 10px;">
                                    <i class="fas fa-info-circle"></i> For imaging reports, please upload both the film/image and the report document.
                                </div>
                            </div>
                            
                            <!-- Film/Image Upload -->
                            <div class="col-md-6 mb-3">
                                <label for="imagingFilmFile" class="form-label">Upload Film/Image <span class="text-danger">*</span></label>
                                <div class="file-upload-area-small" id="filmUploadArea">
                                    <input type="file" class="form-control" id="imagingFilmFile" name="filmFile" accept=".jpg,.jpeg,.png,.dcm,.dicom" style="display: none;">
                                    <div class="file-upload-content-small" id="filmUploadContent">
                                        <i class="fas fa-image" style="font-size: 32px; color: #2196F3;"></i>
                                        <p style="margin-top: 10px; font-weight: 500; font-size: 13px;">Upload Film/Image</p>
                                        <p style="font-size: 12px; color: #666;">JPG, PNG, DICOM</p>
                                    </div>
                                    <div class="file-selected-info-small" id="filmSelectedInfo" style="display: none;">
                                        <i class="fas fa-image" style="font-size: 24px; color: #4caf50;"></i>
                                        <p id="filmFileName" style="margin-top: 8px; font-size: 12px; font-weight: 500;"></p>
                                        <p id="filmFileSize" style="font-size: 11px; color: #666;"></p>
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="removeFilmBtn" style="font-size: 11px; padding: 4px 8px;">
                                            <i class="fas fa-times"></i> Remove
                                        </button>
                                    </div>
                                </div>
                                <div id="filmFileError" class="text-danger mt-2" style="display: none; font-size: 12px;"></div>
                            </div>
                            
                            <!-- Report Upload -->
                            <div class="col-md-6 mb-3">
                                <label for="imagingReportFile" class="form-label">Upload Report <span class="text-danger">*</span></label>
                                <div class="file-upload-area-small" id="reportUploadArea">
                                    <input type="file" class="form-control" id="imagingReportFile" name="reportFile" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                                    <div class="file-upload-content-small" id="reportUploadContent">
                                        <i class="fas fa-file-pdf" style="font-size: 32px; color: #EF5350;"></i>
                                        <p style="margin-top: 10px; font-weight: 500; font-size: 13px;">Upload Report</p>
                                        <p style="font-size: 12px; color: #666;">PDF, JPG, PNG</p>
                                    </div>
                                    <div class="file-selected-info-small" id="reportSelectedInfo" style="display: none;">
                                        <i class="fas fa-file-pdf" style="font-size: 24px; color: #4caf50;"></i>
                                        <p id="reportFileName" style="margin-top: 8px; font-size: 12px; font-weight: 500;"></p>
                                        <p id="reportFileSize" style="font-size: 11px; color: #666;"></p>
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="removeReportBtn" style="font-size: 11px; padding: 4px 8px;">
                                            <i class="fas fa-times"></i> Remove
                                        </button>
                                    </div>
                                </div>
                                <div id="reportFileError" class="text-danger mt-2" style="display: none; font-size: 12px;"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="submitUploadBtn">
                        <i class="fas fa-check"></i> Upload Document
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vitals Entry Modal - Single Form -->
    <div class="modal fade" id="vitalsEntryModal" tabindex="-1" aria-labelledby="vitalsEntryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); color: white;">
                    <h5 class="modal-title" id="vitalsEntryModalLabel">
                        <i class="fas fa-heartbeat me-2"></i> Record Vitals
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="vitalsEntryForm">
                        <input type="hidden" id="vitalType" name="vital_type" value="general">
                        
                        <!-- Blood Pressure & Heart Rate Section -->
                        <div class="vital-section mb-4">
                            <h6 class="text-danger mb-3"><i class="fas fa-heart me-2"></i>Blood Pressure & Heart Rate</h6>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="bpSystolic" class="form-label">Systolic BP (mmHg)</label>
                                    <input type="number" class="form-control" id="bpSystolic" name="blood_pressure_systolic" placeholder="120" min="60" max="250">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="bpDiastolic" class="form-label">Diastolic BP (mmHg)</label>
                                    <input type="number" class="form-control" id="bpDiastolic" name="blood_pressure_diastolic" placeholder="80" min="40" max="150">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="heartRate" class="form-label">Heart Rate (bpm)</label>
                                    <input type="number" class="form-control" id="heartRate" name="heart_rate" placeholder="72" min="30" max="220">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Diabetes Section - Blood Sugar -->
                        <div class="vital-section mb-4">
                            <h6 class="text-purple mb-3" style="color: #6c5ce7;"><i class="fas fa-tint me-2"></i>Blood Sugar Levels (Diabetes)</h6>
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="sugarFasting" class="form-label">Fasting (mg/dL)</label>
                                    <input type="number" class="form-control" id="sugarFasting" name="blood_sugar_fasting" placeholder="100" min="20" max="600" step="0.1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="sugarPP" class="form-label">Post-Meal (mg/dL)</label>
                                    <input type="number" class="form-control" id="sugarPP" name="blood_sugar_pp" placeholder="140" min="20" max="600" step="0.1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="sugarRandom" class="form-label">Random (mg/dL)</label>
                                    <input type="number" class="form-control" id="sugarRandom" name="blood_sugar_random" placeholder="120" min="20" max="600" step="0.1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="hba1c" class="form-label">HbA1c (%)</label>
                                    <input type="number" class="form-control" id="hba1c" name="hba1c" placeholder="5.7" min="3" max="20" step="0.1">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Weight & BMI Section -->
                        <div class="vital-section mb-4">
                            <h6 class="text-success mb-3"><i class="fas fa-weight me-2"></i>Weight & BMI</h6>
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="weight" class="form-label">Weight (kg)</label>
                                    <input type="number" class="form-control" id="weight" name="weight" placeholder="70" min="20" max="300" step="0.1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="height" class="form-label">Height (cm)</label>
                                    <input type="number" class="form-control" id="height" name="height" placeholder="170" min="50" max="250" step="0.1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="bmiCalc" class="form-label">BMI (auto)</label>
                                    <input type="text" class="form-control" id="bmiCalc" readonly placeholder="Auto-calculated">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="waist" class="form-label">Waist (cm)</label>
                                    <input type="number" class="form-control" id="waist" name="waist_circumference" placeholder="85" min="40" max="200" step="0.1">
                                </div>
                            </div>
                        </div>
                        
                        <!-- General Vitals Section -->
                        <div class="vital-section mb-4">
                            <h6 class="text-info mb-3"><i class="fas fa-stethoscope me-2"></i>General Vitals</h6>
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="spo2" class="form-label">SpO2 (%)</label>
                                    <input type="number" class="form-control" id="spo2" name="spo2" placeholder="98" min="50" max="100" step="0.1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="temperature" class="form-label">Temperature</label>
                                    <input type="number" class="form-control" id="temperature" name="temperature" placeholder="98.6" min="90" max="110" step="0.1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="tempUnit" class="form-label">Unit</label>
                                    <select class="form-select" id="tempUnit" name="temperature_unit">
                                        <option value="F">F</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="respRate" class="form-label">Resp. Rate (/min)</label>
                                    <input type="number" class="form-control" id="respRate" name="respiratory_rate" placeholder="16" min="5" max="60">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notes -->
                        <div class="mb-3">
                            <label for="vitalNotes" class="form-label">Notes (optional)</label>
                            <textarea class="form-control" id="vitalNotes" name="notes" rows="2" placeholder="Any additional observations..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="saveVitalBtn" onclick="saveVitalRecord()">
                        <i class="fas fa-save me-1"></i> Save Vital
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Booking Modal -->
    <div class="appointment-booking-modal" id="appointmentBookingModal" style="display: none;">
        <div class="booking-dialog">
            <div class="booking-header">
                <div>
                    <p class="booking-subtitle">Multi-Step Guided Flow</p>
                    <h3>Book a New Appointment</h3>
                </div>
                <button class="booking-close" id="closeBookingModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="booking-progress" id="bookingProgressBar">
                <div class="booking-progress-step active" data-step="1">
                    <span>1</span>
                    <small>Type</small>
                </div>
                <div class="booking-progress-step" data-step="2">
                    <span>2</span>
                    <small>Specialty</small>
                </div>
                <div class="booking-progress-step" data-step="3">
                    <span>3</span>
                    <small>Doctor</small>
                </div>
                <div class="booking-progress-step" data-step="4">
                    <span>4</span>
                    <small>Date</small>
                </div>
                <div class="booking-progress-step" data-step="5">
                    <span>5</span>
                    <small>Time</small>
                </div>
                <div class="booking-progress-step" data-step="6">
                    <span>6</span>
                    <small>Mode</small>
                </div>
                <div class="booking-progress-step" data-step="7">
                    <span>7</span>
                    <small>Medical Info</small>
                </div>
                <div class="booking-progress-step" data-step="8">
                    <span>8</span>
                    <small>Review</small>
                </div>
                <div class="booking-progress-step" data-step="9">
                    <span>9</span>
                    <small>Success</small>
                </div>
            </div>

            <div class="booking-steps-container">
                <div class="booking-step active" data-step="1">
                    <h4>Step 1: Select Appointment Type</h4>
                    <p class="step-helper">Choose the intent of your visit to see the best recommendations tailored for you.</p>
                    <div class="selection-grid" id="appointmentTypeOptions">
                        <!-- Populated via JS -->
                    </div>
                </div>

                <div class="booking-step" data-step="2">
                    <h4>Step 2: Select Specialty</h4>
                    <p class="step-helper">Pick a specialty to narrow down relevant doctors.</p>
                    <div class="specialty-scroll" id="specialtyOptions">
                        <!-- Specialty buttons inserted via JS -->
                    </div>
                </div>

                <div class="booking-step" data-step="3">
                    <div class="booking-split">
                        <div>
                            <h4>Step 3: Discover Doctors</h4>
                            <p class="step-helper">Search, filter, and compare top-rated doctors within the network.</p>
                        </div>
                        <div class="doctor-search-bar">
                            <input type="text" id="doctorSearchInput" placeholder="Search by name or hospital">
                            <select id="doctorModeFilter">
                                <option value="">All Modes</option>
                                <option value="in-person">In-person</option>
                                <option value="video">Video</option>
                                <option value="home visit">Home Visit</option>
                            </select>
                        </div>
                    </div>
                    <div class="doctor-card-grid" id="doctorResultsContainer">
                        <div class="empty-result">
                            <i class="fas fa-user-md"></i>
                            <p>Select a specialty to load doctors.</p>
                        </div>
                    </div>
                </div>

                <div class="booking-step" data-step="4">
                    <h4>Step 4: Select Date</h4>
                    <p class="step-helper">Pick any date within the next 30 days. Highlighted dots represent existing bookings.</p>
                    <div class="booking-calendar">
                        <div class="booking-calendar-header">
                            <button id="bookingCalendarPrev"><i class="fas fa-chevron-left"></i></button>
                            <div>
                                <strong id="bookingCalendarMonth">November 2024</strong>
                                <span>Tap a day to continue</span>
                            </div>
                            <button id="bookingCalendarNext"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="booking-calendar-grid" id="bookingCalendarDays"></div>
                    </div>
                </div>

                <div class="booking-step" data-step="5">
                    <h4>Step 5: Select Time Slot</h4>
                    <p class="step-helper">Slots are grouped by morning, afternoon, and evening.</p>
                    <div class="slot-groups" id="slotSelectionContainer">
                        <div class="slot-placeholder">
                            <i class="fas fa-clock"></i>
                            <p>Select a date to load available slots.</p>
                        </div>
                    </div>
                </div>

                <div class="booking-step" data-step="6">
                    <h4>Step 6: Select Consultation Mode</h4>
                    <p class="step-helper">Choose how you would like to interact with the doctor.</p>
                    <div class="selection-grid" id="consultationModeOptions">
                        <!-- Buttons inserted via JS -->
                    </div>
                </div>

                <div class="booking-step" data-step="7">
                    <h4>Step 7: Medical Information</h4>
                    <p class="step-helper">Share a brief medical context to help your doctor prepare.</p>
                    <div class="medical-form-grid">
                        <div class="form-group">
                            <label for="chiefComplaintInput">Chief Complaint</label>
                            <input type="text" id="chiefComplaintInput" placeholder="e.g., Persistent chest discomfort">
                        </div>
                        <div class="form-group">
                            <label for="symptomsInput">Symptoms</label>
                            <textarea id="symptomsInput" rows="3" placeholder="List symptoms separated by commas."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="severitySelect">Severity</label>
                            <select id="severitySelect">
                                <option value="">Select</option>
                                <option value="mild">Mild</option>
                                <option value="moderate">Moderate</option>
                                <option value="severe">Severe</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="additionalNotesInput">Additional Notes</label>
                            <textarea id="additionalNotesInput" rows="2" placeholder="Allergies, medications, medical history..."></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>Upload supporting files (optional)</label>
                            <div class="upload-dropzone" id="medicalUploadsDropzone">
                                <input type="file" id="medicalUploadsInput" multiple accept=".pdf,.jpg,.jpeg,.png">
                                <p><i class="fas fa-cloud-upload-alt"></i> Drag & drop or click to upload (Max 3 files)</p>
                            </div>
                            <div class="upload-preview-list" id="selectedUploadsList"></div>
                        </div>
                    </div>
                </div>

                <div class="booking-step" data-step="8">
                    <h4>Step 8: Review & Confirm</h4>
                    <p class="step-helper">Please verify all the details before confirmation.</p>
                    <div class="review-summary-card" id="reviewSummaryCard">
                        <div class="review-summary-grid" id="reviewSummaryList">
                            <!-- Filled dynamically -->
                        </div>
                    </div>
                </div>

                <div class="booking-step" data-step="9">
                    <div class="booking-success" id="bookingSuccessState">
                        <i class="fas fa-circle-check"></i>
                        <h3>Appointment Confirmed!</h3>
                        <p>Your appointment has been scheduled successfully. A QR code is shared for instant check-in.</p>
                        <div class="success-qr-wrapper">
                            <img id="bookingSuccessQr" alt="Appointment QR">
                            <p id="bookingSuccessDetails"></p>
                        </div>
                        <div class="success-calendar-chip" id="bookingSuccessCalChip"></div>
                        <button class="btn-primary" id="bookingFinishBtn">
                            <i class="fas fa-arrow-left"></i> Back to Appointments
                        </button>
                    </div>
                </div>
            </div>

            <div class="booking-navigation">
                <button class="btn-secondary" id="bookingBackBtn" disabled>
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn-primary" id="bookingNextBtn">
                    Continue <i class="fas fa-arrow-right"></i>
                </button>
            </div>

        </div>
    </div>

    <!-- Dynamic Action Modal -->
    <div class="modal fade" id="dynamicActionModal" tabindex="-1" aria-labelledby="dynamicActionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dynamicActionModalLabel">Add New Allergy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="dynamicActionModalBody">
                    <div class="text-center p-5"><div class="spinner-border text-danger" role="status"><span class="visually-hidden">Loading...</span></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Surgery Modal -->
    <div class="modal fade" id="surgeryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Surgery</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="surgeryForm" method="post" enctype="multipart/form-data" action="{{ url_for('surgery_add') }}">
                        <div class="row">
                            <!-- Surgery Information -->
                            <div class="col-md-6 mb-3">
                                <label for="surgery_name" class="form-label">Surgery Name <span class="text-danger">*</span></label>
                                <input type="text" id="surgery_name" name="surgery_name" class="form-control" required placeholder="e.g., Laparoscopic Appendectomy">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="surgery_date" class="form-label">Surgery Date <span class="text-danger">*</span></label>
                                <input type="date" id="surgery_date" name="surgery_date" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="surgery_type" class="form-label">Surgery Type <span class="text-danger">*</span></label>
                                <select id="surgery_type" name="surgery_type" class="form-select" required>
                                    <option value="">Select type</option>
                                    {% for t in surgery_types %}
                                    <option value="{{ t }}">{{ t }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="surgery_category" class="form-label">Surgery Category</label>
                                <select id="surgery_category" name="surgery_category" class="form-select">
                                    <option value="">Select category</option>
                                    {% for c in surgery_categories %}
                                    <option value="{{ c }}">{{ c }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="surgeon_name" class="form-label">Surgeon Name</label>
                                <input type="text" id="surgeon_name" name="surgeon_name" class="form-control" placeholder="e.g., Dr. A. Kumar">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="surgeon_registration_number" class="form-label">Surgeon Registration Number</label>
                                <input type="text" id="surgeon_registration_number" name="surgeon_registration_number" class="form-control" placeholder="e.g., MCI/XXXX/2020">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="hospital_name" class="form-label">Hospital / Clinic Name</label>
                                <input type="text" id="hospital_name" name="hospital_name" class="form-control" placeholder="e.g., A3 City Hospital">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="pre_op_condition" class="form-label">Pre-op Condition</label>
                                <select id="pre_op_condition" name="pre_op_condition" class="form-select">
                                    <option value="">Select condition</option>
                                    {% for c in pre_op_conditions %}
                                    <option value="{{ c }}">{{ c }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="outcome" class="form-label">Surgery Outcome</label>
                                <select id="outcome" name="outcome" class="form-select">
                                    <option value="">Select outcome</option>
                                    {% for o in surgery_outcomes %}
                                    <option value="{{ o }}">{{ o }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="follow_up_date" class="form-label">Follow-up Date</label>
                                <input type="date" id="follow_up_date" name="follow_up_date" class="form-control">
                            </div>
                            <div class="col-12 mb-3">
                                <label for="implants_used" class="form-label">Implants Used</label>
                                <input type="text" id="implants_used" name="implants_used" class="form-control" placeholder="e.g., Left hip prosthesis, 3.5 mm locking plate">
                            </div>

                            <!-- Clinical Details -->
                            <div class="col-12 mb-3">
                                <label for="reason" class="form-label">Reason for surgery</label>
                                <textarea id="reason" name="reason" rows="2" class="form-control"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="symptoms_before" class="form-label">Symptoms before surgery</label>
                                <textarea id="symptoms_before" name="symptoms_before" rows="2" class="form-control" placeholder="Key symptoms, duration, progression..."></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="post_op_notes" class="form-label">Post-op Notes</label>
                                <textarea id="post_op_notes" name="post_op_notes" rows="3" class="form-control" placeholder="Complications, ICU stay, recovery course..."></textarea>
                            </div>

                            <!-- File Uploads -->
                            <div class="col-12 mb-3">
                                <label class="form-label">Upload Documents (max 3 files, 10 MB each)</label>
                                <p class="text-muted small mb-2">Allowed types: PDF, JPG, PNG, DICOM.</p>
                                <div id="surgeryUploadArea" class="upload-dropzone p-4 text-center" style="border: 2px dashed #dee2e6; border-radius: 8px; cursor: pointer; background-color: #f8f9fa;">
                                    <i class="fas fa-cloud-upload-alt fa-2x text-secondary mb-2"></i>
                                    <p class="mb-0 fw-bold">Drag & drop files here</p>
                                    <p class="text-muted small mb-0">or click to browse</p>
                                    <input type="file" id="surgeryDocuments" name="documents" multiple accept=".pdf,.jpg,.jpeg,.png,.dcm,.dicom" style="display:none;">
                                </div>
                                <div id="surgeryFileError" class="text-danger small mt-2" style="display:none;"></div>
                                <div id="surgeryFilePreview" class="mt-2"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="surgeryForm" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Save Surgery
                    </button>
                </div>
            </div>

        </div>
    </div>



    <!-- Family History Modal -->
    <div class="modal fade" id="familyHistoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Family Member History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="familyHistoryForm" action="/family-history/add" method="POST" enctype="multipart/form-data">
                        <input type="hidden" id="fhId" name="id">
                        <input type="hidden" id="fhMode" name="mode" value="add">
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Relation <span class="text-danger">*</span></label>
                                <select name="relation" class="form-select" required>
                                    <option value="">Select...</option>
                                    <option value="Father">Father</option>
                                    <option value="Mother">Mother</option>
                                    <option value="Brother">Brother</option>
                                    <option value="Sister">Sister</option>
                                    <option value="Grandfather">Grandfather</option>
                                    <option value="Grandmother">Grandmother</option>
                                    <option value="Uncle">Uncle</option>
                                    <option value="Aunt">Aunt</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Living Status <span class="text-danger">*</span></label>
                                <select name="living_status" class="form-select" required>
                                    <option value="Alive">Alive</option>
                                    <option value="Deceased">Deceased</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Age / Age at Death</label>
                                <input type="number" name="age" class="form-control" placeholder="Years">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Gender</label>
                                <select name="gender" class="form-select">
                                    <option value="">Select...</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="col-12">
                                <label class="form-label">Medical Conditions</label>
                                <div class="form-text mb-2">Select all that apply</div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="medical_conditions" value="Diabetes">
                                            <label class="form-check-label">Diabetes</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="medical_conditions" value="Hypertension">
                                            <label class="form-check-label">Hypertension</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="medical_conditions" value="Other">
                                            <label class="form-check-label">Other</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="medical_conditions" value="Heart Disease">
                                            <label class="form-check-label">Heart Disease</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="medical_conditions" value="Cancer">
                                            <label class="form-check-label">Cancer</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="medical_conditions" value="Asthma">
                                            <label class="form-check-label">Asthma</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="medical_conditions" value="Genetic Disorder">
                                            <label class="form-check-label">Genetic Disorder</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <label class="form-label">Condition Details & Notes</label>
                                <textarea name="notes" class="form-control" rows="3" placeholder="Specific condition names, treatments, etc."></textarea>
                            </div>

                            <div class="col-12">
                                <label class="form-label">Upload Documents (Max 3, 5MB each)</label>
                                <input type="file" name="documents" class="form-control" multiple accept=".pdf,.jpg,.jpeg,.png">
                                <div id="fhFileError" class="text-danger small mt-1" style="display:none;"></div>
                                <div id="fhFilePreview" class="mt-2"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="fhSaveBtn" class="btn btn-primary">Save Record</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='client_dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='vaccination.js') }}"></script>
    <script src="{{ url_for('static', filename='allergy.js') }}"></script>
    <script src="{{ url_for('static', filename='surgery.js') }}"></script>
    <script src="{{ url_for('static', filename='family_history.js') }}"></script>
    <script src="{{ url_for('static', filename='implants.js') }}"></script>

    <script>
        // Pharmacy Services Logic
        window.loadPharmacies = function() {
            fetch('/api/client/pharmacies')
                .then(res => res.json())
                .then(data => {
                    if(data.success) {
                        const selects = document.querySelectorAll('.pharmacy-select');
                        selects.forEach(select => {
                            select.innerHTML = '<option value="" selected disabled>Select a Pharmacy</option>';
                            data.pharmacies.forEach(p => {
                                select.innerHTML += `<option value="${p.id}">${p.name} (${p.address})</option>`;
                            });
                        });
                    }
                })
                .catch(err => console.error('Error loading pharmacies:', err));
        };

        window.loadRequests = function() {
            fetch('/api/client/pharmacy/requests')
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('requestsList');
                    if(!container) return;
                    container.innerHTML = '';
                    
                    if(data.requests.length === 0) {
                        container.innerHTML = '<div class="text-center text-muted py-3">No requests found</div>';
                        return;
                    }
                    
                    data.requests.forEach(req => {
                        let badgeClass = 'bg-warning text-dark';
                        if(req.status === 'accepted' || req.status === 'ready') badgeClass = 'bg-success';
                        if(req.status === 'rejected') badgeClass = 'bg-secondary';
                        
                        const item = `
                            <div class="border rounded p-3">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <span class="badge ${badgeClass}">${req.status.toUpperCase()}</span>
                                    <small class="text-muted">${req.date}</small>
                                </div>
                                <h6 class="fw-bold mb-1">${req.pharmacy}</h6>
                                <p class="small text-muted mb-2">
                                    ${req.type === 'prescription_upload' ? 'Prescription Upload' : 'Medicine Request'}
                                </p>
                                ${req.remarks ? `<div class="alert alert-light p-2 mb-0 small border"><i class="fas fa-comment-alt me-1 text-muted"></i> ${req.remarks}</div>` : ''}
                            </div>
                        `;
                        container.innerHTML += item;
                    });
                })
                .catch(err => console.error('Error loading requests:', err));
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            // --- Unified Pharmacy Request Logic ---

            const unifiedForm = document.getElementById('unifiedPharmacyRequestForm');
            const medicineListContainer = document.getElementById('medicineListContainer');
            const addMedicineRowBtn = document.getElementById('addMedicineRowBtn');

            if (unifiedForm && medicineListContainer && addMedicineRowBtn) {
                
                // Add Medicine Row
                addMedicineRowBtn.addEventListener('click', function() {
                    const row = document.createElement('div');
                    row.className = 'row g-2 mb-2 medicine-row';
                    row.innerHTML = `
                        <div class="col-7">
                            <input type="text" class="form-control" name="medicineName[]" placeholder="Medicine Name">
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control" name="medicineQty[]" placeholder="Qty">
                        </div>
                        <div class="col-2">
                            <button type="button" class="btn btn-outline-danger w-100 remove-medicine-row">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    medicineListContainer.appendChild(row);
                });

                // Remove Medicine Row (Event Delegation)
                medicineListContainer.addEventListener('click', function(e) {
                    if (e.target.closest('.remove-medicine-row')) {
                        const row = e.target.closest('.medicine-row');
                        // Don't remove the last remaining row if you want to keep at least one, 
                        // but here we allow removing any added row. 
                        // If we want to prevent removing the very first one if it's the only one:
                        if (medicineListContainer.children.length > 1) {
                            row.remove();
                        } else {
                            // Optional: Clear inputs instead of removing
                            row.querySelector('input[name="medicineName[]"]').value = '';
                            row.querySelector('input[name="medicineQty[]"]').value = '';
                        }
                    }
                });

                // Handle Form Submission
                unifiedForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    
                    // Process medicines into a single string or JSON
                    const names = formData.getAll('medicineName[]');
                    const qtys = formData.getAll('medicineQty[]');
                    let medicineDetails = [];
                    
                    for(let i=0; i<names.length; i++) {
                        if(names[i].trim()) {
                            medicineDetails.push(`${names[i].trim()} (Qty: ${qtys[i].trim() || '1'})`);
                        }
                    }
                    
                    // If no file and no medicines, show error
                    const file = formData.get('file');
                    if ((!file || file.size === 0) && medicineDetails.length === 0) {
                        alert('Please either upload a prescription OR add at least one medicine.');
                        return;
                    }

                    // Append processed medicines string
                    formData.append('medicineDetails', medicineDetails.join(', '));

                    // Send Request
                    fetch('/api/client/pharmacy/submit-request', {
                        method: 'POST',
                        body: formData
                    })
                    .then(res => res.json())
                    .then(data => {
                        if(data.success) {
                            alert('Request submitted successfully!');
                            this.reset();
                            // Reset medicine rows to just one empty row
                            const firstRow = medicineListContainer.firstElementChild;
                            medicineListContainer.innerHTML = '';
                            medicineListContainer.appendChild(firstRow);
                            
                            loadRequests();
                        } else {
                            alert('Error: ' + data.message);
                        }
                    })
                    .catch(err => console.error('Error submitting request:', err));
                });
            }
        });
    </script>

    <!-- Module Scripts -->
    <script src="{{ url_for('static', filename='vaccination.js') }}"></script>
    <script src="{{ url_for('static', filename='allergy.js') }}"></script>
    <script src="{{ url_for('static', filename='surgery.js') }}"></script>
    <script src="{{ url_for('static', filename='implants.js') }}"></script>
    <script src="{{ url_for('static', filename='vitals.js') }}"></script>
    <script src="{{ url_for('static', filename='health_assessments.js') }}"></script>
    
    <!-- Medical History & Lifestyle Scripts -->
    <script>
    // Load Medical History & Lifestyle when page is shown
    document.addEventListener('DOMContentLoaded', function() {
        // Navigation handler - load data when page becomes active
        document.querySelectorAll('.nav-item[data-page]').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                if (page === 'medical-history') {
                    loadClientMedicalHistory();
                } else if (page === 'lifestyle') {
                    loadClientLifestyle();
                }
            });
        });
    });

    function loadClientMedicalHistory() {
        const container = document.getElementById('clientMedicalHistoryContent');
        
        fetch('/api/client/my-medical-history')
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    renderClientMedicalHistory(data.medical_history || []);
                } else {
                    container.innerHTML = '<div class="alert alert-warning">Unable to load medical history: ' + (data.error || 'Unknown error') + '</div>';
                }
            })
            .catch(err => {
                container.innerHTML = '<div class="alert alert-danger">Error loading medical history</div>';
                console.error(err);
            });
    }

    function renderClientMedicalHistory(records) {
        const container = document.getElementById('clientMedicalHistoryContent');
        
        if (records.length === 0) {
            container.innerHTML = `
                <div class="card" style="padding: 40px; text-align: center;">
                    <i class="fas fa-clipboard-list fa-4x text-muted mb-3" style="opacity: 0.3;"></i>
                    <h4 class="text-muted">No Medical History Records</h4>
                    <p class="text-muted mb-0">No medical history records have been added yet.</p>
                </div>`;
            return;
        }
        
        // Group by type
        const grouped = {};
        records.forEach(r => {
            const type = formatMhRecordType(r.record_type);
            if (!grouped[type]) grouped[type] = [];
            grouped[type].push(r);
        });
        
        let html = '';
        for (const [type, items] of Object.entries(grouped)) {
            html += `
                <div class="card mb-3">
                    <div class="card-header" style="background: linear-gradient(135deg, #d32f2f, #ab2a37); color: white;">
                        <h5 class="mb-0"><i class="fas fa-folder-open me-2"></i>${type} (${items.length})</h5>
                    </div>
                    <div class="card-body p-0">
                        ${items.map(r => `
                            <div class="p-3 border-bottom ${r.is_active ? '' : 'bg-light'}">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <strong>${r.condition_name}</strong>
                                        ${r.severity ? `<span class="badge bg-${getSeverityBg(r.severity)} ms-2">${r.severity}</span>` : ''}
                                        <span class="badge bg-${r.is_active ? 'warning' : 'success'} ms-2">${r.is_active ? 'Active' : 'Resolved'}</span>
                                    </div>
                                </div>
                                ${r.diagnosis_date ? `<small class="text-muted d-block">Diagnosed: ${r.diagnosis_date}</small>` : ''}
                                ${r.treatment ? `<p class="mt-2 mb-0 small text-muted">${r.treatment}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>`;
        }
        container.innerHTML = html;
    }

    function loadClientLifestyle() {
        const container = document.getElementById('clientLifestyleContent');
        
        fetch('/api/client/my-lifestyle')
            .then(r => r.json())
            .then(data => {
                if (data.success && data.lifestyle) {
                    renderClientLifestyle(data.lifestyle);
                } else {
                    container.innerHTML = `
                        <div class="card" style="padding: 40px; text-align: center;">
                            <i class="fas fa-running fa-4x text-muted mb-3" style="opacity: 0.3;"></i>
                            <h4 class="text-muted">No Lifestyle Assessment</h4>
                            <p class="text-muted mb-0">No lifestyle assessment has been recorded yet.</p>
                        </div>`;
                }
            })
            .catch(err => {
                container.innerHTML = '<div class="alert alert-danger">Error loading lifestyle data</div>';
                console.error(err);
            });
    }

    function renderClientLifestyle(data) {
        const container = document.getElementById('clientLifestyleContent');
        
        container.innerHTML = `
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                            <h6 class="mb-0"><i class="fas fa-smoking me-2"></i>Substance Use</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>Tobacco:</strong> ${data.tobacco_use || 'Not recorded'}</p>
                            <p class="mb-2"><strong>Alcohol:</strong> ${data.alcohol_use || 'Not recorded'}</p>
                            <p class="mb-0"><strong>Substance Abuse:</strong> ${data.substance_abuse ? 'Yes' : 'No'}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header" style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white;">
                            <h6 class="mb-0"><i class="fas fa-running me-2"></i>Physical Activity</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>Activity Level:</strong> ${data.physical_activity_level || 'Not recorded'}</p>
                            <p class="mb-2"><strong>Exercise:</strong> ${data.exercise_frequency || 'Not recorded'}</p>
                            <p class="mb-0"><strong>Type:</strong> ${data.exercise_type || 'Not recorded'}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white;">
                            <h6 class="mb-0"><i class="fas fa-weight me-2"></i>Body Metrics</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>BMI:</strong> ${data.bmi || 'N/A'} <span class="badge bg-secondary">${data.bmi_category || ''}</span></p>
                            <p class="mb-2"><strong>Weight:</strong> ${data.current_weight || 'N/A'} kg</p>
                            <p class="mb-0"><strong>Height:</strong> ${data.current_height || 'N/A'} cm</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white;">
                            <h6 class="mb-0"><i class="fas fa-utensils me-2"></i>Diet</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>Diet Type:</strong> ${data.diet_type || 'Not recorded'}</p>
                            <p class="mb-2"><strong>Quality:</strong> ${data.diet_quality || 'Not recorded'}</p>
                            <p class="mb-0"><strong>Meals/Day:</strong> ${data.meals_per_day || 'N/A'}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header" style="background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333;">
                            <h6 class="mb-0"><i class="fas fa-bed me-2"></i>Sleep & Stress</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>Avg Sleep:</strong> ${data.sleep_hours_avg || 'N/A'} hrs</p>
                            <p class="mb-2"><strong>Sleep Quality:</strong> ${data.sleep_quality || 'Not recorded'}</p>
                            <p class="mb-0"><strong>Stress Level:</strong> ${data.stress_level || 'Not recorded'}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header" style="background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #333;">
                            <h6 class="mb-0"><i class="fas fa-briefcase me-2"></i>Occupation</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>Occupation:</strong> ${data.occupation || 'Not recorded'}</p>
                            <p class="mb-0"><strong>Night Shift:</strong> ${data.night_shift_work ? 'Yes' : 'No'}</p>
                        </div>
                    </div>
                </div>
            </div>
            ${data.notes ? `
                <div class="card mt-3">
                    <div class="card-body">
                        <h6><i class="fas fa-sticky-note me-2"></i>Notes</h6>
                        <p class="mb-0">${data.notes}</p>
                    </div>
                </div>
            ` : ''}
        `;
    }

    function formatMhRecordType(type) {
        const types = {
            'chronic': 'Chronic Illnesses',
            'past_illness': 'Past Illnesses',
            'hospitalization': 'Hospitalizations',
            'ncd': 'Non-Communicable Diseases',
            'communicable': 'Communicable Diseases',
            'genetic': 'Genetic Disorders',
            'mental_health': 'Mental Health'
        };
        return types[type] || type;
    }

    function getSeverityBg(severity) {
        const colors = { 'mild': 'info', 'moderate': 'warning', 'severe': 'danger', 'critical': 'dark' };
        return colors[severity] || 'secondary';
    }

    // =============================================================================
    // PHASE 4: CLIENT VITALS & INVESTIGATIONS
    // =============================================================================

    function loadClientVitals() {
        const container = document.getElementById('clientVitalsContent');
        
        fetch('/api/client/my-vitals')
            .then(r => r.json())
            .then(data => {
                if (data.success && data.vitals && data.vitals.length > 0) {
                    renderClientVitals(data.vitals);
                } else {
                    container.innerHTML = `
                        <div class="card" style="padding: 40px; text-align: center;">
                            <i class="fas fa-heartbeat fa-4x text-muted mb-3" style="opacity: 0.3;"></i>
                            <h4 class="text-muted">No Vitals Recorded</h4>
                            <p class="text-muted mb-0">Your vitals will appear here after your doctor or health worker records them during a visit.</p>
                        </div>`;
                }
            })
            .catch(err => {
                container.innerHTML = '<div class="alert alert-danger">Error loading vitals</div>';
                console.error(err);
            });
    }

    function renderClientVitals(vitals) {
        const container = document.getElementById('clientVitalsContent');
        
        container.innerHTML = `
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Blood Pressure</th>
                                    <th>Heart Rate</th>
                                    <th>SpO2</th>
                                    <th>Temperature</th>
                                    <th>Weight</th>
                                    <th>BMI</th>
                                    <th>Recorded By</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${vitals.map(v => `
                                    <tr>
                                        <td>${v.recorded_at ? new Date(v.recorded_at).toLocaleDateString() : '-'}</td>
                                        <td>${v.systolic_bp && v.diastolic_bp ? `<span class="badge bg-danger-subtle text-danger">${v.systolic_bp}/${v.diastolic_bp}</span>` : '-'}</td>
                                        <td>${v.heart_rate ? v.heart_rate + ' bpm' : '-'}</td>
                                        <td>${v.spo2 ? v.spo2 + '%' : '-'}</td>
                                        <td>${v.temperature ? v.temperature + 'F' : '-'}</td>
                                        <td>${v.weight ? v.weight + ' kg' : '-'}</td>
                                        <td>${v.bmi ? v.bmi : '-'}</td>
                                        <td>${v.doctor || v.health_worker || '-'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
    }

    function loadClientInvestigations() {
        const container = document.getElementById('clientInvestigationsContent');
        
        fetch('/api/client/my-investigations')
            .then(r => r.json())
            .then(data => {
                if (data.success && data.investigations && data.investigations.length > 0) {
                    renderClientInvestigations(data.investigations);
                } else {
                    container.innerHTML = `
                        <div class="card" style="padding: 40px; text-align: center;">
                            <i class="fas fa-flask fa-4x text-muted mb-3" style="opacity: 0.3;"></i>
                            <h4 class="text-muted">No Investigations Yet</h4>
                            <p class="text-muted mb-0">Your lab tests, imaging, and other investigations will appear here when ordered by your doctor.</p>
                        </div>`;
                }
            })
            .catch(err => {
                container.innerHTML = '<div class="alert alert-danger">Error loading investigations</div>';
                console.error(err);
            });
    }

    function renderClientInvestigations(investigations) {
        const container = document.getElementById('clientInvestigationsContent');
        
        container.innerHTML = `
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Test Name</th>
                                    <th>Status</th>
                                    <th>Result</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${investigations.map(inv => {
                                    const statusColors = {'Ordered': 'warning', 'Completed': 'success', 'Processing': 'info', 'Cancelled': 'secondary'};
                                    const statusBadge = statusColors[inv.status] || 'secondary';
                                    return `
                                        <tr>
                                            <td>${inv.ordered_at ? new Date(inv.ordered_at).toLocaleDateString() : '-'}</td>
                                            <td><span class="badge bg-primary-subtle text-primary">${inv.investigation_type || '-'}</span></td>
                                            <td><strong>${inv.test_name}</strong>${inv.category ? '<br><small class="text-muted">' + inv.category + '</small>' : ''}</td>
                                            <td><span class="badge bg-${statusBadge}">${inv.status}</span></td>
                                            <td>${inv.result_value ? inv.result_value + (inv.result_unit ? ' ' + inv.result_unit : '') : (inv.impression ? '<small>' + inv.impression.substring(0, 100) + '...</small>' : '<span class="text-muted">Pending</span>')}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
    }

    // Add page load handlers if not already hooked
    const originalShowPage = window.showPage;
    if (typeof originalShowPage === 'function') {
        window.showPage = function(pageId) {
            originalShowPage(pageId);
            if (pageId === 'my-vitals') loadClientVitals();
            if (pageId === 'my-investigations') loadClientInvestigations();
        };
    }

    // Also add to nav click handlers
    document.querySelectorAll('.nav-item[data-page]').forEach(item => {
        item.addEventListener('click', function() {
            const page = this.getAttribute('data-page');
            if (page === 'my-vitals') setTimeout(loadClientVitals, 100);
            if (page === 'my-investigations') setTimeout(loadClientInvestigations, 100);
            if (page === 'blood-requests') setTimeout(loadBloodDonationData, 100);
            if (page === 'Organ-requests') setTimeout(loadOrganDonationData, 100);
            if (page === 'insurance') setTimeout(loadInsuranceData, 100);
        });
    });
    </script>
    
    <!-- Phase 13: Blood & Organ Donation JavaScript -->
    <script>
    // ==================== BLOOD DONATION FUNCTIONS ====================
    window.loadBloodDonationData = async function() {
        console.log('loadBloodDonationData called');  // Debug log
        try {
            const res = await fetch('/api/client/blood-donations');
            const data = await res.json();
            if (data.success) {
                // Update stats
                if (data.donor_profile) {
                    // Combine blood_group and blood_rh for display (e.g., 'B' + '+' = 'B+')
                    const bloodGroup = data.donor_profile.blood_group || '';
                    const bloodRh = data.donor_profile.blood_rh || '';
                    document.getElementById('bloodStatGroup').textContent = bloodGroup ? bloodGroup + bloodRh : 'Not Set';
                    document.getElementById('bloodStatDonations').textContent = data.donor_profile.donation_count || 0;
                    document.getElementById('bloodStatLastDonation').textContent = data.donor_profile.last_donation ? new Date(data.donor_profile.last_donation).toLocaleDateString() : '-';
                }
                
                // Find next eligible date from donations
                if (data.donations && data.donations.length > 0) {
                    const latestDonation = data.donations[0];
                    document.getElementById('bloodStatNextEligible').textContent = latestDonation.next_eligible_date ? new Date(latestDonation.next_eligible_date).toLocaleDateString() : '-';
                    
                    // Render donations table
                    const tbody = document.getElementById('bloodDonationsTable');
                    tbody.innerHTML = data.donations.map(d => `
                        <tr>
                            <td>${new Date(d.donation_date).toLocaleDateString()}</td>
                            <td>${d.donation_type || '-'}</td>
                            <td>${d.donation_center || '-'}</td>
                            <td>${d.units_donated || 1}</td>
                        </tr>
                    `).join('');
                }
                
                // Load blood requests
                const reqRes = await fetch('/api/client/blood-requests');
                const reqData = await reqRes.json();
                if (reqData.success && reqData.requests.length > 0) {
                    const tbody = document.getElementById('bloodRequestsTable');
                    const statusColors = {Pending: 'warning', Processing: 'info', Fulfilled: 'success', Cancelled: 'secondary', Expired: 'dark'};
                    tbody.innerHTML = reqData.requests.map(r => `
                        <tr>
                            <td>${new Date(r.created_at).toLocaleDateString()}</td>
                            <td><span class="badge bg-danger">${r.blood_group_needed}</span></td>
                            <td>${r.units_needed}</td>
                            <td><span class="badge bg-${statusColors[r.status] || 'secondary'}">${r.status}</span></td>
                        </tr>
                    `).join('');
                }
            }
        } catch (e) { console.error('Blood data error:', e); }
    }
    
    // ==================== BLOOD DONOR REGISTRATION ====================
    // Toggle donor availability
    document.getElementById('bloodDonorAvailable')?.addEventListener('change', function() {
        const preferencesSection = document.getElementById('donorPreferencesSection');
        const notRegisteredMessage = document.getElementById('donorNotRegisteredMessage');
        if (this.checked) {
            preferencesSection.style.display = 'block';
            notRegisteredMessage.style.display = 'none';
        } else {
            preferencesSection.style.display = 'none';
            notRegisteredMessage.style.display = 'block';
        }
    });
    
    // Save donor preferences
    document.getElementById('saveDonorPreferencesBtn')?.addEventListener('click', async function() {
        try {
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
            
            const res = await fetch('/api/client/donor-profile', {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    donor_availability: document.getElementById('donorAvailability').value,
                    preferred_donation_type: document.getElementById('preferredDonationType').value,
                    donor_preferred_city: document.getElementById('donorPreferredCity').value,
                    donor_consent_contact: document.getElementById('donorConsentContact').checked
                })
            });
            const data = await res.json();
            if (data.success) {
                alert('Donor preferences saved successfully!');
            } else {
                alert('Error: ' + data.error);
            }
        } catch (e) {
            alert('Error saving preferences: ' + e.message);
        } finally {
            this.disabled = false;
            this.innerHTML = '<i class="fas fa-save me-2"></i>Save Donor Preferences';
        }
    });
    
    // Load donor profile on page load
    async function loadDonorProfile() {
        try {
            const res = await fetch('/api/client/donor-profile');
            const data = await res.json();
            if (data.success && data.donor_profile) {
                const profile = data.donor_profile;
                const toggle = document.getElementById('bloodDonorAvailable');
                if (profile.donor_availability && profile.donor_availability !== 'Not Available') {
                    toggle.checked = true;
                    document.getElementById('donorPreferencesSection').style.display = 'block';
                    document.getElementById('donorNotRegisteredMessage').style.display = 'none';
                    // Fill preferences
                    document.getElementById('donorAvailability').value = profile.donor_availability || 'Available';
                    document.getElementById('preferredDonationType').value = profile.preferred_donation_type || 'Whole Blood';
                    document.getElementById('donorPreferredCity').value = profile.donor_preferred_city || '';
                    document.getElementById('donorConsentContact').checked = profile.donor_consent_contact !== false;
                }
            }
        } catch (e) { console.error('Error loading donor profile:', e); }
    }
    
    // Call when navigating to blood page
    const originalLoadBlood = window.loadBloodDonationData;
    window.loadBloodDonationData = async function() {
        await originalLoadBlood();
        await loadDonorProfile();
    };
    
    // Blood Donation Form Submit
    document.getElementById('bloodDonationForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/blood-donations', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    donation_date: document.getElementById('bloodDonationDate').value,
                    donation_type: document.getElementById('bloodDonationType').value,
                    donation_center: document.getElementById('bloodDonationCenter').value,
                    donation_center_city: document.getElementById('bloodDonationCity').value || '',
                    hemoglobin_level: document.getElementById('bloodDonationHb').value || null,
                    blood_pressure: document.getElementById('bloodDonationBP').value || '',
                    certificate_number: document.getElementById('bloodDonationCert').value || '',
                    notes: document.getElementById('bloodDonationNotes').value || ''
                })
            });
            const data = await res.json();
            if (data.success) {
                alert('Blood donation recorded! Next eligible date: ' + data.next_eligible_date);
                this.reset();
                loadBloodDonationData();
            } else {
                alert('Error: ' + data.error);
            }
        } catch (e) { alert('Error saving donation: ' + e.message); }
    });
    
    // Blood Request Form Submit
    document.getElementById('bloodRequestForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/blood-requests', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    blood_group_needed: document.getElementById('bloodRequestGroup').value,
                    units_needed: document.getElementById('bloodRequestUnits').value,
                    urgency: document.getElementById('bloodRequestUrgency').value,
                    purpose: document.getElementById('bloodRequestPurpose').value,
                    required_by_date: document.getElementById('bloodRequestDate').value,
                    patient_name: document.getElementById('bloodRequestPatientName').value,
                    patient_age: document.getElementById('bloodRequestPatientAge').value,
                    patient_relation: document.getElementById('bloodRequestRelation').value,
                    hospital_name: document.getElementById('bloodRequestHospital').value,
                    hospital_city: document.getElementById('bloodRequestCity').value,
                    attending_doctor: document.getElementById('bloodRequestDoctor').value,
                    contact_phone: document.getElementById('bloodRequestPhone').value,
                    notes: document.getElementById('bloodRequestNotes').value
                })
            });
            const data = await res.json();
            if (data.success) {
                alert('Blood request submitted! Request ID: ' + data.request_id);
                this.reset();
                loadBloodDonationData();
            } else {
                alert('Error: ' + data.error);
            }
        } catch (e) { alert('Error submitting request: ' + e.message); }
    });
    
    // ==================== ORGAN DONATION FUNCTIONS ====================
    window.loadOrganDonationData = async function() {
        console.log('loadOrganDonationData called');  // Debug log
        try {
            const res = await fetch('/api/client/organ-pledges');
            const data = await res.json();
            if (data.success) {
                // Update stats
                if (data.donor_profile) {
                    document.getElementById('organStatConsent').textContent = data.donor_profile.organ_consent_status || 'Not Registered';
                    document.getElementById('organStatDonorId').textContent = data.donor_profile.donor_uid || '-';
                    const pledgedOrgans = data.donor_profile.organs_pledged || [];
                    document.getElementById('organStatPledged').textContent = Array.isArray(pledgedOrgans) ? pledgedOrgans.length : 0;
                }
                
                // Render pledges table
                if (data.pledges && data.pledges.length > 0) {
                    const tbody = document.getElementById('organPledgesTable');
                    tbody.innerHTML = data.pledges.map(p => {
                        const organs = Array.isArray(p.organs_pledged) ? p.organs_pledged.slice(0, 3).join(', ') + (p.organs_pledged.length > 3 ? '...' : '') : '-';
                        const statusColors = {Active: 'success', Revoked: 'danger', 'Pending Verification': 'warning'};
                        return `
                            <tr>
                                <td><small>${p.pledge_id}</small></td>
                                <td>${new Date(p.pledge_date).toLocaleDateString()}</td>
                                <td><small>${organs}</small></td>
                                <td><span class="badge bg-${statusColors[p.status] || 'secondary'}">${p.status}</span></td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Load organ requests
                const reqRes = await fetch('/api/client/organ-requests');
                const reqData = await reqRes.json();
                if (reqData.success && reqData.requests.length > 0) {
                    const tbody = document.getElementById('organRequestsTable');
                    const urgencyColors = {Low: 'secondary', Medium: 'info', High: 'warning', Critical: 'danger'};
                    const statusColors = {Pending: 'warning', 'On Waitlist': 'info', Matched: 'primary', Transplanted: 'success', Cancelled: 'secondary'};
                    tbody.innerHTML = reqData.requests.map(r => `
                        <tr>
                            <td><small>${r.request_id}</small></td>
                            <td>${r.organ_needed}</td>
                            <td><span class="badge bg-${urgencyColors[r.urgency] || 'secondary'}">${r.urgency}</span></td>
                            <td><span class="badge bg-${statusColors[r.status] || 'secondary'}">${r.status}</span></td>
                        </tr>
                    `).join('');
                }
            }
        } catch (e) { console.error('Organ data error:', e); }
    }
    
    // Organ Pledge Form Submit
    document.getElementById('organPledgeForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        const organs = Array.from(document.querySelectorAll('.organ-checkbox:checked')).map(c => c.value);
        if (organs.length === 0) {
            alert('Please select at least one organ to pledge.');
            return;
        }
        try {
            const res = await fetch('/api/client/organ-pledges', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    pledge_date: document.getElementById('organPledgeDate').value,
                    pledge_type: document.getElementById('organPledgeType').value,
                    organs_pledged: organs,
                    witness_name: document.getElementById('organWitnessName').value,
                    witness_phone: document.getElementById('organWitnessPhone').value,
                    witness_relation: document.getElementById('organWitnessRelation').value,
                    registration_authority: document.getElementById('organRegAuthority').value,
                    family_contact_name: document.getElementById('organFamilyName').value,
                    family_contact_phone: document.getElementById('organFamilyPhone').value,
                    notes: document.getElementById('organPledgeNotes').value
                })
            });
            const data = await res.json();
            if (data.success) {
                alert('Organ pledge registered! Pledge ID: ' + data.pledge_id);
                this.reset();
                loadOrganDonationData();
            } else {
                alert('Error: ' + data.error);
            }
        } catch (e) { alert('Error registering pledge: ' + e.message); }
    });
    
    // Organ Request Form Submit
    document.getElementById('organRequestForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/organ-requests', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    organ_needed: document.getElementById('organRequestOrgan').value,
                    urgency: document.getElementById('organRequestUrgency').value,
                    blood_group: document.getElementById('organRequestBlood').value,
                    diagnosis: document.getElementById('organRequestDiagnosis').value,
                    hla_type: document.getElementById('organRequestHLA').value,
                    treating_hospital: document.getElementById('organRequestHospital').value,
                    hospital_city: document.getElementById('organRequestCity').value,
                    treating_doctor: document.getElementById('organRequestDoctor').value,
                    doctor_contact: document.getElementById('organRequestDoctorPhone').value,
                    emergency_name: document.getElementById('organRequestEmergencyName').value,
                    emergency_phone: document.getElementById('organRequestEmergencyPhone').value,
                    emergency_relation: document.getElementById('organRequestEmergencyRelation').value,
                    insurance_coverage: document.getElementById('organRequestInsurance').checked,
                    financial_assistance_needed: document.getElementById('organRequestFinancialAid').checked,
                    notes: document.getElementById('organRequestNotes').value
                })
            });
            const data = await res.json();
            if (data.success) {
                alert('Organ request submitted! Request ID: ' + data.request_id);
                this.reset();
                loadOrganDonationData();
            } else {
                alert('Error: ' + data.error);
            }
        } catch (e) { alert('Error submitting request: ' + e.message); }
    });
    
    // ==================== INSURANCE & FINANCIAL PAGE ====================
    
    // Load Insurance Page Data
    window.loadInsuranceData = async function() {
        try {
            // Load summary
            const summaryRes = await fetch('/api/client/insurance-summary');
            const summaryData = await summaryRes.json();
            if (summaryData.success) {
                document.getElementById('insuranceStatPolicies').textContent = summaryData.summary.active_policies || 0;
                document.getElementById('insuranceStatCoverage').textContent = '' + (summaryData.summary.total_coverage || 0).toLocaleString('en-IN');
                document.getElementById('insuranceStatClaims').textContent = summaryData.summary.pending_claims || 0;
                document.getElementById('insuranceStatSchemes').textContent = summaryData.summary.govt_schemes || 0;
            }
            
            // Load Policies
            const polRes = await fetch('/api/client/insurances');
            const polData = await polRes.json();
            if (polData.success) {
                const tbody = document.getElementById('insurancePoliciesTable');
                if (polData.insurances.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-4">No insurance policies added yet</td></tr>';
                } else {
                    tbody.innerHTML = polData.insurances.map(p => `
                        <tr>
                            <td><strong>${p.provider_name}</strong><br><small class="text-muted">${p.policy_name || ''}</small></td>
                            <td>${p.policy_number}</td>
                            <td>${(p.sum_insured || 0).toLocaleString('en-IN')}</td>
                            <td>${p.end_date ? new Date(p.end_date).toLocaleDateString('en-IN') : '-'}</td>
                            <td><span class="badge bg-${p.status === 'Active' ? 'success' : 'secondary'}">${p.status}</span></td>
                        </tr>
                    `).join('');
                    // Populate claim policy dropdown
                    const claimDropdown = document.getElementById('insClaimPolicy');
                    claimDropdown.innerHTML = '<option value="">Select Policy</option>' + polData.insurances.map(p => `<option value="${p.id}">${p.provider_name} - ${p.policy_number}</option>`).join('');
                }
            }
            
            // Load Claims
            const claimRes = await fetch('/api/client/insurance-claims');
            const claimData = await claimRes.json();
            if (claimData.success) {
                const tbody = document.getElementById('insuranceClaimsTable');
                if (claimData.claims.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-4">No claims submitted yet</td></tr>';
                } else {
                    const statusColors = {Submitted: 'warning', 'Under Review': 'info', Approved: 'success', Rejected: 'danger', Settled: 'primary'};
                    tbody.innerHTML = claimData.claims.map(c => `
                        <tr>
                            <td>${c.claim_id}</td>
                            <td>${c.claim_date ? new Date(c.claim_date).toLocaleDateString('en-IN') : '-'}</td>
                            <td>${c.hospital_name || '-'}</td>
                            <td>${(c.claimed_amount || 0).toLocaleString('en-IN')}</td>
                            <td><span class="badge bg-${statusColors[c.status] || 'secondary'}">${c.status}</span></td>
                        </tr>
                    `).join('');
                }
            }
            
            // Load Govt Schemes
            const schemeRes = await fetch('/api/client/govt-schemes');
            const schemeData = await schemeRes.json();
            if (schemeData.success) {
                const tbody = document.getElementById('govtSchemesTable');
                if (schemeData.schemes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-4">No government schemes linked yet</td></tr>';
                } else {
                    tbody.innerHTML = schemeData.schemes.map(s => `
                        <tr>
                            <td><strong>${s.scheme_name}</strong></td>
                            <td>${s.enrollment_id}</td>
                            <td>${(s.coverage_amount || 0).toLocaleString('en-IN')}</td>
                            <td>${s.valid_until ? new Date(s.valid_until).toLocaleDateString('en-IN') : '-'}</td>
                            <td><span class="badge bg-${s.status === 'Active' ? 'success' : 'secondary'}">${s.status}</span></td>
                        </tr>
                    `).join('');
                }
            }
            
            // Load Expenses
            const expRes = await fetch('/api/client/medical-expenses');
            const expData = await expRes.json();
            if (expData.success) {
                const tbody = document.getElementById('medicalExpensesTable');
                document.getElementById('expenseTotalAmount').textContent = '' + (expData.summary.total_out_of_pocket || 0).toLocaleString('en-IN');
                document.getElementById('expenseCount').textContent = expData.summary.count || 0;
                if (expData.expenses.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-4">No expenses recorded yet</td></tr>';
                } else {
                    tbody.innerHTML = expData.expenses.map(e => `
                        <tr>
                            <td>${e.expense_date ? new Date(e.expense_date).toLocaleDateString('en-IN') : '-'}</td>
                            <td><span class="badge bg-secondary">${e.category}</span></td>
                            <td>${e.description || e.provider_name || '-'}</td>
                            <td>${(e.amount || 0).toLocaleString('en-IN')}</td>
                        </tr>
                    `).join('');
                }
            }
            
            // Load Bills
            const billRes = await fetch('/api/client/medical-bills');
            const billData = await billRes.json();
            if (billData.success) {
                const tbody = document.getElementById('medicalBillsTable');
                document.getElementById('billsPendingAmount').textContent = '' + (billData.summary.total_pending || 0).toLocaleString('en-IN');
                document.getElementById('billsCount').textContent = billData.summary.count || 0;
                if (billData.bills.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-4">No bills added yet</td></tr>';
                } else {
                    const statusColors = {Pending: 'warning', Partial: 'info', Paid: 'success', Overdue: 'danger'};
                    tbody.innerHTML = billData.bills.map(b => `
                        <tr>
                            <td>${b.bill_number}</td>
                            <td>${b.bill_date ? new Date(b.bill_date).toLocaleDateString('en-IN') : '-'}</td>
                            <td>${b.facility_name || '-'}</td>
                            <td>${(b.net_amount || 0).toLocaleString('en-IN')}</td>
                            <td><span class="badge bg-${statusColors[b.payment_status] || 'secondary'}">${b.payment_status}</span></td>
                        </tr>
                    `).join('');
                }
            }
        } catch (e) { console.error('Error loading insurance data:', e); }
    };
    
    // Insurance Policy Form Submit
    document.getElementById('insurancePolicyForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/insurances', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    provider_name: document.getElementById('insPolicyProvider').value,
                    provider_type: document.getElementById('insPolicyProviderType').value,
                    policy_number: document.getElementById('insPolicyNumber').value,
                    policy_name: document.getElementById('insPolicyName').value,
                    policy_type: document.getElementById('insPolicyType').value,
                    sum_insured: document.getElementById('insPolicySumInsured').value,
                    coverage_type: document.getElementById('insPolicyCoverageType').value,
                    start_date: document.getElementById('insPolicyStartDate').value,
                    end_date: document.getElementById('insPolicyEndDate').value,
                    premium_amount: document.getElementById('insPolicyPremium').value
                })
            });
            const data = await res.json();
            if (data.success) { alert('Insurance policy added!'); this.reset(); loadInsuranceData(); }
            else { alert('Error: ' + data.error); }
        } catch (e) { alert('Error: ' + e.message); }
    });
    
    // Insurance Claim Form Submit
    document.getElementById('insuranceClaimForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/insurance-claims', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    insurance_id: document.getElementById('insClaimPolicy').value,
                    claim_type: document.getElementById('insClaimType').value,
                    treatment_type: document.getElementById('insClaimTreatment').value,
                    hospital_name: document.getElementById('insClaimHospital').value,
                    diagnosis: document.getElementById('insClaimDiagnosis').value,
                    total_bill_amount: document.getElementById('insClaimBillAmount').value,
                    claimed_amount: document.getElementById('insClaimAmount').value,
                    claim_date: document.getElementById('insClaimDate').value
                })
            });
            const data = await res.json();
            if (data.success) { alert('Claim submitted! Claim ID: ' + data.claim_id); this.reset(); loadInsuranceData(); }
            else { alert('Error: ' + data.error); }
        } catch (e) { alert('Error: ' + e.message); }
    });
    
    // Govt Scheme Form Submit
    document.getElementById('govtSchemeForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/govt-schemes', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    scheme_name: document.getElementById('govtSchemeName').value,
                    scheme_type: document.getElementById('govtSchemeType').value,
                    enrollment_id: document.getElementById('govtSchemeEnrollId').value,
                    coverage_amount: document.getElementById('govtSchemeCoverage').value,
                    valid_from: document.getElementById('govtSchemeValidFrom').value,
                    valid_until: document.getElementById('govtSchemeValidUntil').value
                })
            });
            const data = await res.json();
            if (data.success) { alert('Govt scheme linked!'); this.reset(); loadInsuranceData(); }
            else { alert('Error: ' + data.error); }
        } catch (e) { alert('Error: ' + e.message); }
    });
    
    // Medical Expense Form Submit
    document.getElementById('medicalExpenseForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/medical-expenses', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    expense_date: document.getElementById('expenseDate').value,
                    category: document.getElementById('expenseCategory').value,
                    amount: document.getElementById('expenseAmount').value,
                    payment_mode: document.getElementById('expensePaymentMode').value,
                    provider_name: document.getElementById('expenseProvider').value,
                    description: document.getElementById('expenseDescription').value
                })
            });
            const data = await res.json();
            if (data.success) { alert('Expense recorded!'); this.reset(); loadInsuranceData(); }
            else { alert('Error: ' + data.error); }
        } catch (e) { alert('Error: ' + e.message); }
    });
    
    // Medical Bill Form Submit
    document.getElementById('medicalBillForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const res = await fetch('/api/client/medical-bills', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    bill_number: document.getElementById('billNumber').value,
                    bill_date: document.getElementById('billDate').value,
                    due_date: document.getElementById('billDueDate').value,
                    facility_name: document.getElementById('billFacility').value,
                    service_type: document.getElementById('billServiceType').value,
                    total_amount: document.getElementById('billTotalAmount').value
                })
            });
            const data = await res.json();
            if (data.success) { alert('Bill added!'); this.reset(); loadInsuranceData(); }
            else { alert('Error: ' + data.error); }
        } catch (e) { alert('Error: ' + e.message); }
    });
    </script>
    
    <!-- Vitals Page Script -->
    <script src="{{ url_for('static', filename='vitals.js') }}"></script>
    
    <!-- Pill Reminder Script -->
    <script src="{{ url_for('static', filename='pill_reminder.js') }}"></script>

    <!-- Add/Edit Medication Modal -->
    <div class="modal fade" id="medicationModal" tabindex="-1" aria-labelledby="medicationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="medicationModalLabel"><i class="fas fa-pills me-2"></i>Add Medication</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="medicationForm">
                        <input type="hidden" id="medicationId" name="id">
                        
                        <div class="row g-3">
                            <!-- Medication Name with Autocomplete -->
                            <div class="col-md-8">
                                <label class="form-label">Medication Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="medName" name="medication_name" 
                                       list="medicationSuggestions" placeholder="e.g., Metformin" required>
                                <datalist id="medicationSuggestions"></datalist>
                            </div>
                            
                            <!-- Medication Type -->
                            <div class="col-md-4">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="medType" name="medication_type">
                                    <option value="Tablet">Tablet</option>
                                    <option value="Capsule">Capsule</option>
                                    <option value="Syrup">Syrup</option>
                                    <option value="Injection">Injection</option>
                                    <option value="Drops">Drops</option>
                                    <option value="Inhaler">Inhaler</option>
                                    <option value="Powder">Powder</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <!-- Dosage -->
                            <div class="col-md-4">
                                <label class="form-label">Dosage <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="medDosage" name="dosage" 
                                       placeholder="e.g., 500mg" required>
                            </div>
                            
                            <!-- Frequency -->
                            <div class="col-md-4">
                                <label class="form-label">Frequency <span class="text-danger">*</span></label>
                                <select class="form-select" id="medFrequency" name="frequency" onchange="updateTimeInputs()">
                                    <option value="Once Daily">Once Daily</option>
                                    <option value="Twice Daily">Twice Daily</option>
                                    <option value="Three Times">Three Times</option>
                                    <option value="Four Times">Four Times</option>
                                    <option value="Every 8 Hours">Every 8 Hours</option>
                                    <option value="Every 12 Hours">Every 12 Hours</option>
                                    <option value="Weekly">Weekly</option>
                                    <option value="As Needed">As Needed</option>
                                </select>
                            </div>
                            
                            <!-- Reason -->
                            <div class="col-md-4">
                                <label class="form-label">Reason</label>
                                <input type="text" class="form-control" id="medReason" name="reason" 
                                       placeholder="e.g., Diabetes">
                            </div>
                            
                            <!-- Times -->
                            <div class="col-12" id="timesSection">
                                <label class="form-label">Time(s) <span class="text-danger">*</span></label>
                                <div class="row g-2" id="timeInputsContainer">
                                    <div class="col-auto">
                                        <input type="time" class="form-control" name="times[]" value="08:00" required>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Days of Week (for Weekly) -->
                            <div class="col-12" id="daysSection" style="display: none;">
                                <label class="form-label">Days of Week</label>
                                <div class="d-flex flex-wrap gap-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="days[]" value="Mon" id="dayMon">
                                        <label class="form-check-label" for="dayMon">Mon</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="days[]" value="Tue" id="dayTue">
                                        <label class="form-check-label" for="dayTue">Tue</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="days[]" value="Wed" id="dayWed">
                                        <label class="form-check-label" for="dayWed">Wed</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="days[]" value="Thu" id="dayThu">
                                        <label class="form-check-label" for="dayThu">Thu</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="days[]" value="Fri" id="dayFri">
                                        <label class="form-check-label" for="dayFri">Fri</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="days[]" value="Sat" id="daySat">
                                        <label class="form-check-label" for="daySat">Sat</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="days[]" value="Sun" id="daySun">
                                        <label class="form-check-label" for="daySun">Sun</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Start Date -->
                            <div class="col-md-6">
                                <label class="form-label">Start Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="medStartDate" name="start_date" required>
                            </div>
                            
                            <!-- End Date -->
                            <div class="col-md-6">
                                <label class="form-label">End Date <small class="text-muted">(Leave empty for ongoing)</small></label>
                                <input type="date" class="form-control" id="medEndDate" name="end_date">
                            </div>
                            
                            <hr class="my-2">
                            
                            <h6 class="text-muted"><i class="fas fa-box me-2"></i>Refill Tracking (Optional)</h6>
                            
                            <!-- Pills per Refill -->
                            <div class="col-md-4">
                                <label class="form-label">Pills Per Refill</label>
                                <input type="number" class="form-control" id="medPillsPerRefill" name="pills_per_refill" 
                                       placeholder="e.g., 30">
                            </div>
                            
                            <!-- Pills Remaining -->
                            <div class="col-md-4">
                                <label class="form-label">Current Pills Remaining</label>
                                <input type="number" class="form-control" id="medPillsRemaining" name="pills_remaining" 
                                       placeholder="e.g., 25">
                            </div>
                            
                            <!-- Refill Alert Threshold -->
                            <div class="col-md-4">
                                <label class="form-label">Alert When Below</label>
                                <input type="number" class="form-control" id="medRefillAt" name="refill_reminder_at" 
                                       value="7" placeholder="e.g., 7">
                            </div>
                            
                            <hr class="my-2">
                            
                            <!-- Instructions -->
                            <div class="col-12">
                                <label class="form-label">Special Instructions</label>
                                <textarea class="form-control" id="medInstructions" name="instructions" rows="2" 
                                          placeholder="e.g., Take with food, Avoid dairy products"></textarea>
                            </div>
                            
                            <!-- Prescribed By -->
                            <div class="col-md-6">
                                <label class="form-label">Prescribed By</label>
                                <input type="text" class="form-control" id="medPrescribedBy" name="prescribed_by" 
                                       placeholder="Doctor's name">
                            </div>
                            
                            <!-- Notifications -->
                            <div class="col-md-6">
                                <label class="form-label">Notifications</label>
                                <div class="d-flex gap-3 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="medNotifyBrowser" name="notify_browser" checked>
                                        <label class="form-check-label" for="medNotifyBrowser">Browser</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="medNotifyEmail" name="notify_email" checked>
                                        <label class="form-check-label" for="medNotifyEmail">Email</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveMedicationBtn" onclick="saveMedication()">
                        <i class="fas fa-save me-1"></i> Save Medication
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- HIV/STD Status Modal -->
    <div class="modal fade" id="hivStdModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #dc3545, #b02a37); color: white;">
                    <h5 class="modal-title"><i class="fas fa-shield-virus me-2"></i>Update HIV/STD Status</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info mb-3">
                        <i class="fas fa-info-circle me-2"></i>
                        This information is kept confidential and shown only to emergency responders for safety precautions.
                    </div>
                    <div class="mb-3">
                        <label class="form-label">HIV/STD Status <span class="text-danger">*</span></label>
                        <select class="form-select" id="hivStdSelect" required>
                            <option value="unknown">Unknown</option>
                            <option value="negative">Negative</option>
                            <option value="positive">Positive</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Last Test Date</label>
                        <input type="date" class="form-control" id="hivStdTestDate">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="saveHivStdStatus()">
                        <i class="fas fa-save me-1"></i>Save Status
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
    /* HIV/STD Status Card Styles */
    .hiv-std-status-card {
        background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .hiv-std-status-card .status-info {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .hiv-std-status-card .status-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
    }
    .hiv-status-badge {
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }
    .hiv-status-badge.badge-positive {
        background: #dc3545;
        color: white;
    }
    .hiv-status-badge.badge-negative {
        background: #28a745;
        color: white;
    }
    .hiv-status-badge.badge-unknown {
        background: #6c757d;
        color: white;
    }
    .hiv-last-test {
        color: #6c757d;
        font-size: 0.85rem;
        margin-top: 4px;
    }
    </style>

    <!-- Mental Health JavaScript -->
    <script src="{{ url_for('static', filename='mental_health.js') }}"></script>
    
    <!-- Diet JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='diet.js') }}"></script>
    
    <!-- Physical Activity JavaScript -->
    <script src="{{ url_for('static', filename='physical_activity.js') }}"></script>
</body>
</html>

