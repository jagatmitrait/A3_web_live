<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard | A3 Health Card</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard_theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='client_dashboard.css') }}">
    <!-- Reusing client dashboard CSS for consistency, will add specific overrides if needed -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        :root {
            --primary-color: #d32f2f;
            --secondary-color: #6c757d;
            --success-color: #2e7d32;
            --info-color: #0288d1;
            --warning-color: #ed6c02;
            --danger-color: #d32f2f;
            --light-bg: #f8f9fa;
            --dark-text: #212529;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f0f2f5;
            color: var(--dark-text);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header styles */
        header.dashboard-header {
            background: white;
            height: 70px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-shrink: 0;
        }

        .header-left .brand-logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #f5f5f5;
            color: var(--dark-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 25px;
            transition: background 0.3s;
        }

        .user-profile:hover {
            background: #f5f5f5;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }

        /* Main Layout */
        .dashboard-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar styles */
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 20px 0;
            flex-shrink: 0;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 25px;
            color: var(--dark-text);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item i {
            font-size: 18px;
            width: 24px;
        }

        .nav-item:hover {
            background: #fff5f5;
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        .nav-item.active {
            background: linear-gradient(90deg, #ffebee 0%, white 100%);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .logout-item {
            margin-top: 20px;
            border-top: 1px solid #e0e0e0;
            padding-top: 20px;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e0e0e0, transparent);
            margin: 20px 0;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #fafafa;
        }

        .content-page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .content-page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-content {
            flex: 1;
        }

        .stat-label {
            font-size: 13px;
            color: #6c757d;
            margin: 0 0 5px 0;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark-text);
            margin: 0;
        }

        /* Card styles */
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            margin: -20px -20px 20px -20px;
            padding: 15px 20px;
        }

        .card-body {
            padding: 20px;
        }

        /* Specific Doctor Dashboard Overrides */
        .stat-card.appointment-today {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
        }
        
        .stat-card.pending-reports {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .appointment-list-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .appointment-list-item:hover {
            background-color: #f8f9fa;
        }

        .appt-time {
            font-weight: 600;
            min-width: 80px;
            color: var(--primary-color);
        }

        .patient-info {
            flex-grow: 1;
        }

        .patient-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .appt-type {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .appt-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon-sm {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: none;
            transition: all 0.2s;
            cursor: pointer;
        }

        .btn-start { background-color: #e8f5e9; color: #2e7d32; }
        .btn-start:hover { background-color: #c8e6c9; }

        .btn-view { background-color: #ffebee; color: #c62828; }
        .btn-view:hover { background-color: #ffcdd2; }

        /* Utility styles */
        .doctor-status { display: flex; align-items: center; }
        .notification-btn { position: relative; }
        .notification-badge { position: absolute; top: 5px; right: 5px; font-size: 10px; background-color: #d32f2f; color: white; border-radius: 50%; padding: 2px 5px; }

        /* Bootstrap responsive utilities - basic override */
        .row {
            display: flex;
            flex-wrap: wrap;
            margin-right: -10px;
            margin-left: -10px;
        }

        .col-lg-8 {
            flex: 0 0 66.66667%;
            max-width: 66.66667%;
            padding-right: 10px;
            padding-left: 10px;
        }

        .col-lg-4 {
            flex: 0 0 33.33333%;
            max-width: 33.33333%;
            padding-right: 10px;
            padding-left: 10px;
        }

        /* Bootstrap utility classes that might be needed */
        .d-flex { display: flex; }
        .justify-content-between { justify-content: space-between; }
        .align-items-center { align-items: center; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .me-2 { margin-right: 0.5rem; }
        .me-3 { margin-right: 1rem; }
        .ms-2 { margin-left: 0.5rem; }
        .text-muted { color: #6c757d; }
        .text-danger { color: #d32f2f; }
        .text-success { color: #2e7d32; }
        .text-end { text-align: right; }
        .fw-bold { font-weight: 700; }
        .small { font-size: 0.875rem; }
        .badge {
            display: inline-block;
            padding: 0.35em 0.65em;
            font-size: 75%;
            font-weight: 700;
            line-height: 1;
            color: white;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }
        .bg-light { background-color: #f8f9fa; }
        .bg-success { background-color: #2e7d32; }
        .bg-white { background-color: white; }
        .border-0 { border: 0; }
        .shadow-sm { box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); }
        .py-3 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-4 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-5 { padding-top: 3rem; padding-bottom: 3rem; }
        .px-4 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .p-3 { padding: 1rem; }
        .ps-4 { padding-left: 1.5rem; }
        .pe-4 { padding-right: 1.5rem; }
        .d-none { display: none; }
        .d-block { display: block; }
        .d-grid { display: grid; }
        .gap-2 { gap: 0.5rem; }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 1px solid transparent;
            padding: 10px 18px;
            border-radius: 6px;
            font-weight: 600;
            letter-spacing: 0.2px;
            transition: transform 0.08s ease, box-shadow 0.2s ease, background 0.2s ease;
            cursor: pointer;
            text-align: center;
        }
        .btn-outline-danger {
            background: transparent;
            border-color: #d32f2f;
            color: #d32f2f;
        }
        .btn-outline-danger:hover {
            background: #fff5f5;
        }
        .btn-danger {
            background: #d32f2f;
            color: white;
            border-color: #d32f2f;
        }
        .btn-danger:hover {
            background: #b71c1c;
        }
        .btn-sm {
            padding: 8px 12px;
            font-size: 12px;
        }
        .btn-secondary {
            background: white;
            color: #6c757d;
            border: 1px solid #6c757d;
        }
        .btn-outline-secondary {
            background: transparent;
            border: 1px solid #6c757d;
            color: #6c757d;
        }
        .btn-outline-info {
            background: transparent;
            border: 1px solid #0288d1;
            color: #0288d1;
        }
        .text-start { text-align: left; }
        .rounded-3 { border-radius: 1rem; }
        .rounded-circle { border-radius: 50%; }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table th,
        .table td {
            border-bottom: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }
        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
        }
        .bg-light { background-color: #f8f9fa; }
        .input-group {
            display: flex;
            align-items: center;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        .input-group-text {
            padding: 12px 14px;
            background: white;
            color: #6c757d;
        }
        .form-control {
            flex: 1;
            border: none;
            padding: 12px 14px;
            font-size: 14px;
            outline: none;
        }
        .form-control::placeholder {
            color: #9ca3af;
        }
        .form-select {
            padding: 12px 14px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        .modal { display: none; }
        .modal.show { display: block; }
        .align-middle { vertical-align: middle; }
        .d-md-block { display: block; }

        @media (max-width: 768px) {
            .col-lg-8,
            .col-lg-4 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            .d-none.d-md-block {
                display: none !important;
            }
        }

    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <h1 class="brand-logo">A3 Health Card <span class="badge bg-light text-danger fs-6 ms-2">Doctor Portal</span></h1>
        </div>
        <div class="header-right">
            <div class="doctor-status me-3">
                <span class="badge bg-success"><i class="fas fa-circle fa-xs me-1"></i> Online</span>
            </div>
            <button class="icon-btn" id="refreshBtn" title="Refresh">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="icon-btn notification-btn" id="notificationBtn" title="Notifications">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </button>
            <div class="user-profile" id="userProfileBtn">
                <div class="text-end me-2 d-none d-md-block">
                    <div class="fw-bold">{{ user.full_name or 'Dr. User' }}</div>
                    <div class="small text-muted">{{ user.specialty or 'General Physician' }}</div>
                </div>
                <img src="https://ui-avatars.com/api/?name={{ user.full_name or 'Dr' }}&background=d32f2f&color=fff" alt="Profile" class="profile-img">
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="dashboard-container">
        <!-- Left Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="overview">
                    <i class="fas fa-th-large"></i>
                    <span>Overview</span>
                </a>
                <a href="#" class="nav-item" data-page="appointments">
                    <i class="fas fa-calendar-check"></i>
                    <span>Appointments</span>
                </a>
                <a href="#" class="nav-item" data-page="patients">
                    <i class="fas fa-user-injured"></i>
                    <span>My Patients</span>
                </a>
                <a href="#" class="nav-item" data-page="patient-records">
                    <i class="fas fa-notes-medical"></i>
                    <span>Patient Records</span>
                </a>
                <a href="#" class="nav-item" data-page="messages">
                    <i class="fas fa-comments"></i>
                    <span>Messages</span>
                </a>
                <a href="#" class="nav-item" data-page="reports">
                    <i class="fas fa-file-medical-alt"></i>
                    <span>Reports & Labs</span>
                </a>
                <div class="divider"></div>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="{{ url_for('logout') }}" class="nav-item logout-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Overview Page -->
            <div class="content-page active" id="overview-page">
                <!-- Welcome Section -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-1">Good Morning, Dr. {{ user.full_name }}</h2>
                        <p class="text-muted">Here's your schedule for today.</p>
                    </div>
                    <div class="date-display">
                        <i class="far fa-calendar-alt me-2"></i>
                        <span id="currentDate"></span>
                    </div>
                </div>

                <!-- Stats Row -->
                <div class="stats-grid mb-4">
                    <div class="stat-card appointment-today">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Appointments Today</p>
                            <h3 class="stat-value" id="todayAppointmentsCount">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #ffebee; color: #d32f2f;">
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Pending Patients</p>
                            <h3 class="stat-value" id="pendingPatientsCount">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #e8f5e9; color: #2e7d32;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Completed</p>
                            <h3 class="stat-value" id="completedCount">0</h3>
                        </div>
                    </div>
                    <div class="stat-card pending-reports">
                        <div class="stat-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Lab Reports</p>
                            <h3 class="stat-value" id="labReportsCount">0</h3>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <!-- Today's Appointments -->
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white border-bottom-0 py-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-list-ul me-2 text-danger"></i>Today's Schedule</h5>
                                <button class="btn btn-sm btn-outline-danger" onclick="document.querySelector('.nav-item[data-page=\'appointments\']').click()">View All</button>
                            </div>
                            <div class="card-body p-0">
                                <div class="appointment-list" id="todayAppointmentsList">
                                    <!-- Appointments will be loaded here -->
                                    <div class="text-center py-5 text-muted">
                                        <div class="spinner-border text-danger mb-2" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p>Loading schedule...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Queue & Quick Actions -->
                    <div class="col-lg-4">
                        <!-- Next Patient Card -->
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-white border-bottom-0 py-3">
                                <h5 class="mb-0"><i class="fas fa-user-check me-2 text-success"></i>Next Patient</h5>
                            </div>
                            <div class="card-body" id="nextPatientCard">
                                <div class="text-center py-4 text-muted">
                                    <i class="fas fa-coffee fa-2x mb-2"></i>
                                    <p>No patients in waiting queue</p>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white border-bottom-0 py-3">
                                <h5 class="mb-0">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-danger text-start" onclick="showCreateAppointmentModal()">
                                        <i class="fas fa-plus-circle me-2"></i> Create Appointment
                                    </button>
                                    <button class="btn btn-outline-secondary text-start" onclick="document.querySelector('.nav-item[data-page=\'patients\']').click()">
                                        <i class="fas fa-search me-2"></i> Search Patient
                                    </button>
                                    <button class="btn btn-outline-info text-start" onclick="showUploadReportModal()">
                                        <i class="fas fa-file-medical me-2"></i> Upload Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                            <input type="text" class="form-control border-start-0 ps-0" id="patientSearchInput" placeholder="Search by Name or UID...">
                            <button class="btn btn-danger" type="button" id="searchBtn">Search</button>
                        </div>
                    </div>
                </div>

                <!-- Results Table -->
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light">
                                    <tr>
                                        <th class="ps-4">Patient</th>
                                        <th>UID</th>
                                        <th>Contact</th>
                                        <th>Status</th>
                                        <th class="text-end pe-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="patientResultsTable">
                                    <tr>
                                        <td colspan="5" class="text-center py-5 text-muted">
                                            <i class="fas fa-search fa-2x mb-3 d-block"></i>
                                            Start typing to search for patients
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appointments Page -->
            <div id="appointments-page" class="content-page">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="mb-0">Appointments</h3>
                    <div class="btn-group">
                        <button class="btn btn-outline-secondary active" onclick="filterAppointments('all')">All</button>
                        <button class="btn btn-outline-secondary" onclick="filterAppointments('today')">Today</button>
                        <button class="btn btn-outline-secondary" onclick="filterAppointments('upcoming')">Upcoming</button>
                    </div>
                </div>
                
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light">
                                    <tr>
                                        <th class="ps-4">Date & Time</th>
                                        <th>Patient</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th class="text-end pe-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="allAppointmentsTable">
                                    <tr>
                                        <td colspan="5" class="text-center py-5 text-muted">
                                            <div class="spinner-border text-danger" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Patients Page -->
            <div id="patients-page" class="content-page">
                <h3 class="mb-4">My Patients</h3>
                <!-- Search Bar -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                            <input type="text" class="form-control border-start-0 ps-0" id="patientSearchInputMain" placeholder="Search by Name or UID..." onkeypress="if(event.key === 'Enter') searchPatients(this.value, 'patientResultsTableMain')">
                            <button class="btn btn-danger" type="button" onclick="searchPatients(document.getElementById('patientSearchInputMain').value, 'patientResultsTableMain')">Search</button>
                        </div>
                    </div>
                </div>

                <!-- Results Table -->
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light">
                                    <tr>
                                        <th class="ps-4">Patient</th>
                                        <th>UID</th>
                                        <th>Contact</th>
                                        <th>Status</th>
                                        <th class="text-end pe-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="patientResultsTableMain">
                                    <tr>
                                        <td colspan="5" class="text-center py-5 text-muted">
                                            <i class="fas fa-search fa-2x mb-3 d-block"></i>
                                            Start typing to search for patients
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consultation Page -->
            <div id="consultations-page" class="content-page">
                <!-- Start Screen -->
                <div id="consultationStartScreen" class="text-center py-5">
                    <div class="mb-4">
                        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                            <i class="fas fa-stethoscope fa-3x text-danger"></i>
                        </div>
                    </div>
                    <h3>Start a Consultation</h3>
                    <p class="text-muted mb-4">Select a patient from "My Patients" or the queue to begin a session.</p>
                    <button class="btn btn-danger" onclick="document.querySelector('.nav-item[data-page=\'patients\']').click()">
                        <i class="fas fa-search me-2"></i> Find Patient
                    </button>
                </div>

                <!-- Active Workspace (Hidden by default) -->
                <div id="consultationWorkspace" class="d-none">
                    <!-- Sticky Patient Header -->
                    <div class="card border-0 shadow-sm mb-4 sticky-top" style="top: 80px; z-index: 900;">
                        <div class="card-body py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center gap-3">
                                    <img src="" id="activePatientImg" class="rounded-circle" width="40" height="40">
                                    <div>
                                        <div class="fw-bold" id="activePatientName">--</div>
                                        <div class="small text-muted">UID: <span id="activePatientUID">--</span> | Age: <span id="activePatientAge">--</span> | <span id="activePatientGender">--</span></div>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="viewPatient(document.getElementById('activePatientUID').textContent)">History</button>
                                    <button class="btn btn-sm btn-success" onclick="saveConsultation()">End & Save</button>
                                    <button class="btn btn-sm btn-light text-danger" onclick="cancelConsultation()"><i class="fas fa-times"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <!-- SOAP Notes -->
                        <div class="col-lg-8">
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-header bg-white border-bottom-0 py-3">
                                    <h5 class="mb-0">Clinical Notes (SOAP)</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label small text-muted fw-bold">Subjective (Symptoms)</label>
                                        <textarea class="form-control" id="soapSubjective" rows="2" placeholder="Patient's complaints..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small text-muted fw-bold">Objective (Vitals/Exam)</label>
                                        <textarea class="form-control" id="soapObjective" rows="2" placeholder="Observations..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small text-muted fw-bold">Assessment (Diagnosis)</label>
                                        <textarea class="form-control" id="soapAssessment" rows="2" placeholder="Diagnosis..."></textarea>
                                    </div>
                                    <div class="mb-0">
                                        <label class="form-label small text-muted fw-bold">Plan (Treatment)</label>
                                        <textarea class="form-control" id="soapPlan" rows="2" placeholder="Treatment plan..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rx & Labs -->
                        <div class="col-lg-4">
                            <!-- Prescriptions -->
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-header bg-white border-bottom-0 py-3 d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Prescription</h5>
                                    <button class="btn btn-sm btn-outline-danger" onclick="addPrescriptionRow()"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="card-body p-2" id="prescriptionList">
                                    <!-- Dynamic Rows -->
                                </div>
                            </div>

                            <!-- Lab Orders -->
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-white border-bottom-0 py-3 d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Lab Orders</h5>
                                    <button class="btn btn-sm btn-outline-danger" onclick="addLabRow()"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="card-body p-2" id="labList">
                                    <!-- Dynamic Rows -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Page -->
            <div id="messages-page" class="content-page">
                <div class="text-center py-5 text-muted">
                    <i class="fas fa-comments fa-3x mb-3 opacity-25"></i>
                    <h4>Messages</h4>
                    <p>Messaging module coming soon.</p>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports-page" class="content-page">
                <div class="text-center py-5 text-muted">
                    <i class="fas fa-file-medical-alt fa-3x mb-3 opacity-25"></i>
                    <h4>Reports</h4>
                    <p>Reports module coming soon.</p>
                </div>
            </div>

            <!-- Patient Records Page -->
            <div id="patient-records-page" class="content-page">
                <h3 class="mb-4"><i class="fas fa-notes-medical me-2 text-danger"></i>Patient Medical Records</h3>
                
                <!-- Patient Search -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text bg-white"><i class="fas fa-search text-muted"></i></span>
                                    <input type="text" class="form-control" id="recordsPatientSearch" placeholder="Search patient by name or UID...">
                                </div>
                                <div id="recordsPatientResults" class="search-results-dropdown"></div>
                            </div>
                            <div class="col-md-6" id="recordsSelectedPatient" style="display:none;">
                                <div class="d-flex align-items-center gap-3 bg-light p-3 rounded">
                                    <div>
                                        <strong id="recordsPatientName">-</strong>
                                        <span class="text-muted ms-2" id="recordsPatientUID">-</span>
                                        <span class="badge bg-info ms-2" id="recordsPatientAge">-</span>
                                        <span class="badge bg-danger ms-2" id="recordsPatientBlood">-</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger ms-auto" onclick="clearRecordsPatient()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medical Records Tabs -->
                <ul class="nav nav-tabs mb-3" id="doctorRecordsTabs">
                    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#drVitalsTab"><i class="fas fa-heartbeat me-1"></i> Vitals</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#drInvestigationsTab"><i class="fas fa-flask me-1"></i> Investigations</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#drMedicalHistoryTab"><i class="fas fa-notes-medical me-1"></i> Medical History</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#drLifestyleTab"><i class="fas fa-running me-1"></i> Lifestyle</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#drSummaryTab"><i class="fas fa-chart-pie me-1"></i> Summary</a></li>
                </ul>


                <div class="tab-content">
                    <!-- Vitals Tab (NEW) -->
                    <div class="tab-pane fade show active" id="drVitalsTab">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-heartbeat me-2 text-danger"></i>Patient Vitals</h5>
                                <button class="btn btn-sm btn-danger" onclick="showDrAddVitalsModal()">
                                    <i class="fas fa-plus me-1"></i> Record Vitals
                                </button>
                            </div>
                            <div class="card-body" id="drVitalsList">
                                <div class="text-center py-5 text-muted">
                                    <i class="fas fa-search fa-2x mb-3 opacity-25"></i>
                                    <p>Select a patient to view vitals history</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Investigations Tab (NEW) -->
                    <div class="tab-pane fade" id="drInvestigationsTab">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-flask me-2 text-info"></i>Investigations & Reports</h5>
                                <button class="btn btn-sm btn-info text-white" onclick="showDrOrderInvestigationModal()">
                                    <i class="fas fa-plus me-1"></i> Order Investigation
                                </button>
                            </div>
                            <div class="card-body" id="drInvestigationsList">
                                <div class="text-center py-5 text-muted">
                                    <i class="fas fa-search fa-2x mb-3 opacity-25"></i>
                                    <p>Select a patient to view investigations</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medical History Tab -->
                    <div class="tab-pane fade" id="drMedicalHistoryTab">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Medical History Records</h5>
                                <button class="btn btn-sm btn-danger" onclick="showDrAddMedicalHistoryModal()">
                                    <i class="fas fa-plus me-1"></i> Add Record
                                </button>
                            </div>
                            <div class="card-body" id="drMedicalHistoryList">
                                <div class="text-center py-5 text-muted">
                                    <i class="fas fa-search fa-2x mb-3 opacity-25"></i>
                                    <p>Select a patient to view medical history</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lifestyle Tab -->
                    <div class="tab-pane fade" id="drLifestyleTab">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3">
                                <h5 class="mb-0">Lifestyle & Risk Assessment</h5>
                            </div>
                            <div class="card-body" id="drLifestyleContent">
                                <div class="text-center py-5 text-muted">
                                    <i class="fas fa-search fa-2x mb-3 opacity-25"></i>
                                    <p>Select a patient to view lifestyle assessment</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Tab -->
                    <div class="tab-pane fade" id="drSummaryTab">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3">
                                <h5 class="mb-0">Records Summary</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="bg-light p-3 rounded text-center">
                                            <i class="fas fa-notes-medical fa-2x text-danger mb-2"></i>
                                            <h4 id="drMedicalCount">0</h4>
                                            <p class="text-muted mb-0">Medical History</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="bg-light p-3 rounded text-center">
                                            <i class="fas fa-allergies fa-2x text-warning mb-2"></i>
                                            <h4 id="drAllergyCount">0</h4>
                                            <p class="text-muted mb-0">Allergies</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="bg-light p-3 rounded text-center">
                                            <i class="fas fa-procedures fa-2x text-info mb-2"></i>
                                            <h4 id="drSurgeryCount">0</h4>
                                            <p class="text-muted mb-0">Surgeries</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="bg-light p-3 rounded text-center">
                                            <i class="fas fa-syringe fa-2x text-success mb-2"></i>
                                            <h4 id="drVaccinationCount">0</h4>
                                            <p class="text-muted mb-0">Vaccinations</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="bg-light p-3 rounded text-center">
                                            <i class="fas fa-heart fa-2x text-danger mb-2"></i>
                                            <h4 id="drImplantCount">0</h4>
                                            <p class="text-muted mb-0">Implants</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="bg-light p-3 rounded text-center">
                                            <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                            <h4 id="drFamilyHistoryCount">0</h4>
                                            <p class="text-muted mb-0">Family History</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Add Medical History Modal (Doctor) -->
    <div class="modal fade" id="drAddMedicalHistoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold"><i class="fas fa-plus-circle me-2"></i>Add Medical History Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="drAddMedicalHistoryForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label small text-muted">Record Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="drMhRecordType" required>
                                    <option value="">Select...</option>
                                    <option value="chronic">Chronic Illness</option>
                                    <option value="past_illness">Past Illness</option>
                                    <option value="hospitalization">Hospitalization</option>
                                    <option value="ncd">Non-Communicable Disease (NCD)</option>
                                    <option value="communicable">Communicable Disease</option>
                                    <option value="genetic">Genetic Disorder</option>
                                    <option value="mental_health">Mental Health</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label small text-muted">Condition Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="drMhConditionName" required placeholder="e.g., Diabetes, Hypertension">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label small text-muted">Diagnosis Date</label>
                                <input type="date" class="form-control" id="drMhDiagnosisDate">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label small text-muted">Severity</label>
                                <select class="form-select" id="drMhSeverity">
                                    <option value="">Select...</option>
                                    <option value="mild">Mild</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="severe">Severe</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label small text-muted">Status</label>
                                <select class="form-select" id="drMhIsActive">
                                    <option value="true">Active/Ongoing</option>
                                    <option value="false">Resolved</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label small text-muted">Treatment</label>
                                <textarea class="form-control" id="drMhTreatment" rows="2"></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label small text-muted">Notes</label>
                                <textarea class="form-control" id="drMhNotes" rows="2"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="drSaveMedicalHistory()">
                        <i class="fas fa-save me-1"></i> Save Record
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Vitals Modal (Doctor) - Phase 4 -->
    <div class="modal fade" id="drAddVitalsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold"><i class="fas fa-heartbeat me-2 text-danger"></i>Record Patient Vitals</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="drAddVitalsForm">
                        <h6 class="text-muted mb-3"><i class="fas fa-stethoscope me-1"></i> Cardiovascular</h6>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Systolic BP (mmHg)</label>
                                <input type="number" class="form-control" id="drVitalSystolic" placeholder="120">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Diastolic BP (mmHg)</label>
                                <input type="number" class="form-control" id="drVitalDiastolic" placeholder="80">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Heart Rate (bpm)</label>
                                <input type="number" class="form-control" id="drVitalHeartRate" placeholder="72">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Respiratory Rate (/min)</label>
                                <input type="number" class="form-control" id="drVitalRespRate" placeholder="16">
                            </div>
                        </div>
                        <h6 class="text-muted mb-3"><i class="fas fa-thermometer-half me-1"></i> Other Vitals</h6>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">SpO2 (%)</label>
                                <input type="number" class="form-control" id="drVitalSpO2" placeholder="98">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Temperature (F)</label>
                                <input type="number" step="0.1" class="form-control" id="drVitalTemp" placeholder="98.6">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Pain Score (0-10)</label>
                                <select class="form-select" id="drVitalPain">
                                    <option value="">Select...</option>
                                    <option value="0">0 - No Pain</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3 - Mild</option>
                                    <option value="4">4</option>
                                    <option value="5">5 - Moderate</option>
                                    <option value="6">6</option>
                                    <option value="7">7 - Severe</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10 - Worst</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Blood Sugar (mg/dL)</label>
                                <input type="number" class="form-control" id="drVitalBG" placeholder="100">
                            </div>
                        </div>
                        <h6 class="text-muted mb-3"><i class="fas fa-weight me-1"></i> Measurements</h6>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Weight (kg)</label>
                                <input type="number" step="0.1" class="form-control" id="drVitalWeight" placeholder="65">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Height (cm)</label>
                                <input type="number" class="form-control" id="drVitalHeight" placeholder="170">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label small text-muted">Visit Type</label>
                                <select class="form-select" id="drVitalVisitType">
                                    <option value="General">General Checkup</option>
                                    <option value="Follow-up">Follow-up</option>
                                    <option value="Emergency">Emergency</option>
                                    <option value="Routine">Routine</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">Notes</label>
                            <textarea class="form-control" id="drVitalNotes" rows="2" placeholder="Any observations..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="drSaveVitals()">
                        <i class="fas fa-save me-1"></i> Save Vitals
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Investigation Modal (Doctor) - Phase 4 -->
    <div class="modal fade" id="drOrderInvestigationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold"><i class="fas fa-flask me-2 text-info"></i>Order Investigation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="drOrderInvestigationForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label small text-muted">Investigation Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="drInvType" required onchange="updateInvCategories()">
                                    <option value="">Select...</option>
                                    <option value="lab">Laboratory Test</option>
                                    <option value="imaging">Imaging / Radiology</option>
                                    <option value="pathology">Pathology</option>
                                    <option value="microbiology">Microbiology / Culture</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label small text-muted">Category</label>
                                <select class="form-select" id="drInvCategory">
                                    <option value="">Select type first...</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label small text-muted">Test/Investigation Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="drInvName" required placeholder="e.g., Complete Blood Count, Chest X-Ray">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label small text-muted">Urgency</label>
                                <select class="form-select" id="drInvUrgency">
                                    <option value="Routine">Routine</option>
                                    <option value="Urgent">Urgent</option>
                                    <option value="STAT">STAT (Emergency)</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">Clinical Indication</label>
                            <textarea class="form-control" id="drInvIndication" rows="2" placeholder="Reason for ordering this investigation..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">Special Instructions</label>
                            <textarea class="form-control" id="drInvNotes" rows="2" placeholder="Fasting required, sample type, etc."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-info text-white" onclick="drOrderInvestigation()">
                        <i class="fas fa-paper-plane me-1"></i> Order Investigation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Appointment Modal -->
    <div class="modal fade" id="createAppointmentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Book Appointment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createAppointmentForm">
                        <div class="mb-3">
                            <label class="form-label small text-muted">Patient UID</label>
                            <input type="text" class="form-control" name="uid" placeholder="16-digit UID" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">Date</label>
                            <input type="date" class="form-control" name="date" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">Time</label>
                            <input type="time" class="form-control" name="time" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">Type</label>
                            <select class="form-select" name="type">
                                <option value="General Checkup">General Checkup</option>
                                <option value="Follow Up">Follow Up</option>
                                <option value="Emergency">Emergency</option>
                            </select>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-danger">Book Appointment</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Report Modal -->
    <div class="modal fade" id="uploadReportModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Upload Medical Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadReportForm">
                        <div class="mb-3">
                            <label class="form-label small text-muted">Patient UID</label>
                            <input type="text" class="form-control" name="uid" placeholder="16-digit UID" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">Report Title</label>
                            <input type="text" class="form-control" name="title" placeholder="e.g. Blood Test Result" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted">File</label>
                            <input type="file" class="form-control" name="file" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-info text-white">Upload</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Patient Summary Modal -->
    <div class="modal fade" id="patientSummaryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="d-flex align-items-center">
                        <img src="" id="modalPatientImg" class="rounded-circle me-3" width="50" height="50" alt="Patient">
                        <div>
                            <h5 class="modal-title fw-bold" id="modalPatientName">Patient Name</h5>
                            <div class="text-muted small">UID: <span id="modalPatientUID"></span></div>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Personal Info -->
                    <div class="row mb-4 mt-3">
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded-3">
                                <small class="text-muted d-block">Age</small>
                                <strong id="modalPatientAge">--</strong>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded-3">
                                <small class="text-muted d-block">Blood Group</small>
                                <strong id="modalPatientBlood">--</strong>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded-3">
                                <small class="text-muted d-block">Email</small>
                                <strong id="modalPatientEmail" class="text-truncate d-block">--</strong>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded-3">
                                <small class="text-muted d-block">Phone</small>
                                <strong id="modalPatientPhone">--</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Medical History Tabs -->
                    <ul class="nav nav-tabs nav-fill mb-3" id="patientTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active text-danger" id="allergies-tab" data-bs-toggle="tab" data-bs-target="#allergies-pane" type="button" role="tab">Allergies</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-danger" id="surgeries-tab" data-bs-toggle="tab" data-bs-target="#surgeries-pane" type="button" role="tab">Surgeries</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-danger" id="implants-tab" data-bs-toggle="tab" data-bs-target="#implants-pane" type="button" role="tab">Implants</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-danger" id="vaccinations-tab" data-bs-toggle="tab" data-bs-target="#vaccinations-pane" type="button" role="tab">Vaccinations</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-danger" id="family-tab" data-bs-toggle="tab" data-bs-target="#family-pane" type="button" role="tab">Family History</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link text-danger" id="consultations-tab" data-bs-toggle="tab" data-bs-target="#consultations-pane" type="button" role="tab">Consultations</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="patientTabsContent">
                        <!-- Allergies -->
                        <div class="tab-pane fade show active" id="allergies-pane" role="tabpanel">
                            <div id="allergiesList" class="row g-3">
                                <!-- Dynamic Content -->
                            </div>
                        </div>
                        <!-- Surgeries -->
                        <div class="tab-pane fade" id="surgeries-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead><tr><th>Procedure</th><th>Date</th><th>Hospital</th></tr></thead>
                                    <tbody id="surgeriesList"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Implants -->
                        <div class="tab-pane fade" id="implants-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead><tr><th>Type</th><th>Model</th><th>Site</th><th>Date</th></tr></thead>
                                    <tbody id="implantsList"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Vaccinations -->
                        <div class="tab-pane fade" id="vaccinations-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead><tr><th>Vaccine</th><th>Date Administered</th></tr></thead>
                                    <tbody id="vaccinationsList"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Family History -->
                        <div class="tab-pane fade" id="family-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead><tr><th>Condition</th><th>Relationship</th></tr></thead>
                                    <tbody id="familyList"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Consultations -->
                        <div class="tab-pane fade" id="consultations-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead><tr><th>Date</th><th>Doctor</th><th>Assessment</th></tr></thead>
                                    <tbody id="consultationsList"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" id="modalFullAccessBtn"><i class="fas fa-lock-open me-2"></i>Full Access (OTP)</button>

                </div>
            </div>
        </div>
    </div>
    <!-- OTP Request Modal -->
    <div class="modal fade" id="otpRequestModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Request Patient Access</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>To view this patient's full dashboard, an OTP will be sent to their registered email/phone.</p>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Patient UID</label>
                        <div id="otpPatientUid" class="form-control-plaintext"></div>
                    </div>
                    
                    <div id="otpStep1">
                        <button class="btn btn-primary w-100" onclick="sendOtp()">
                            <i class="fas fa-paper-plane me-2"></i> Send OTP
                        </button>
                    </div>

                    <div id="otpStep2" class="d-none mt-3">
                        <div class="mb-3">
                            <label for="otpInput" class="form-label">Enter 6-digit OTP</label>
                            <input type="text" class="form-control text-center fs-4 letter-spacing-2" id="otpInput" maxlength="6" placeholder="000000">
                        </div>
                        <button class="btn btn-success w-100" onclick="verifyOtp()">
                            <i class="fas fa-check-circle me-2"></i> Verify & Access
                        </button>
                        <div class="text-center mt-2">
                            <small class="text-muted">Resend in <span id="otpTimer">00:30</span></small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='doctor_dashboard.js') }}"></script>
</body>
</html>
